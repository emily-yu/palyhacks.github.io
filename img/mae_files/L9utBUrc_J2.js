if (self.CavalryLogger) { CavalryLogger.start_js(["bIBfD"]); }

__d('MessengerBotsMenuActions',['MessengerDispatcher','MNCommerceActionTypes'],(function a(b,c,d,e,f,g){'use strict';var h={showMenu:function i(j){c('MessengerDispatcher').dispatch({type:c('MNCommerceActionTypes').BOTS_MENU.SHOW,pageID:j});},hideMenu:function i(j){c('MessengerDispatcher').dispatch({type:c('MNCommerceActionTypes').BOTS_MENU.HIDE,pageID:j});},stateLoaded:function i(j,k){c('MessengerDispatcher').dispatch({type:c('MNCommerceActionTypes').BOTS_MENU.LOADED,pageID:j,ctas:k});},stateLoadError:function i(j){c('MessengerDispatcher').dispatch({type:c('MNCommerceActionTypes').BOTS_MENU.LOAD_ERROR,pageID:j});},stateReload:function i(j){c('MessengerDispatcher').dispatch({type:c('MNCommerceActionTypes').BOTS_MENU.RELOAD,pageID:j});}};f.exports=h;}),null);
__d('MessengerBotsMenuVisibilityActions',['MessengerDispatcher','MNCommerceActionTypes'],(function a(b,c,d,e,f,g){'use strict';var h={visibilityLoaded:function i(j,k){c('MessengerDispatcher').dispatch({type:c('MNCommerceActionTypes').BOTS_MENU.VISIBILITY_LOADED,pageID:j,isVisible:k});}};f.exports=h;}),null);
__d("XMessengerBotsMenuController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messenger\/commerce\/bots\/menu\/",{page_id:{type:"String",required:true}});}),null);
__d('MNCommerceBotMenuDataManager',['AsyncRequest','MessengerBotsMenuActions','XMessengerBotsMenuController'],(function a(b,c,d,e,f,g){'use strict';h.prototype.fetchMenu=function(i){var j=c('XMessengerBotsMenuController').getURIBuilder().setString('page_id',i).getURI();new (c('AsyncRequest'))().setURI(j).setHandler(this.$MNCommerceBotMenuDataManager1.bind(this,i)).setErrorHandler(this.$MNCommerceBotMenuDataManager2.bind(this,i)).send();};h.prototype.$MNCommerceBotMenuDataManager1=function(i,j){c('MessengerBotsMenuActions').stateLoaded(i,j.payload);};h.prototype.$MNCommerceBotMenuDataManager2=function(i,j){c('MessengerBotsMenuActions').stateLoadError(i);};function h(){}f.exports=new h();}),null);
__d("XMNCommerceShowStructuredMenuController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messenger\/commerce\/menu\/show\/",{});}),null);
__d('MNCommerceBotMenuVisibilityDataManager',['AsyncRequest','MessengerBotsMenuVisibilityActions','XMNCommerceShowStructuredMenuController'],(function a(b,c,d,e,f,g){'use strict';h.prototype.fetchVisibility=function(i){var j=c('XMNCommerceShowStructuredMenuController').getURIBuilder().getURI();new (c('AsyncRequest'))().setURI(j).setMethod('post').setData({page_id:i}).setHandler(this.$MNCommerceBotMenuVisibilityDataManager1.bind(this,i)).setErrorHandler(this.$MNCommerceBotMenuVisibilityDataManager2.bind(this,i)).send();};h.prototype.$MNCommerceBotMenuVisibilityDataManager1=function(i,j){c('MessengerBotsMenuVisibilityActions').visibilityLoaded(i,!!(j&&j.payload));};h.prototype.$MNCommerceBotMenuVisibilityDataManager2=function(i,j){c('MessengerBotsMenuVisibilityActions').visibilityLoaded(i,false);};function h(){}f.exports=new h();}),null);
__d('MessengerBotsMenuStore',['Cache','FluxStore','LoadObject','MessengerDispatcher','MNCommerceActionTypes','MNCommerceCacheTimeoutLimits','MNCommerceBotMenuDataManager','MNCommerceBotMenuVisibilityDataManager'],(function a(b,c,d,e,f,g){'use strict';var h,i;h=babelHelpers.inherits(j,c('FluxStore'));i=h&&h.prototype;function j(){i.constructor.call(this,c('MessengerDispatcher'));this.$MessengerBotsMenuStore1=new (c('Cache'))();this.$MessengerBotsMenuStore2=new (c('Cache'))();this.$MessengerBotsMenuStore3=null;this.$MessengerBotsMenuStore4=false;}j.prototype.__onDispatch=function(k){var l=k.type,m=k.pageID;switch(l){case c('MNCommerceActionTypes').BOTS_MENU.SHOW:this.$MessengerBotsMenuStore4=true;this.$MessengerBotsMenuStore3=m;break;case c('MNCommerceActionTypes').BOTS_MENU.HIDE:this.$MessengerBotsMenuStore4=false;this.$MessengerBotsMenuStore3=null;break;case c('MNCommerceActionTypes').BOTS_MENU.VISIBILITY_LOADED:this.$MessengerBotsMenuStore2.set(m,k.isVisible);break;case c('MNCommerceActionTypes').BOTS_MENU.LOADED:var n=k.ctas.menu;this.$MessengerBotsMenuStore1.set(m,c('LoadObject').empty().setValue(n),null,c('MNCommerceCacheTimeoutLimits').SUCCESS_TIMEOUT);break;case c('MNCommerceActionTypes').BOTS_MENU.LOAD_ERROR:this.$MessengerBotsMenuStore1.set(m,c('LoadObject').empty().setError(new Error('Unable to load structured menu for: '+m)),null,c('MNCommerceCacheTimeoutLimits').ERROR_TIMEOUT);break;}this.__emitChange();};j.prototype.getState=function(){return {pageID:this.$MessengerBotsMenuStore3,showTray:this.$MessengerBotsMenuStore4};};j.prototype.getMenu=function(k){if(k&&!this.$MessengerBotsMenuStore1.has(k)){this.$MessengerBotsMenuStore1.set(k,c('LoadObject').loading().setValue({pageID:k}));c('MNCommerceBotMenuDataManager').fetchMenu(k);}return this.$MessengerBotsMenuStore1.get(k)||c('LoadObject').empty();};j.prototype.getMenuButtonVisibility=function(k){if(!this.$MessengerBotsMenuStore2.has(k))c('MNCommerceBotMenuVisibilityDataManager').fetchVisibility(k);return !!this.$MessengerBotsMenuStore2.get(k,false);};f.exports=new j();}),null);
__d('MessengerPlatformPersistMenuDialog.react',['cx','fbt','AsyncDialog','AsyncRequest','Link.react','MessengerBotsMenuStore','MessengerBotsWebTypedLogger','MessengerContextualDialog.react','MNBotsLoggerEvents','MNCommerceCallToActionType','MNCommerceCTAProcessor','MNCommercePostbackCTADataManager','React','StoreAndPropBasedStateMixin','Tooltip','XUIContextualDialog.react','XUISpinner.react','joinClasses'],(function a(b,c,d,e,f,g,h,i){'use strict';var j=c('React').PropTypes,k=c('React').createClass({displayName:'MessengerPlatformPersistMenuDialog',propTypes:{flyoutAlignment:j.string,pageID:j.string.isRequired,threadID:j.string.isRequired,onClick:j.func},mixins:[c('StoreAndPropBasedStateMixin')(c('MessengerBotsMenuStore'))],statics:{calculateState:function l(m){var n=c('MessengerBotsMenuStore').getMenu(m.pageID);return {shown:c('MessengerBotsMenuStore').getState(),loading:n.isLoading(),ctas:n.getValue()};}},renderCTA:function l(m,n,o){var p="_1wc8 _1wc9",q=function(x,y){new (c('MessengerBotsWebTypedLogger'))().setEvent(c('MNBotsLoggerEvents').BOT_COMPOSER_MENU_ITEM_DID_SELECT).setPageID(this.props.pageID).setTitle(x.title).setURL(x.action_link).setType(x.action_type).setIndex(n).setCount(o).log();return (c('React').createElement(c('Link.react'),{className:y,href:x.onClick?null:x.action_link,key:x.title,onClick:x.onClick,target:'_blank'},x.translated_title||x.title));}.bind(this),r=function x(y,z){return (c('React').createElement(c('Link.react'),{className:z,key:y.title,onClick:y.onClick},y.translated_title||y.title));},s=function x(y,z){var aa=i._("To use this feature, use the Messenger app.");return (c('React').createElement('div',babelHelpers['extends']({className:c('joinClasses')(z,"_3cno"),'data-tooltip-alignh':'center','data-tooltip-position':'above',key:y.title},c('Tooltip').propsFor(aa)),y.translated_title||y.title));},t=m.action_link.startsWith('fb-messenger://payments/buy/mc?')||m.action_link.startsWith('fb-messenger://business/commerce/');switch(m.action_type){case c('MNCommerceCallToActionType').POSTBACK:var u=function(x){if(m.is_mutable_by_server){c('MNCommercePostbackCTADataManager').send(m.id);}else c('MNCommercePostbackCTADataManager').sendAndConfirm(m.id,m.title,this.props.threadID);new (c('MessengerBotsWebTypedLogger'))().setEvent(c('MNBotsLoggerEvents').BOT_COMPOSER_MENU_ITEM_DID_SELECT).setPageID(this.props.pageID).setTitle(m.title).setURL(m.action_link).setType(m.action_type).setIndex(n).setCount(o).log();}.bind(this);return (c('React').createElement(c('Link.react'),{className:p,key:n,onClick:u},m.translated_title||m.title));case c('MNCommerceCallToActionType').OPEN_URL:if(t){return r(m,p);}else return q(m,p);case c('MNCommerceCallToActionType').OPEN_CANCEL_RIDE_MUTATION:return s(m,p);case c('MNCommerceCallToActionType').OPEN_NATIVE:if(t){return r(m,p);}else return s(m,p);case c('MNCommerceCallToActionType').ACCOUNT_LINK:var v=function x(y){c('MNCommerceCTAProcessor').process(m.id);};return (c('React').createElement(c('Link.react'),{className:p,key:n,onClick:v},m.translated_title||m.title));case c('MNCommerceCallToActionType').FACEBOOK_REPORT_A_PROBLEM:var w=function x(y){c('AsyncDialog').send(new (c('AsyncRequest'))('/ajax/bugs/report'));};return (c('React').createElement(c('Link.react'),{className:p,key:n,onClick:w},m.translated_title||m.title));}return null;},renderMenuRow:function l(m,n){var o=[];for(var p in m)o.push(c('React').createElement('li',{className:"_1wc4",key:p,onClick:this.props.onClick},this.renderCTA(m[p],p,n)));return o;},render:function l(){if(this.state.loading)return (c('React').createElement('div',{className:"_5xf_"},c('React').createElement(c('XUISpinner.react'),{size:'large'})));var m=[],n=this.state.ctas,o=0;for(o in n)m.push(n[o].title);new (c('MessengerBotsWebTypedLogger'))().setEvent(c('MNBotsLoggerEvents').BOT_COMPOSER_MENU_ICON_TAPPED).setPageID(this.props.pageID).log();return (c('React').createElement('ul',null,c('React').createElement('li',{className:"_1wc4 _1wca",key:'header'},c('React').createElement('div',{className:"_1wc8"},i._("Menu"))),this.state.ctas?this.renderMenuRow(this.state.ctas,m.length):null));}});f.exports=k;}),null);