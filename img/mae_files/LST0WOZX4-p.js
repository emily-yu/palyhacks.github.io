if (self.CavalryLogger) { CavalryLogger.start_js(["suToT"]); }

__d("MessagingRealtimeConstants",[],(function a(b,c,d,e,f,g){f.exports={VIEWER_FBID:"realtime_viewer_fbid"};}),null);
__d("RTCCallActionTypes",[],(function a(b,c,d,e,f,g){f.exports={INCOMING_CALL_SUCCESS:"INCOMING_CALL_SUCCESS",REMOTE_VIDEO_UNMUTED:"REMOTE_VIDEO_UNMUTED",REMOTE_VIDEO_MUTED:"REMOTE_VIDEO_MUTED"};}),null);
__d("RTCGroupCallActionTypes",[],(function a(b,c,d,e,f,g){f.exports={CALL:"CALL",CALL_SUCCESS:"CALL_SUCCESS",CALL_ERROR:"CALL_ERROR",INIT:"INIT",WAIT_FOR_USER_INPUT:"WAIT_FOR_USER_INPUT",SET_CALL_SUMMARY:"SET_CALL_SUMMARY",JOIN:"JOIN",JOIN_SUCCESS:"JOIN_SUCCESS",JOIN_ERROR:"JOIN_ERROR",HANGUP:"HANGUP",HANGUP_SUCCESS:"HANGUP_SUCCESS",HANGUP_ERROR:"HANGUP_ERROR",ADD_PARTICIPANTS:"ADD_PARTICIPANTS",ON_CONFERENCE_STATE:"ON_CONFERENCE_STATE",DISMISS:"DISMISS",END_CALL:"END_CALL",ON_JOIN_RESPONSE:"ON_JOIN_RESPONSE",ON_CLIENT_MEDIA_UPDATE_RESPONSE:"ON_CLIENT_MEDIA_UPDATE_RESPONSE",INIT_LOCAL_USER:"INIT_LOCAL_USER",INIT_REMOTE_USERS:"INIT_REMOTE_USERS",ADD_REMOTE_STREAM:"ADD_REMOTE_STREAM",REMOVE_REMOTE_STREAM:"REMOVE_REMOTE_STREAM",REMOVE_ALL_REMOTE_STREAMS:"REMOVE_ALL_REMOTE_STREAMS",ADD_REMOTE_TRACK:"ADD_REMOTE_TRACK",REMOVE_REMOTE_TRACK:"REMOVE_REMOTE_TRACK",AUDIO_MUTED:"AUDIO_MUTED",AUDIO_UNMUTED:"AUDIO_UNMUTED",VIDEO_MUTED:"VIDEO_MUTED",VIDEO_UNMUTED:"VIDEO_UNMUTED",SELF_VIEW_COLLAPSED:"SELF_VIEW_COLLAPSED",SELF_VIEW_UNCOLLAPSED:"SELF_VIEW_UNCOLLAPSED",ADD_LOCAL_STREAM:"ADD_LOCAL_STREAM",REMOVE_LOCAL_STREAM:"REMOVE_LOCAL_STREAM",REMOVE_ALL_LOCAL_STREAMS:"REMOVE_ALL_LOCAL_STREAMS",ADD_LOCAL_SCREEN_STREAM:"ADD_LOCAL_SCREEN_STREAM",REMOVE_LOCAL_SCREEN_STREAM:"REMOVE_LOCAL_SCREEN_STREAM",REMOVE_ALL_LOCAL_SCREEN_STREAMS:"REMOVE_ALL_LOCAL_SCREEN_STREAMS",ADD_REMOTE_SCREEN_STREAM:"ADD_REMOTE_SCREEN_STREAM",REMOVE_REMOTE_SCREEN_STREAM:"REMOVE_REMOTE_SCREEN_STREAM",TOGGLE_REMOTE_STREAM:"TOGGLE_REMOTE_STREAM",SUBMIT_RATING:"SUBMIT_RATING",SUBMIT_FEEDBACK:"SUBMIT_FEEDBACK",RATING_SHOWN:"RATING_SHOWN",FEEDBACK_SHOWN:"FEEDBACK_SHOWN"};}),null);
__d("RTCP2PCallActionTypes",[],(function a(b,c,d,e,f,g){f.exports={POP_IN_SCREEN_CONTENT:"POP_IN_SCREEN_CONTENT",POP_OUT_SCREEN_CONTENT:"POP_OUT_SCREEN_CONTENT",SET_CALL_TYPE:"SET_CALL_TYPE",SET_CONNECTION_STATUS:"SET_CONNECTION_STATUS",SET_END_CALL_REASON:"SET_END_CALL_REASON",SET_REMOTE_SIGNALING_EXPERIMENTS:"SET_REMOTE_SIGNALING_EXPERIMENTS"};}),null);
__d('AjaxRequest',['ErrorUtils','Keys','PHPQuerySerializer','TimeSlice','URI','UserAgent_DEPRECATED','ZeroRewrites','setTimeoutAcrossTransitions'],(function a(b,c,d,e,f,g){function h(l,m,n){if(!(m instanceof c('URI')))m=new (c('URI'))(m);this.xhr=c('ZeroRewrites').getTransportBuilderForURI(m)();if(n&&l=='GET'){m.setQueryData(n);}else this._params=n;this.method=l;this.uri=m;this.xhr.open(l,m);}var i=window.XMLHttpRequest&&'withCredentials' in new XMLHttpRequest();h.supportsCORS=function(){return i;};h.ERROR='ar:error';h.TIMEOUT='ar:timeout';h.PROXY_ERROR='ar:proxy error';h.TRANSPORT_ERROR='ar:transport error';h.SERVER_ERROR='ar:http error';h.PARSE_ERROR='ar:parse error';h.SERVICE_UNAVAILABLE='ar:noservice';h._inflight=[];function j(){var l=h._inflight;h._inflight=[];l.forEach(function(m){m.abort();});}function k(l){l.onJSON=l.onError=l.onSuccess=null;clearTimeout(l._timer);if(l.xhr&&l.xhr.readyState<4){l.xhr.abort();l.xhr=null;}h._inflight=h._inflight.filter(function(m){return m&&m!=l&&m.xhr&&m.xhr.readyState<4;});}Object.assign(h.prototype,{timeout:60000,streamMode:true,prelude:/^for \(;;\);/,status:null,_eol:-1,_call:function l(m){if(this[m])this[m](this);},_parseStatus:function l(){var m;try{this.status=this.xhr.status;m=this.xhr.statusText;}catch(n){if(this.xhr.readyState>=4){this.errorType=h.TRANSPORT_ERROR;this.errorText=n.message;}return;}if(this.status===0&&!/^(file|ftp)/.test(this.uri)){this.errorType=h.TRANSPORT_ERROR;}else if(this.status>=100&&this.status<200){this.errorType=h.PROXY_ERROR;}else if(this.status>=200&&this.status<300){return;}else if(this.status>=300&&this.status<400){this.errorType=h.PROXY_ERROR;}else if(this.status>=400&&this.status<500){this.errorType=h.SERVER_ERROR;}else if(this.status===503){this.errorType=h.SERVICE_UNAVAILABLE;}else if(this.status>500&&this.status<600){this.errorType=h.PROXY_ERROR;}else if(this.status==1223){return;}else if(this.status>=12001&&this.status<=12156){this.errorType=h.TRANSPORT_ERROR;}else{m='unrecognized status code: '+this.status;this.errorType=h.ERROR;}if(!this.errorText)this.errorText=m;},_parseResponse:function l(){var m,n=this.xhr.readyState;try{m=this.xhr.responseText||'';}catch(o){if(n>=4){this.errorType=h.ERROR;this.errorText='responseText not available - '+o.message;}return;}while(this.xhr){var p=this._eol+1,q=this.streamMode?m.indexOf('\n',p):m.length;if(q<0&&n==4)q=m.length;if(q<=this._eol)break;var r=m;if(this.streamMode)r=m.substr(p,q-p).replace(/^\s*|\s*$/g,'');if(p===0&&this.prelude)if(this.prelude.test(r))r=r.replace(this.prelude,'');this._eol=q;if(r){try{this.json=JSON.parse(r);}catch(o){var s=/(<body[\S\s]+?<\/body>)/i.test(m)&&RegExp.$1,t={message:o.message,'char':p,excerpt:(p===0&&s||r).substr(512)};this.errorType=h.PARSE_ERROR;this.errorText='parse error - '+JSON.stringify(t);return;}c('ErrorUtils').applyWithGuard(this._call,this,['onJSON']);}}},_onReadyState:function l(m,n){var o=this.xhr&&this.xhr.readyState||0;if(this.status==null&&o>=2)this._parseStatus();if(!this.errorType&&this.status!=null)if(o==3&&this.streamMode||o==4)m.call(this);if(this.errorType||o==4){this._time=Date.now()-this._sentAt;n.call(this,this._call,!this.errorType?'onSuccess':'onError');k(this);}},send:function l(m){var n=c('TimeSlice').getGuardedContinuation('AjaxRequest xhr.onreadystatechange',true),o=c('TimeSlice').guard(this._parseResponse.bind(this),'AjaxRequest xhr.parseResponse',{isContinuation:false});this.xhr.onreadystatechange=this._onReadyState.bind(this,o,n);var p=this.timeout;if(p)this._timer=c('setTimeoutAcrossTransitions')(function(){this.errorType=h.TIMEOUT;this.errorText='timeout';this._time=Date.now()-this._sentAt;this._call('onError');k(this);}.bind(this),p);h._inflight.push(this);if(this.method=='POST')this.xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');this._sentAt=Date.now();this.xhr.send(m?c('PHPQuerySerializer').serialize(m):'');},abort:function l(){k(this);},toString:function l(){var m='[AjaxRequest readyState='+this.xhr.readyState;if(this.errorType)m+=' errorType='+this.errorType+' ('+this.errorText+')';return m+']';},toJSON:function l(){var m={json:this.json,status:this.status,errorType:this.errorType,errorText:this.errorText,time:this._time};if(this.errorType)m.uri=this.uri;for(var n in m)if(m[n]==null)delete m[n];return m;}});if(window.addEventListener&&c('UserAgent_DEPRECATED').firefox())window.addEventListener('keydown',function(event){if(event.keyCode===c('Keys').ESC)event.prevent();},false);if(window.attachEvent)window.attachEvent('onunload',j);f.exports=h;}),null);
__d("ChannelClientID",[],(function a(b,c,d,e,f,g){var h=(Math.random()*2147483648|0).toString(16),i={getID:function j(){return h;}};f.exports=i;}),null);
__d('ChannelSubdomain',['Event','JSLogger','Run','LogHistory','setTimeoutAcrossTransitions','WebStorage'],(function a(b,c,d,e,f,g){var h=c('LogHistory').getInstance('channel'),i=c('JSLogger').create('channel'),j='channel_sub:',k=7,l=100*1000,m=null,n;function o(){var q=c('WebStorage').getLocalStorage();if(n){clearTimeout(n);n=null;}if(q&&m!=null)q.removeItem(j+m);m=null;}function p(q,r,s){var t,u=(q-1)*k;if(s){if(n)clearTimeout(n);m=n=null;}if(r==null)r=Math.floor(Math.random()*u);if(m==null){var v,w,x,y,z,aa,ba;(function(){var ca=c('WebStorage').getLocalStorage();if(ca){v=[];for(w=0;w<ca.length;w++){x=ca.key(w);if(x.indexOf(j)===0){y=parseInt(x.substr(j.length),10);v[y]=parseInt(ca.getItem(x),10);}}z=Date.now()-l;for(w=0;w<u;w++){aa=(w+r)%u;if(!v[aa]||v[aa]<z){m=aa;break;}}if(m!=null){ba=function da(){try{ca.setItem(j+m,Date.now());}catch(ea){h.warn('subdomain set failed',ea.message);}n=c('setTimeoutAcrossTransitions')(ba,l/2);};ba();}else{h.warn('no channel subdomain',v);i.error('subdomain_overflow');}if(typeof window.onpageshow!='undefined'){c('Event').listen(window,'pagehide',o);}else c('Run').onUnload(o);}else m=r;})();}return m==null?null:m%k;}f.exports={allocate:p,clear:o};}),null);
__d('DocRPC',['ErrorUtils'],(function a(b,c,d,e,f,g){var h={_apis:{},_dispatch:function i(j){var k;try{j=JSON.parse(j);}catch(l){throw new Error('DocRPC unparsable dispatch: "'+j+'"');}if(h._apis.hasOwnProperty(j.api)){var m=h._apis[j.api];if(m[j.method])k=c('ErrorUtils').applyWithGuard(m[j.method],m,j.args);}if(k===undefined)k=null;return JSON.stringify(k);},publish:function i(j,k){h._apis[k]=j;},proxy:function i(j,k,l){var i={};l.forEach(function(m){i[m]=function(){var n={api:k,method:m,args:Array.prototype.slice.call(arguments)},o;try{if(j.closed)throw new Error('DocRPC window closed');o=j.DocRPC._dispatch(JSON.stringify(n));}catch(p){c('ErrorUtils').reportError(p);return;}if(typeof o=='string')try{o=JSON.parse(o);}catch(p){throw new Error('DocRPC '+k+'.'+m+' unparsable return: "'+o+'"');}return o;};});return i;}};f.exports=b.DocRPC=h;}),null);
__d('ChannelTransport',['AjaxRequest','ChannelConstants','DocRPC','LogHistory','TimeSlice','URI','bind','setTimeoutAcrossTransitions','BanzaiODS'],(function a(b,c,d,e,f,g){var h=c('LogHistory').getInstance('channel');function i(){return (1048576*Math.random()|0).toString(36);}function j(u){return !isNaN(u)&&isFinite(u)&&0<=u&&u<=6;}function k(u,v){var w='';if(j(u.subdomain))w=u.subdomain+'-';var x=u.host;x=x===null||x===undefined?'edge-chat':u.host;var y=new (c('URI'))(v).setDomain(w+x+'.'+u.domain).setPort(u.port).setSecure(new (c('URI'))(window.location.href).isSecure());return y;}function l(u){var v={partition:u.partition,cb:i(),failure:u.pingFailuresOnSubdomain};if(u.sticky_token)v.sticky_token=u.sticky_token;if(u.sticky_pool)v.sticky_pool=u.sticky_pool;var w=k(u,'/p').setQueryData(v);h.log('start_p',{uri:w.toString()});var x=new (c('AjaxRequest'))('GET',w);if(c('AjaxRequest').supportsCORS())x.xhr.withCredentials=true;var y=function z(aa){h.log('finish_p',{xhr:aa.toJSON?aa.toJSON():aa,subdomain:u.subdomain,fullHost:u.fullHost});};x.onError=function(z){c('BanzaiODS').bumpEntityKey('ChannelTransport','sendP.error');y(z);if(u.subdomain===null)return;if(j(u.subdomain)){u.pingFailuresOnSubdomain++;u.subdomain++;if(u.subdomain>6)u.subdomain=0;}};x.timeout=u.P_TIMEOUT;x.onSuccess=function(z){c('BanzaiODS').bumpEntityKey('ChannelTransport','sendP.success');y(z);};x.send();}function m(u,v,w){var x=new Image(),y=0,z=function ca(da){x.abort();return da?v():w();};x.onload=c('TimeSlice').guard(function(){h.log('ping_ok',{duration:Date.now()-y});c('BanzaiODS').bumpEntityKey('ChannelTransport','sendPing.success');z(true);},'ChannelTransport image.onload');x.onerror=c('TimeSlice').guard(function(){l(u);c('BanzaiODS').bumpEntityKey('ChannelTransport','sendPing.error');z(false);},'ChannelTransport image.onerror');var aa=c('setTimeoutAcrossTransitions')(x.onerror,10000);x.abort=function(){if(aa){clearTimeout(aa);aa=null;}x.onload=x.onerror=null;};var ba={partition:u.partition,cb:i()};if(u.sticky_token)ba.sticky_token=u.sticky_token;if(u.sticky_pool)ba.sticky_pool=u.sticky_pool;if(u.lastRequestErrorReason){ba.reason=u.lastRequestErrorReason;u.lastRequestErrorReason=null;}if(u.uid&&u.viewerUid){ba.uid=u.uid;ba.viewer_uid=u.viewerUid;}y=Date.now();x.src=k(u,'/ping').setQueryData(ba);return x;}function n(u,v){var w={channel:u.user_channel,partition:u.partition,clientid:u.sessionID,cb:i(),cap:0,uid:u.uid,viewer_uid:u.viewerUid};if(u.sticky_token)w.sticky_token=u.sticky_token;if(u.sticky_pool)w.sticky_pool=u.sticky_pool;if(u.profile)w.profile=u.profile;if(u.capabilities)w.cap=u.capabilities;w.id=v;var x=k(u,'/add_bud').setQueryData(w),y=new (c('AjaxRequest'))('GET',x);if(c('AjaxRequest').supportsCORS())y.xhr.withCredentials=true;y.onError=function(z){c('BanzaiODS').bumpEntityKey('ChannelTransport','sendAdditionalBuddy.error');h.warn('add_buddy_error');};y.onSuccess=function(z){c('BanzaiODS').bumpEntityKey('ChannelTransport','sendAdditionalBuddy.success');h.log('add_buddy_ok');};y.timeout=u.P_TIMEOUT;y.send();}function o(u){var v={channel:u.user_channel,partition:u.partition,clientid:u.sessionID,cb:i(),cap:0,uid:u.uid,viewer_uid:u.viewerUid};if(u.sticky_token)v.sticky_token=u.sticky_token;if(u.sticky_pool)v.sticky_pool=u.sticky_pool;if(u.is_offline||u.shouldSuppressPresence){v.state='offline';}else v.state='active';if(v.state===u.lastPresenceState)return;u.lastPresenceState=v.state;if(u.profile)v.profile=u.profile;if(u.capabilities)v.cap=u.capabilities;var w=k(u,'/active_ping').setQueryData(v),x=new (c('AjaxRequest'))('GET',w);if(c('AjaxRequest').supportsCORS())x.xhr.withCredentials=true;x.onError=function(y){c('BanzaiODS').bumpEntityKey('ChannelTransport','sendActivePing.error');h.warn('active_ping_error');};x.onSuccess=function(y){c('BanzaiODS').bumpEntityKey('ChannelTransport','sendActivePing.success');h.log('active_ping_ok');};x.timeout=u.P_TIMEOUT;x.send();}function p(u,v,w,x){var y=new Date(),z=-1;if(u.userActive>0){z=(y-u.userActive)/1000|0;if(z<0)h.warn('idle_regression',{idleTime:z,now:y.getTime(),userActive:u.userActive});}var aa={channel:u.user_channel,seq:u.seq,partition:u.partition,clientid:u.sessionID,cb:i(),idle:z,qp:'y',cap:0};if(u.state.aiq)aa.aiq=u.state.aiq;if(u.ready)if(u.seqTurSentAt==-1||u.seqTurSentAt==u.seq){aa.tur=u.timeUntilReady;aa.qpmade=u.queueMade;u.seqTurSentAt=u.seq;}aa.pws=u.pws;if(u.sequenceId>0)aa.isq=u.sequenceId;aa.msgs_recv=u.estimatedReceived;if(u.uid&&u.viewerUid){aa.uid=u.uid;aa.viewer_uid=u.viewerUid;}if(u.sticky_token){aa.sticky_token=u.sticky_token;}else{aa.request_batch=1;if(u.msgr_region)aa.msgr_region=u.msgr_region;}if(u.sticky_pool)aa.sticky_pool=u.sticky_pool;if('trace_id' in u)aa.traceid=u.trace_id;if(u.is_offline||u.shouldSuppressPresence){aa.state='offline';}else if(u.userActive>0&&z<60)aa.state='active';u.lastPresenceState=aa.state;if(u.streamingCapable){aa.mode='stream';aa.format='json';}if(u.profile)aa.profile=u.profile;if(u.capabilities)aa.cap=u.capabilities;var ba=k(u,'/pull').setQueryData(aa),ca='GET',da=new (c('AjaxRequest'))(ca,ba);if(c('AjaxRequest').supportsCORS())da.xhr.withCredentials=true;da.timeout=u.streamingCapable?u.STREAMING_TIMEOUT:u.LONGPOLL_TIMEOUT;da.onJSON=function(ea){c('BanzaiODS').bumpEntityKey('ChannelTransport','sendPull.json');v(ea);};da.onSuccess=function(ea){c('BanzaiODS').bumpEntityKey('ChannelTransport','sendPull.success');w(ea);};da.onError=function(){var ea=this.status==12002&&this._time>=u.MIN_12002_TIMEOUT||this.status==504&&this._time>=u.MIN_504_TIMEOUT,fa=ea?w:x;if(ea){c('BanzaiODS').bumpEntityKey('ChannelTransport','sendPull.success');}else c('BanzaiODS').bumpEntityKey('ChannelTransport','sendPull.error');return fa&&fa.apply(this,arguments);};da.send();u.inStreaming=u.streamingCapable;return da;}function q(u){this.manager=u;this.init&&this.init();}function r(u){q.apply(this,arguments);}Object.assign(r.prototype,{logName:'CORS',enterState:function u(v,w){if(this._request){this._request.abort();this._request=null;}if(v=='init')c('setTimeoutAcrossTransitions')(c('bind')(this.manager,'exitState',{status:c('ChannelConstants').OK,stateId:w.stateId}),0);if(!/pull|ping/.test(v))return;var x=this.manager;if(v=='ping'){this._request=m(w,c('bind')(x,'exitState',{status:c('ChannelConstants').OK,stateId:w.stateId}),c('bind')(x,'exitState',{status:c('ChannelConstants').ERROR,stateId:w.stateId}));}else if(v=='pull')this._request=p(w,c('bind')(x,'_processTransportData',w.stateId),c('bind')(x,'exitState',{status:c('ChannelConstants').OK,stateId:w.stateId}),c('bind')(x,'exitState',{status:c('ChannelConstants').ERROR,stateId:w.stateId}));}});function s(u){h.log('iframe_init_constructor');q.apply(this,arguments);this._iframe=document.createElement('iframe');this._iframe.style.display='none';document.body.appendChild(this._iframe);c('DocRPC').publish(this,'outerTransport');}Object.assign(s.prototype,{logName:'iframe',_initIframe:function u(v){h.log('iframe_init_start');window.onchanneliframeready=function(){h.log('iframe_resources');return v.resources;};window.onchanneliframeloaded=function(){h.log('iframe_loaded');};if(v){this._iframeURI=k(v,v.path);if(v.resources){var w=this._iframeURI.getDomain();v.resources=v.resources.map(function(y){var z=new (c('URI'))(y);if(z.getPath().startsWith('/intern/rsrc.php')&&z.getQueryData().origin!==undefined)return z.addQueryData('origin',w).toString();return y;});}}else this._iframeURI='about:blank';this._iframeProxy=null;try{this._iframe.contentWindow.location.replace(this._iframeURI);h.log('iframe_uri_set');}catch(x){h.error('iframe_uri_set_error',x);this.exitState({status:c('ChannelConstants').ERROR,stateId:v.stateId},x+'');}},enterState:function u(v,w){if(v=='init'){this._initIframe(w);}else if(/idle|ping|pull/.test(v)){if(this._iframeProxy){this._iframeProxy.enterState.apply(this._iframeProxy,arguments);}else if(v!='idle')this.exitState({status:c('ChannelConstants').ERROR,stateId:w.stateId},'iframe not yet loaded');}else if(v=='shutdown')this._initIframe();},_processTransportData:function u(){this.manager._processTransportData.apply(this.manager,arguments);},exitState:function u(v){if(this.manager.state=='init'&&v.status==c('ChannelConstants').OK)this._iframeProxy=c('DocRPC').proxy(this._iframe.contentWindow,'innerTransport',['enterState'],(this._iframeURI+'').replace(/iframe.*/,''));if(/ping|pull/.test(this.manager.state)&&!this._iframeProxy)return;this.manager.exitState.apply(this.manager,arguments);}});function t(){this.init=this.init.bind(this);q.apply(this,arguments);}Object.assign(t.prototype,{logName:'iframe(inner)',init:function u(){c('DocRPC').publish(this,'innerTransport');try{var w=c('DocRPC').proxy(window.parent,'outerTransport',['_processTransportData','exitState'],top.DocRPC.origin);Object.assign(this,w);this.exitState({status:c('ChannelConstants').OK,stateId:1e+06});}catch(v){h.error('iframe_inner_init_error',v);}},enterState:function u(v,w){if(this._request){this._request.abort();this._request=null;}if(v=='ping'){this._request=m(w,c('bind')(this,'exitState',{status:c('ChannelConstants').OK,stateId:w.stateId}),c('bind')(this,'exitState',{status:c('ChannelConstants').ERROR,stateId:w.stateId}));}else if(v=='pull')this._request=p(w,c('bind')(this,'_processTransportData',w.stateId),c('bind')(this,'exitState',{status:c('ChannelConstants').OK,stateId:w.stateId}),c('bind')(this,'exitState',{status:c('ChannelConstants').ERROR,stateId:w.stateId}));}});f.exports={isSubdomain:j,getURI:k,Transport:q,CORSTransport:r,IframeTransport:s,IframeInnerTransport:t,sendActivePing:o,sendAdditionalBuddyRequest:n};}),null);
__d('ChannelTransportDataLogger',['Arbiter','JSLogger','MercuryLoggingHelper'],(function a(b,c,d,e,f,g){'use strict';var h=[],i=10,j=function l(m){return m.map(function(n){var o=n;if(n.message||n.delta&&n.delta.body){o=babelHelpers['extends']({},n);if(n.message)o.message=c('MercuryLoggingHelper').obfuscateMessage(n.message);if(n.delta&&n.delta.body)o.delta=c('MercuryLoggingHelper').obfuscateMessage(n.delta);}return o;});},k={log:function l(m){var n={t:m.t,seq:m.seq};if(m.ms)n.ms=j(m.ms);h.push(n);if(h.length>i)h.shift();}};c('Arbiter').subscribe(c('JSLogger').DUMP_EVENT,function(l,m){m.channelTransportLog=h;});f.exports=k;}),null);
__d('ChatProxyConnectionState',[],(function a(b,c,d,e,f,g){'use strict';function h(){this.auxiliaryIrisQueues={};this.aiq=null;}h.prototype.subscribeIrisQueue=function(i,j){this.auxiliaryIrisQueues[i]=j;this.updateCaches();};h.prototype.unsubscribeIrisQueue=function(i){delete this.auxiliaryIrisQueues[i];this.updateCaches();};h.prototype.updateCaches=function(){var i=[];for(var j in this.auxiliaryIrisQueues)if(this.auxiliaryIrisQueues.hasOwnProperty(j)){i.push(j);i.push(this.auxiliaryIrisQueues[j]);}if(i.length===0){this.aiq=null;}else this.aiq=i.join(',');};f.exports=h;}),null);
__d('FBAjaxRequest',['AjaxRequest','getAsyncParams'],(function a(b,c,d,e,f,g){function h(i,j,k){k=babelHelpers['extends']({},c('getAsyncParams')(i),k);var l=new (c('AjaxRequest'))(i,j,k);l.streamMode=false;var m=l._call;l._call=function(n){if(n=='onJSON'&&this.json){if(this.json.error){this.errorType=c('AjaxRequest').SERVER_ERROR;this.errorText='AsyncResponse error: '+this.json.error;}this.json=this.json.payload;}m.apply(this,arguments);};l.ajaxReqSend=l.send;l.send=function(n){this.ajaxReqSend(babelHelpers['extends']({},n,k));};return l;}f.exports=h;}),null);
__d('FantailLogger',['FantailConfig'],(function a(b,c,d,e,f,g){var h=c('FantailConfig').FantailLogQueue,i={debug:function j(k,l){var m;for(var n=arguments.length,o=Array(n>2?n-2:0),p=2;p<n;p++)o[p-2]=arguments[p];h&&(m=h.get(k)).debug.apply(m,[l].concat(o));},info:function j(k,l){var m;for(var n=arguments.length,o=Array(n>2?n-2:0),p=2;p<n;p++)o[p-2]=arguments[p];h&&(m=h.get(k)).info.apply(m,[l].concat(o));},warn:function j(k,l){var m;for(var n=arguments.length,o=Array(n>2?n-2:0),p=2;p<n;p++)o[p-2]=arguments[p];h&&(m=h.get(k)).warn.apply(m,[l].concat(o));},error:function j(k,l){var m;for(var n=arguments.length,o=Array(n>2?n-2:0),p=2;p<n;p++)o[p-2]=arguments[p];h&&(m=h.get(k)).error.apply(m,[l].concat(o));}};f.exports=i;}),null);
__d("MovingStat",[],(function a(b,c,d,e,f,g){function h(i){i=i||60000;var j={t:new Date(),count:0,v:0},k=j,l=0,m=0;function n(){var o=new Date()-i;while(k&&k.next&&k.t<o){l-=k.v;m-=k.count;k=k.next;}}this.add=function(o){l+=o;m++;var p=new Date();if(p-j.t<1000){j.v+=o;j.count++;}else{j.next={t:p,v:o,count:1};j=j.next;n();}};this.tally=function(o){o=o||1000;n();return {sum:l,count:m,timeAverage:l*o/i};};}f.exports=h;}),null);
__d('RTISession',['invariant','URI','AjaxRequest','ErrorUtils'],(function a(b,c,d,e,f,g,h){'use strict';var i='.facebook.com';function j(k,l,m,n,o,p,q,r,s){k||h(0);n||h(0);o||h(0);this.domain=k;this.port=l;this.edgePoolName=m;this.stickyToken=n;this.loggedInId=o;this.accountId=p;this.clientProfile=q||'desktop';this.clientId=r;this.capabilities=s;}j.prototype.issueRequest=function(k,l,m,n,o){k||h(0);l||h(0);n||h(0);var p=this.domain.length-i.length,q=p>0&&this.domain.indexOf(i,p)!==-1,r=q?this.domain:this.domain+i,s=(1048576*Math.random()|0).toString(36),t={cb:s,sticky_token:this.stickyToken,uid:this.loggedInId,viewer_uid:this.accountId,sticky_pool:this.edgePoolName,profile:this.clientProfile,clientid:this.clientId,cap:this.capabilities};for(var u in t)!l[u]||h(0);Object.assign(t,l);var v=new (c('URI'))(k).setDomain(r).setPort(this.port).setSecure(new (c('URI'))(window.location.href).isSecure()).setQueryData(t),w=m?'POST':'GET',x=new (c('AjaxRequest'))(w,v);x.timeout=o?o*1000:30000;if(x.xhr)x.xhr.withCredentials=true;var y={};x.onSuccess=function(){};x.onJSON=function(){y.data=x.json;y.error=null;c('ErrorUtils').applyWithGuard(n,this,[y]);}.bind(this);x.onError=function(){y.data=null;y.error=x.errorType||'error';c('ErrorUtils').applyWithGuard(n,this,[y]);}.bind(this);x.send(JSON.stringify(m));};f.exports=j;}),null);
__d('ChannelManager',['errorCode','Promise','AjaxRequest','Arbiter','AsyncRequest','BanzaiODS','ChannelClientID','ChannelConstants','ChannelInitialData','ChannelSubdomain','ChannelTransport','ChannelTransportDataLogger','ChatVisibility','ChatReliabilityInstrumentation','DTSG','Env','FantailLogger','FBAjaxRequest','FBRTCSupport','ISB','JSLogger','LogHistory','MessagingRealtimeConstants','MovingStat','PresenceCookieManager','PresenceState','PresenceUtil','RTISession','SystemEvents','URI','UserActivity','ChatProxyConnectionState','emptyFunction','requestAnimationFrameAcrossTransitions','setIntervalAcrossTransitions','setTimeoutAcrossTransitions'],(function a(b,c,d,e,f,g,h){var i,j=c('JSLogger').create('channel'),k=c('LogHistory').getInstance('channel_manager'),l=null,m=c('emptyFunction'),n=new (c('Promise'))(function(z,aa){m=z;});function o(z){l=z;}var p={idle:{ok:'init!'},init:{ok:'pull!',error:'reconnect',sys_online:'init',sys_timetravel:'init'},pull:{ok:'pull!',error:'ping',error_missing:'pull',error_msg_type:'pull',refresh_0:'reconnect',refresh_110:'reconnect',refresh_111:'reconnect',refresh_112:'pull',refresh_113:'pull',refresh_117:'reconnect'},ping:{ok:'pull!',error:'ping',error_stale:'reconnect!'},reconnect:{ok:'init!',error:'reconnect',sys_online:'reconnect',sys_timetravel:'reconnect'},shutdown:{},_all:{error_max:'shutdown!',error_shutdown:'shutdown!',sys_owner:'reconnect',sys_nonowner:'idle!',sys_online:'ping',sys_offline:'idle!',sys_timetravel:'ping'}},q={state:new (c('ChatProxyConnectionState'))(),userActive:Date.now(),created:Date.now(),ready:false,seqTurSentAt:-1,queueMade:'',sequenceId:0,lastPresenceState:null,lastRequestErrorReason:null,seq:0,pingFailuresOnSubdomain:0,pws:'fresh',estimatedReceived:0,sessionID:c('ChannelClientID').getID(),capabilities:c('FBRTCSupport').getCapabilities(),streamingCapable:false,inStreaming:false,shouldSuppressPresence:c('PresenceState').shouldSuppress(),LONGPOLL_TIMEOUT:60000,STREAMING_TIMEOUT:60000,P_TIMEOUT:30000,IFRAME_LOAD_TIMEOUT:30000,MIN_RETRY_INTERVAL:5000,MAX_RETRY_INTERVAL:320000,MIN_12002_TIMEOUT:9000,MIN_504_TIMEOUT:20000,STALL_THRESHOLD:180000,JUMPSTART_THRESHOLD:90000,MIN_INIT_PROBE_DELAY:3000,INIT_PROBE_DELAY_RANDOMIZE_RANGE:12000,CHANNEL_PROXY_REPORTING_MIN_INTERVAL:10000,PROBE_DELAY:60000,PROBE_HEARTBEATS_INTERVAL_LOW:1000,PROBE_HEARTBEATS_INTERVAL_HIGH:5000,STREAMING_EXIT_STATE_ON_CONTINUE:false},r=1,s={},t=0;function u(){return c('AsyncRequest').lastSuccessTime?Math.round((Date.now()-c('AsyncRequest').lastSuccessTime)/1000):-1;}function v(){var z={};if(i.getConfig('host'))z[i.getConfig('user_channel')]=i.getConfig('seq',0);return z;}function w(){var z=Date.now(),aa=Date.now(),ba={total:0},ca='idle',da=false;c('SystemEvents').subscribe([c('SystemEvents').USER,c('SystemEvents').ONLINE,c('SystemEvents').TIME_TRAVEL],function(ga,ha){x(true);aa=null;i.lastPullTime=Date.now();var ia;switch(ga){case c('SystemEvents').USER:ia=c('SystemEvents').isPageOwner()?c('ChannelConstants').SYS_OWNER:c('ChannelConstants').SYS_NONOWNER;break;case c('SystemEvents').ONLINE:ia=ha?c('ChannelConstants').SYS_ONLINE:c('ChannelConstants').SYS_OFFLINE;break;case c('SystemEvents').TIME_TRAVEL:if(q.skipTimeTravel)return;if(0<ha&&q.reduceTimeTravel){c('FantailLogger').warn(c('ChannelConstants').FANTAIL_SERVICE,'skipping time travel failure. %s',ha);return;}ia=c('ChannelConstants').SYS_TIMETRAVEL;break;}i.exitState({status:ia,stateId:r});});var ea=function ga(ha,ia){var ja=Date.now(),ka=null;if(ia){z=ja;ka=ia.nextState||ia.state;}else ka=ca;c('SystemEvents').checkTimeTravel();if(aa){var la=Math.round((ja-aa)/1000);if(la>0){ba[ca]=(ba[ca]||0)+la;ba.total+=la;}}ca=ka;aa=ja;if(!ha){ba.lastSuccessTime=u();ba.online=c('SystemEvents').isOnline();k.log('rollup',JSON.stringify(ba));}};c('Arbiter').subscribe(c('ChannelConstants').ON_ENTER_STATE,ea);c('setIntervalAcrossTransitions')(ea,60000);c('Arbiter').subscribe(c('JSLogger').DUMP_EVENT,function(ga,ha){ha.channelRollup=ba;});var fa=function ga(){if(i.isShutdown()||i.shouldIdle())return;c('SystemEvents').checkTimeTravel();var ha=Date.now()-(i.lastPullTime||c('Env').start);if(!da&&ha>q.STALL_THRESHOLD){var ia=u();k.error('stall',JSON.stringify({lastSuccessTime:ia,rollupState:ca}));c('ChatReliabilityInstrumentation').logCHANNEL_STALLED(ha.toString());da=true;}var ja=Date.now()-z;if(i.state=='pull'&&ja>q.JUMPSTART_THRESHOLD){z=null;k.warn('jumpstart',JSON.stringify({state:i.state,dormant:ja}));i.enterState('init');}};c('setIntervalAcrossTransitions')(fa,5000);}function x(z){if(z){t=0;s={};}else t++;}function y(z,aa){var ba=!c('AjaxRequest').supportsCORS()||q.forceIframe;if(!q.hasOwnProperty('host'))c('ChatReliabilityInstrumentation').logERROR('channel: no host in config');var ca=c('ChannelTransport').isSubdomain(q.subdomain);if(!ca||ba){q.fullHost=q.host;}else q.fullHost=q.subdomain+'-'+q.host;c('FantailLogger').info(c('ChannelConstants').FANTAIL_SERVICE,'received lb info: %s at seq: %s{%s} with '.concat('sticky: %s/%s, subdomain: %s, fullHost: %s, state: %s,').concat(' source: %s, args: %s'),q.sessionID,q.seq,q.sequenceId,q.sticky_token,q.sticky_pool,q.subdomain,q.fullHost,i.state,z,aa);}i={state:'idle',nextState:null,proxyDown:false,lastPullTime:Date.now(),lastReportOnMisguidedMsgTime:Date.now(),heartbeats:[],setTestCallback:o,backoff:false,sessionRegistered:false,init:function z(aa,ba){c('FantailLogger').info(c('ChannelConstants').FANTAIL_SERVICE,'initializing sessionid:%s at iris-seq:%s',q.sessionID,q.sequenceId);this.init=c('emptyFunction');c('Arbiter').subscribe(c('ChannelConstants').GET_RTI_SESSION_REQUEST,function(event,fa){this.informCurrentSession();}.bind(this));c('requestAnimationFrameAcrossTransitions')(function(){c('FantailLogger').info(c('ChannelConstants').FANTAIL_SERVICE,'using session id: %s at seq: %s {%s} with sticky: %s/%s',q.sessionID,q.seq,q.sequenceId,q.sticky_token,q.sticky_pool);c('UserActivity').subscribe(function(){var fa=c('ChannelTransport').getURI(q,'/U');c('FantailLogger').info(c('ChannelConstants').FANTAIL_SERVICE,'user activity sessionid: %s at seq: %s/{%s} '+'with sticky: %s/%s state: %s uri:%s',q.sessionID,q.seq,q.sequenceId,q.sticky_token,q.sticky_pool,i.state,fa);if(i.state=='pull'){q.userActive=Date.now();c('ChannelTransport').sendActivePing(q);}});});c('PresenceCookieManager').register('ch',v);var ca=this.getConfig('max_conn',2);q.subdomain=c('ChannelSubdomain').allocate(ca);if(!c('ChannelTransport').isSubdomain(q.subdomain)){c('FantailLogger').info(c('ChannelConstants').FANTAIL_SERVICE,'invalid subdomain from ChannelSubdomain: %s',q.subdomain);q.subdomain=null;}this._transportRate=new (c('MovingStat'))(30000);var da=c('AjaxRequest').supportsCORS()&&!q.forceIframe?'CORSTransport':'IframeTransport';this.transport=new (c('ChannelTransport')[da])(this);m(this.transport);if(aa)this.enterState(aa,ba);c('requestAnimationFrameAcrossTransitions')(function(){c('Arbiter').subscribe(c('JSLogger').DUMP_EVENT,function(event,fa){if(this._transportRate){fa.transportRate=this._transportRate.tally();fa.transportType=da;fa.transportVersion=2;}}.bind(this));w();}.bind(this));if(i.getConfig('tryStreaming')&&i.getConfig('fullHost')&&c('AjaxRequest').supportsCORS()&&!q.forceIframe){var ea=q.MIN_INIT_PROBE_DELAY+Math.random()*q.INIT_PROBE_DELAY_RANDOMIZE_RANGE;c('setTimeoutAcrossTransitions')(this._probeTest,ea);}},configure:function z(){for(var aa=arguments.length,ba=Array(aa),ca=0;ca<aa;ca++)ba[ca]=arguments[ca];k.log('configure',JSON.stringify(ba));ba.forEach(function(da){return Object.assign(q,da);});y('reconnect',JSON.stringify(ba));c('Arbiter').inform(c('ChannelConstants').ON_CONFIG,this);},getConfig:function z(aa,ba){return q.hasOwnProperty(aa)?q[aa]:ba;},getCompleteConfig:function z(){return q;},subscribeIrisQueue:function z(aa,ba){q.state.subscribeIrisQueue(aa,ba);this.exitState({status:c('ChannelConstants').OK,stateId:r});},unsubscribeIrisQueue:function z(aa){q.state.unsubscribeIrisQueue(aa);},informCurrentSession:function z(){var aa=null;if(this.sessionRegistered&&q&&q.fullHost&&q.sticky_token&&q.uid)aa=new (c('RTISession'))(q.fullHost,q.port,q.sticky_pool,q.sticky_token,q.uid,q.viewerUid,q.profile,q.sessionID,q.capabilities);c('Arbiter').inform(c('ChannelConstants').RTI_SESSION,aa);},isShutdown:function z(){return this.state=='shutdown';},shouldIdle:function z(){return !(c('SystemEvents').isPageOwner()&&c('SystemEvents').isOnline());},_sendIframeError:function z(aa){var ba=new (c('AsyncRequest'))().setURI('/ajax/presence/reconnect.php').setData({reason:aa,fb_dtsg:c('DTSG').getToken()}).setOption('suppressErrorHandlerWarning',true).setOption('retries',1).setMethod('GET').setReadOnly(true).setAllowCrossPageTransition(true);ba.specifiesWriteRequiredParams()&&ba.send();},_getDelay:function z(){var aa=Math.min(q.MIN_RETRY_INTERVAL*Math.pow(2,Math.max(0,t-1)),q.MAX_RETRY_INTERVAL);if(this.proxyDown&&'proxy_down_delay_millis' in q)aa=q.proxy_down_delay_millis;this.proxyDown=false;return Math.floor(aa*(1+Math.random()*.5));},resetDelay:function z(){x(true);},enterState:function z(){if(this._inEnterState){k.warn('enterstate_recursion',JSON.stringify({state:this.state,args:arguments}));c('ChatReliabilityInstrumentation').logERROR('enterstate_recursion');}this._inEnterState=true;try{this._enterState.apply(this,arguments);this._inEnterState=false;}catch(aa){this._inEnterState=false;throw aa;}},_enterState:function z(aa){var ba=this.backoff?this._getDelay():0;this.backoff=false;if(this.isShutdown()){c('FantailLogger').warn(c('ChannelConstants').FANTAIL_SERVICE,'not executing state due to shutdown mode: %s',aa);return;}if(aa!='idle!'&&this.shouldIdle()){c('FantailLogger').warn(c('ChannelConstants').FANTAIL_SERVICE,'forced idleness');return;}r++;q.stateId=r;clearTimeout(this._deferredTransition);this._deferredTransition=null;if(!this.transport){n.done(function(ha){return ha.enterState('idle');});c('ChatReliabilityInstrumentation').logERROR('called enterState '+aa+' before transport init');}else this.transport.enterState('idle');this.state='idle';this.nextState=null;if(/!$/.test(aa)){if(this._transportRate){var ca=this._transportRate.tally().timeAverage,da=i.getConfig('MAX_CHANNEL_STATES_PER_SEC',1);if(ca>=da){if(!this._throttled){this._throttled=true;k.warn('throttled','{}');}j.bump('throttle');ba=1000/da;}}}else if(!(/#$/.test(aa)))ba=this._getDelay();aa=aa.replace(/\W*$/,'');if(!p[aa]){c('FantailLogger').error(c('ChannelConstants').FANTAIL_SERVICE,'invalid state: %s',aa);throw new Error('invalid state:'+aa);}var ea=Array.from(arguments),fa;if(ba<=0){fa={state:aa};if(this._transportRate)this._transportRate.add(1);this.state=aa;var ga=this['_enter_'+this.state];if(ga){ea.shift();ga.apply(this,ea);}if(/init|idle|pull|ping/.test(this.state)){if(q.streamingCapable&&/pull/.test(this.state))this.heartbeats=[];q.is_offline=!c('ChatVisibility').isOnline();q.capabilities=c('FBRTCSupport').getCapabilities();c('FantailLogger').info(c('ChannelConstants').FANTAIL_SERVICE,'entering transport state: %s',this.state);if(!this.transport){n.done(function(ha){return ha.enterState(this.state,q);}.bind(this));c('ChatReliabilityInstrumentation').logERROR('called enterState '+aa+' before transport init');}else this.transport.enterState(this.state,q);if(this.state=='ping'){fa.url=c('ChannelTransport').getURI(q).toString();fa.port=q.port||'undefined';}}}else{this.state='idle';this.nextState=aa;fa={state:this.state,delay:ba,nextState:aa};ea[0]=aa+'#';this._deferredTransition=c('setTimeoutAcrossTransitions')(function(){this._deferredTransition=null;this.enterState.apply(this,ea);}.bind(this),ba);}if(/pull/.test(aa)){fa.client_id=q.sessionID;fa.streaming=q.inStreaming;}c('Arbiter').inform(c('ChannelConstants').ON_ENTER_STATE,fa);},exitState:function z(aa,ba){var ca=aa.stateId,da=aa.status;if(this.isShutdown()||ca<r)return;var ea=this.state,fa=Array.from(arguments);fa[0]=aa.status;var ga={state:ea,status:da};if(/pull/.test(ea)){ga.client_id=q.sessionID;ga.streaming=q.inStreaming;}if(/ping/.test(ea)&&da!=c('ChannelConstants').OK)ga.url=c('ChannelTransport').getURI(q).toString();if(this.nextState)ga.nextState=this.nextState;if(ba&&ba.errorType){q.lastRequestErrorReason=ba.errorType;ga.xhr=ba.toJSON?ba.toJSON():ba;if(ba.errorType==c('AjaxRequest').SERVICE_UNAVAILABLE){c('FantailLogger').error(c('ChannelConstants').FANTAIL_SERVICE,'got 5xx http status code, setting long delay');this.proxyDown=true;}delete ga.xhr.json;}else if(da!=c('ChannelConstants').OK)q.lastRequestErrorReason=da;if(ba&&ba.json){if(ba.json.t)ga.t=ba.json.t;if(ba.json.reason)ga.reason=ba.json.reason;if(ba.json.seq)ga.seq=ba.json.seq;}c('Arbiter').inform(c('ChannelConstants').ON_EXIT_STATE,ga);var ha=this['_exit_'+ea];if(ha)da=ha.apply(this,fa)||da;if(da!=c('ChannelConstants').OK){x();s[ea]=(s[ea]||0)+1;}var ia=p[this.nextState||ea][da]||p._all[da],ja=ia&&ia.replace(/!*$/,'');if(!ja){k.error('terminal_transition',JSON.stringify(ga));this._shutdownHint=c('ChannelConstants').HINT_INVALID_STATE;ia='shutdown!';c('FantailLogger').error(c('ChannelConstants').FANTAIL_SERVICE,'entering shutdown state');}this._lastState=ea;this._lastStatus=da;this.enterState(ia);},_processTransportData:function z(aa,ba){this._processTransportData0(aa,ba,ba.json);},_processTransportData0:function z(aa,ba,ca){var da=ca.t;if('s' in ca){ca.seq=ca.s;delete ca.s;}if(ca.u&&q.user&&ca.u!=q.user){k.warn('misguided_msg',JSON.stringify({user:q.user,target:ca.u}));this._reportProxyMisguidedMsg(ca.u,q.user);return;}c('ChannelTransportDataLogger').log(ca);var ea=q.seq;if('seq' in ca){q.seq=ca.seq;c('PresenceState').doSync();}switch(da){case 'continue':if(q.inStreaming&&this.heartbeats.length<1){q.streamingCapable=false;k.log('switch_to_longpoll','{}');c('setTimeoutAcrossTransitions')(this._probeTest,q.PROBE_DELAY);}x(true);if(!q.inStreaming||q.STREAMING_EXIT_STATE_ON_CONTINUE)this.exitState({status:c('ChannelConstants').OK,stateId:aa});break;case 'refresh':case 'refreshDelay':c('FantailLogger').info(c('ChannelConstants').FANTAIL_SERVICE,'got refresh with reason: %s',ca.reason);this.exitState({status:'refresh_'+(ca.reason||0),stateId:aa},ba);break;case 'backoff':c('FantailLogger').warn(c('ChannelConstants').FANTAIL_SERVICE,'server told client to back off');x();this.backoff=true;break;case 'lb':var fa=ca.lb_info;if(fa){q.sticky_token=fa.sticky;if('pool' in fa)q.sticky_pool=fa.pool;if('sd' in fa){var ga=fa.subdomain;if(c('ChannelTransport').isSubdomain(ga))q.subdomain=fa.subdomain;}if('vip' in fa)q.host=fa.vip;y('chatproxy',JSON.stringify(ca));}else k.error('missing_lb_info','{}');break;case 'test_streaming':c('setTimeoutAcrossTransitions')(this._probeTest,500);break;case 'fullReload':c('PresenceCookieManager').clear();k.log('full_reload','{}');this.sessionRegistered=true;this.informCurrentSession();c('Arbiter').inform(c('ChannelConstants').ON_INVALID_HISTORY);x(true);c('FantailLogger').info(c('ChannelConstants').FANTAIL_SERVICE,'full reload incurred');var ha=c('ChannelConstants').OK;this.exitState({status:ha,stateId:aa},ba);if('ms' in ca)this._processMessages(ca,ea);break;case 'msg':x(true);this._processMessages(ca,ea);break;case 'heartbeat':if(q.inStreaming){var ia=Date.now();if(this.heartbeats.length>0)var ja=ia-this.heartbeats[this.heartbeats.length-1];k.log('heartbeat_interval',JSON.stringify({client_id:q.sessionID,interval:ja}));this.heartbeats.push(ia);}break;case 'batched':var ka=ca.batches,la;for(la=0;la<ka.length;la++)this._processTransportData0(aa,ba,ka[la]);break;default:c('FantailLogger').error(c('ChannelConstants').FANTAIL_SERVICE,'got an unknown protocol message: %s',da);k.error('unknown_msg_type',JSON.stringify({type:da}));break;}},_processMessages:function z(aa,ba){var ca,da,ea,fa;if('tr' in aa)q.trace_id=aa.tr;da=aa.ms;ea=q.seq-da.length;for(ca=0;ca<da.length;ca++,ea++){q.estimatedReceived++;if(ea>=ba){fa=da[ca];if(fa.type){var ga=c('ChannelConstants').getArbiterType(fa.type);if(fa.type==='messaging'){var ha={type:'messaging',event:fa.event};if(fa.message){ha.inbox_unread=fa.unread_counts&&fa.unread_counts.inbox;ha.tid=fa.message.tid;ha.mid=fa.message.mid;c('FantailLogger').info(c('ChannelConstants').FANTAIL_SERVICE,'got message with id: %s',fa.message.mid);}}else if(fa.type==='pages_messaging'){if(fa.unread_counts&&fa.unread_counts.inbox)c('Arbiter').inform(c('ChannelConstants').getArbiterType('pages_inbox_count_update'),{page_id:fa[c('MessagingRealtimeConstants').VIEWER_FBID],inbox_unread:fa.unread_counts.inbox});}else if(fa.type==='skywalker'){ga=c('ChannelConstants').SKYWALKER;}else if(fa.type==='qprimer'){fa.first=!q.ready;if(fa.first){q.ready=true;q.timeUntilReady=Date.now()-q.created;q.queueMade=fa.made;}ga=c('ChannelConstants').CHANNEL_ESTABLISHED;}else if(fa.type==='pws'){q.pws=fa.pws;}else if(fa.type==='delta')q.sequenceId=fa.iseq;try{c('Arbiter').inform(ga,{obj:fa});}catch(ia){c('BanzaiODS').bumpEntityKey('ChannelManager','processMessages.error.'+fa.type);c('FantailLogger').info(c('ChannelConstants').FANTAIL_SERVICE,'message threw exception: %s %s',ia,fa);}}}else k.warn('seq_regression',JSON.stringify({last_seq:ba,messages:da.length,seq:ea}));}},_enter_init:function z(){if(s.init>=i.getConfig('MAX_INIT_FAILS',2))return c('setTimeoutAcrossTransitions')(function(){return this.exitState({status:c('ChannelConstants').ERROR_MAX,stateId:r});}.bind(this),0);this._initTimer=c('setTimeoutAcrossTransitions')(function(){return this.exitState({status:c('ChannelConstants').ERROR,stateId:r},'timeout');}.bind(this),q.IFRAME_LOAD_TIMEOUT);},_enter_reconnect:function z(aa){k.warn('enter_reconnect',aa);c('FantailLogger').info(c('ChannelConstants').FANTAIL_SERVICE,'entered reconnect with reason: %s',aa);var ba=r;if(!c('PresenceUtil').hasUserCookie()){c('FantailLogger').warn(c('ChannelConstants').FANTAIL_SERVICE,'user has no cookie???');k.warn('no_user_cookie','{}');c('setTimeoutAcrossTransitions')(function(){this._shutdownHint=c('ChannelConstants').HINT_AUTH;this.exitState({status:c('ChannelConstants').ERROR_SHUTDOWN,stateId:ba});}.bind(this),0);return;}var ca={reason:aa,fb_dtsg:c('DTSG').getToken()};if(c('ISB').token)ca.fb_isb=c('ISB').token;if(l)l(ca);var da=new (c('FBAjaxRequest'))('GET','/ajax/presence/reconnect.php',ca);da.onSuccess=function(){i.configure(da.json);c('PresenceCookieManager').store();this.exitState({status:c('ChannelConstants').OK,stateId:ba});}.bind(this);da.onError=function(){var ea=da.json&&da.json.error;c('FantailLogger').error(c('ChannelConstants').FANTAIL_SERVICE,'reconnect error: %s',da.errorType);if(da.errorType==c('AjaxRequest').TRANSPORT_ERROR||da.errorType==c('AjaxRequest').PROXY_ERROR||da.errorType==c('AjaxRequest').SERVICE_UNAVAILABLE)this._shutdownHint=c('ChannelConstants').HINT_CONN;if(ea&&ea==1356007){this._shutdownHint=c('ChannelConstants').HINT_MAINT;}else if(ea==1357001||ea==1357004||ea==1348009){this._shutdownHint=c('ChannelConstants').HINT_AUTH;}else this._shutdownHint=null;this.exitState({status:this._shutdownHint?c('ChannelConstants').ERROR_SHUTDOWN:c('ChannelConstants').ERROR,stateId:ba},da);}.bind(this);da.send();},_enter_shutdown:function z(){c('Arbiter').inform(c('ChannelConstants').ON_SHUTDOWN,{reason:this._shutdownHint});if('shutdown_recovery_interval_seconds' in q&&q.shutdown_recovery_interval_seconds>0){var aa=q.shutdown_recovery_interval_seconds*1000;c('setTimeoutAcrossTransitions')(function(){c('Arbiter').inform(c('ChannelConstants').ATTEMPT_RECONNECT);this._shutdownHint=null;this.state='reconnect!';this.enterState('reconnect!');}.bind(this),aa);}},_exit_init:function z(aa){if(this._initTimer)this._initTimer=clearTimeout(this._initTimer);if(aa==c('ChannelConstants').ERROR_MAX)this._sendIframeError(c('ChannelConstants').reason_IFrameLoadGiveUp);},_exit_pull:function z(aa,ba){var ca=aa==c('ChannelConstants').OK;if(ca){this.lastPullTime=Date.now();}else{var da='exit status: '+aa;if(ba&&ba.errorType)da+=' ajax request error: '+ba.errorType;c('FantailLogger').error(c('ChannelConstants').FANTAIL_SERVICE,'pull failed with status: %s',da);}},_exit_ping:function z(aa){if(aa==c('ChannelConstants').OK){var ba=Date.now()-(this.lastPullTime||c('Env').start);if(ba>q.STALL_THRESHOLD){c('FantailLogger').error(c('ChannelConstants').FANTAIL_SERVICE,'didnt complete a successful pull for too long');return c('ChannelConstants').ERROR_STALE;}}else c('FantailLogger').error(c('ChannelConstants').FANTAIL_SERVICE,'ping failed with status: %s',aa);},_reportProxyMisguidedMsg:function z(aa,ba){c('FantailLogger').error(c('ChannelConstants').FANTAIL_SERVICE,'misguided message to %s meant for %s',ba,aa);var ca=Date.now();if(ca-this.lastReportOnMisguidedMsgTime<=q.CHANNEL_PROXY_REPORTING_MIN_INTERVAL)return;this.lastReportOnMisguidedMsgTime=ca;var da={received_uid:aa,expected_uid:ba};if(q.sticky_token)da.sticky_token=q.sticky_token;var ea=new (c('URI'))('/err_misguided_msg').setDomain(q.host+'.'+q.domain).setPort(q.port).setSecure(new (c('URI'))(window.location.href).isSecure()).setQueryData(da),fa=new (c('AjaxRequest'))('GET',ea);if(c('AjaxRequest').supportsCORS())fa.xhr.withCredentials=true;fa.onSuccess=function(ga){};fa.onError=function(ga){};fa.onJSON=function(ga,ha){};fa.send();},_probeTest:function z(){q.streamingCapable=false;var aa=[],ba={mode:'stream',format:'json'};if(q.sticky_token)ba.sticky_token=q.sticky_token;var ca=new (c('URI'))('/probe').setDomain(q.fullHost+'.'+q.domain).setPort(q.port).setSecure(new (c('URI'))(window.location.href).isSecure()).setQueryData(ba),da=new (c('AjaxRequest'))('GET',ca);da.onJSON=function(ea,fa){if(ea&&ea.json&&ea.json.t==='heartbeat'){aa.push(Date.now());if(aa.length>=2){var ga=aa[1]-aa[0];if(ga>=q.PROBE_HEARTBEATS_INTERVAL_LOW&&ga<=q.PROBE_HEARTBEATS_INTERVAL_HIGH){q.streamingCapable=true;k.log('switch_to_streaming','{}');}}}};da.onSuccess=function(ea){if(aa.length!=2){q.streamingCapable=false;k.error('probe_error',JSON.stringify({error:'beats.length = '+aa.length}));}k.log('probe_success','{}');};da.onError=function(ea){q.streamingCapable=false;k.error('probe_error',JSON.stringify(ea));};da.send();},startChannelManager:function z(){if(c('ChannelInitialData').channelConfig){i.configure(c('ChannelInitialData').channelConfig);if(/shutdown/.test(c('ChannelInitialData').state))i._shutdownHint=c('ChannelConstants')[c('ChannelInitialData').reason];i.init(c('ChannelInitialData').state,c('ChannelInitialData').reason);c('ChatReliabilityInstrumentation').logCHANNEL_INIT();this.startChannelManager=c('emptyFunction');}else c('ChatReliabilityInstrumentation').logCHANNEL_NOCONFIG();}};f.exports=i;}),null);
__d('HovercardLink',['Bootloader','URI'],(function a(b,c,d,e,f,g){var h={getBaseURI:function i(){return new (c('URI'))('/ajax/hovercard/hovercard.php');},constructEndpoint:function i(j,k){return h.constructEndpointWithGroupAndLocation(j,k,null);},constructEndpointWithLocation:function i(j,k){return h.constructEndpointWithGroupAndLocation(j,null,k);},constructEndpointWithGroupAndLocation:function i(j,k,l,m){return h.constructEndpointWithGroupLocationAndExtraParams(j,k,l,m);},constructEndpointWithGroupLocationAndExtraParams:function i(j,k,l,m){var n=arguments.length<=4||arguments[4]===undefined?null:arguments[4],o=new (c('URI'))(h.getBaseURI()).setQueryData({id:j.id}),p={};if(n!==null)for(var q in n)p[q]=n[q];if((j.weakreference||m)&&k)p.group_id=k;if(l)p.hc_location=l;o.addQueryData({extragetparams:JSON.stringify(p)});return o;}};f.exports=h;}),null);
__d('formatNumber',['intlNumUtils'],(function a(b,c,d,e,f,g){function h(){for(var i=arguments.length,j=Array(i),k=0;k<i;k++)j[k]=arguments[k];return c('intlNumUtils').formatNumber.apply(c('intlNumUtils'),j);}h.withThousandDelimiters=c('intlNumUtils').formatNumberWithThousandDelimiters;f.exports=h;}),null);
__d('intlSummarizeNumber',['fbt','formatNumber'],(function a(b,c,d,e,f,g,h){function i(j){var k=arguments.length<=1||arguments[1]===undefined?0:arguments[1];j=parseFloat(j.toFixed(k));if(Math.abs(j)<1000)return c('formatNumber')(j,k);j=parseFloat((j/1000).toFixed(k||1));if(Math.abs(j)<1000)return String(h._("{number}K",[h.param('number',c('formatNumber')(j,k||j%1&&1))]));j=parseFloat((j/1000).toFixed(k||1));if(Math.abs(j)<1000)return String(h._("{number}M",[h.param('number',c('formatNumber')(j,k||j%1&&1))]));j=parseFloat((j/1000).toFixed(k||1));return String(h._("{number}B",[h.param('number',c('formatNumber')(j,k||j%1&&1))]));}f.exports=i;}),null);
__d('Facepile.react',['cx','fbt','ix','intlSummarizeNumber','joinClasses','HovercardLink','Image.react','Link.react','List.react','React'],(function a(b,c,d,e,f,g,h,i,j){var k=c('React').PropTypes,l={small:24,medium:32,large:50},m=c('React').createClass({displayName:'Facepile',defaultProps:{moreColor:'blue',moreCount:0,showHovercard:false},propTypes:{className:k.string,moreColor:k.oneOf(['blue','gray']),moreCount:k.number,moreDialogLink:k.string,morePageLink:k.string,numFaces:k.number,onFaceClick:k.func,onComponentDidMount:k.func,profiles:k.arrayOf(k.shape({URL:k.any,name:k.node.isRequired,uniqueID:k.any.isRequired,profilePicURI:k.any.isRequired})).isRequired,showHovercard:k.bool,size:k.oneOf([28,'small','medium','large']).isRequired},_onFaceClick:function n(o,p){if(this.props.onFaceClick)this.props.onFaceClick(o,p);},componentDidMount:function n(){if(this.props.onComponentDidMount)this.props.onComponentDidMount();},getPicSize:function n(){return l[this.props.size]||this.props.size;},renderFace:function n(o,p){var q=this.getPicSize(),r=c('HovercardLink').constructEndpoint({id:o.uniqueID}).toString();return (c('React').createElement('li',{className:"_43q7",key:o.uniqueID,onClick:this._onFaceClick.bind(this,o,p)},c('React').createElement(c('Link.react'),{href:o.URL,'aria-label':o.name,'data-hover':!this.props.showHovercard?'tooltip':null,'data-hovercard':this.props.showHovercard?r:null,'data-tooltip-content':o.name,className:"_2rt_ link",'data-ignoreclass':"_2rt_",'data-tooltip-alignh':'left'},c('React').createElement(c('Image.react'),{src:o.profilePicURI,width:q,height:q,className:'img'}))));},renderMore:function n(){if(!this.props.moreCount)return null;var o=this.props.numFaces!=null&&this.props.numFaces<=this.props.profiles.length?this.props.moreCount+1:this.props.moreCount,p=c('intlSummarizeNumber')(o,0),q=p.length,r;if(o===0||this.props.size==='small'&&q>2||this.props.size===28&&q>3||this.props.size==='medium'&&q>3||this.props.size==='large'&&q>6){r=c('React').createElement(c('Image.react'),{src:j("images\/questions\/ellipsis.png")});}else r='+'+p;var s;if(o===1){s=i._("1 other person");}else s=i._("{num} other people",[i.param('num',o)]);var t=c('joinClasses')("_43q8"+(' '+"_43q7")+(q<2?' '+"_43qa":'')+(q===2?' '+"_43qb":'')+(q===3?' '+"_43qd":'')+(q>3?' '+"_43qe":'')+(this.props.moreColor==='blue'?' '+"_49c8":'')+(this.props.moreColor==='gray'?' '+"_49cb":''));return (c('React').createElement('li',{className:t},c('React').createElement('a',{'data-hover':'tooltip','data-tooltip-position':'right','data-tooltip-content':s,ajaxify:this.props.moreDialogLink,href:this.props.morePageLink,role:'button',rel:'dialog'},r)));},render:function n(){var o=c('joinClasses')(this.props.className,"_43qm"+(this.props.size==28?' '+"_3cxu":'')+(this.props.size=='small'?' '+"_43q9":'')+(this.props.size=='medium'?' '+"_43qc":'')+(this.props.size=='large'?' '+"_43qf":'')),p=this.props.numFaces==undefined?this.props.profiles:this.props.profiles.slice(0,this.props.moreCount?this.props.numFaces-1:this.props.numFaces);return (c('React').createElement('div',{className:o,style:this.props.style},c('React').createElement(c('List.react'),{className:"_4cg3",direction:'horizontal',spacing:'none',border:'none'},p.map(this.renderFace),this.renderMore())));}});f.exports=m;}),null);
__d("MultiwayTypes",[],(function a(b,c,d,e,f,g){var h={OK:200,BAD_REQUEST:400,UNAUTHORIZED:401,NOT_FOUND:404,METHOD_NOT_ALLOWED:406,CONDITIONAL_REQUEST_FAILED:412,BUSY_HERE:486,SERVER_INTERNAL_ERROR:500,SERVICE_UNAVAILABLE:503,PRECONDITION_FAILURE:580},i={JOIN:0,SERVER_MEDIA_UPDATE:1,HANGUP:2,ICE_CANDIDATE:3,RING:4,DISMISS:5,CONFERENCE_STATE:6,ADD_PARTICIPANTS:7,SUBSCRIPTION:8,CLIENT_MEDIA_UPDATE:9,DATA_MESSAGE:10,REMOVE_PARTICIPANTS:11,EXPERIMENT:12},j={AUDIO:0,VIDEO:1,DATA:2},k={IGNORE_CALL:0,HANGUP_CALL:1,NO_ANSWER_TIMEOUT:2,CLIENT_ERROR:3,IN_ANOTHER_CALL:4,CLIENT_INTERRUPTED:5},l={CALL_ENDED:0,ANSWERED_ON_ANOTHER_DEVICE:1,IN_ANOTHER_CALL:2,CONNECTION_DROPPED:3,REJECTED_ON_ANOTHER_DEVICE:4,REMOVED_BY_PARTICIPANT:5,REJECTED_BY_CALLEE:6,INTERNAL_ERROR:7},m={SUPPORT_AUDIO:0,SUPPORT_VIDEO:1},n={GROUP_AUDIO_CALL:0,PEER_VIDEO_CALL:1,PEER_AUDIO_CALL:2,GROUP_VIDEO_CALL:3,LIVE_STREAM:4},o={OK:0,NOT_SUPPORTED:1,IN_ANOTHER_CALL:10},p={UNKNOWN:0,DISCONNECTED:1,NO_ANSWER:2,REJECTED:3,UNREACHABLE:4,CONNECTION_DROPPED:5,CONTACTING:6,RINGING:7,CONNECTING:8,CONNECTED:9,PARTICIPANT_LIMIT_REACHED:10,IN_ANOTHER_CALL:11};f.exports={RtcResponseStatusCode:h,MessageType:i,MediaType:j,RingType:n,HangupReason:k,DismissReason:l,Capability:m,DeviceStatus:o,ParticipantCallState:p};}),null);
__d('MessengerRTCGroupCallContactListItem.react',['cx','fbt','ix','Image.react','ImmutableObject','Link.react','messengerContactImageReact','React','MultiwayTypes'],(function a(b,c,d,e,f,g,h,i,j){'use strict';var k,l=c('messengerContactImageReact').comp,m=c('MultiwayTypes').ParticipantCallState,n=c('React').PropTypes,o=(k={},k[m.DISCONNECTED]=i._("Disconnected"),k[m.NO_ANSWER]=i._("No Answer"),k[m.REJECTED]=i._("Rejected"),k[m.UNREACHABLE]=i._("Unreachable"),k[m.CONNECTION_DROPPED]=i._("Connection Dropped"),k[m.PARTICIPANT_LIMIT_REACHED]=i._("Participant Limit Reached"),k),p=32,q=function t(u){var v=u.participant,w=u.participantState,x=u.isSelected,y=u.onClick;return (c('React').createElement('div',{className:"_4nvn",onClick:y,role:'presentation'},c('React').createElement(c('Link.react'),{className:"_4nvq"},c('React').createElement(l,{className:"_4nvr",isMessengerUser:v.is_messenger_user,size:p,src:v.image_src}),c('React').createElement('div',{className:"_4nvs"},c('React').createElement('div',{className:"_4nvt"},c('React').createElement('div',{className:"_4nv_"},v.name),c('React').createElement(r,{participant:v,participantState:w})),c('React').createElement(s,{isSelected:x})))));},r=function t(u){var v=u.participant.vanity,w=u.participantState;if(!w){if(!v)return null;return (c('React').createElement('div',{className:"_4nw0"},'@',v));}var x=o[w.state]||i._("Unknown");return (c('React').createElement('div',{className:"_4nw0"},x));},s=function t(u){var v=u.isSelected;if(!v)return null;return (c('React').createElement('div',{className:"_5jdo"},c('React').createElement(c('Image.react'),{src:j("images\/mercury\/clients\/messenger\/core\/Checkmark.png")})));};q.propTypes={participant:n.instanceOf(c('ImmutableObject')).isRequired,participantState:n.object,isSelected:n.bool.isRequired,onClick:n.func.isRequired};f.exports=q;}),null);
__d('MessengerRTCGroupCallContactList.react',['cx','immutable','MessengerRTCGroupCallContactListItem.react','MessengerScrollableArea.react','React'],(function a(b,c,d,e,f,g,h){'use strict';var i=function j(k){var l=k.isParticipantSelected,m=k.onClick,n=k.participants,o=k.participantStates,p=o===undefined?c('immutable').Map():o,q=n.map(function(r){return (c('React').createElement(c('MessengerRTCGroupCallContactListItem.react'),{isSelected:!!l.get(r.id),key:r.id,onClick:function(s){function t(){return s.apply(this,arguments);}t.toString=function(){return s.toString();};return t;}(function(){return m(r.id);}),participant:r,participantState:p.get(r.fbid||'')}));});return (c('React').createElement(c('MessengerScrollableArea.react'),{className:"_12zw"},q));};f.exports=i;}),null);
__d('MessengerRTCGroupCallIncomingDialog.react',['cx','fbt','Facepile.react','ImageBlock.react','ImmutableObject','MessengerActions','messengerContactImageReact','MessengerDialog.react','messengerDialogBodyReact','MessengerDialogButton.react','MessengerDialogFooter.react','MessengerDialogHeader.react','React'],(function a(b,c,d,e,f,g,h,i){'use strict';var j=c('messengerContactImageReact').comp,k=c('messengerDialogBodyReact').comp,l=c('React').PropTypes,m=400,n=5,o=50,p=function v(w){var x=w.hasVideo,y=w.caller,z=w.callees,aa=w.onAnswer,ba=w.onIgnore;return (c('React').createElement(c('MessengerDialog.react'),{layerHideOnBlur:false,shown:true,onToggle:function ca(da){return u(da,ba);},width:m},c('React').createElement(q,{hasVideo:x}),c('React').createElement(r,{hasVideo:x,caller:y,callees:z}),c('React').createElement(c('MessengerDialogFooter.react'),null,c('React').createElement(c('MessengerDialogButton.react'),{label:i._("Ignore"),onClick:function ca(){return s(ba);},type:'secondary'}),c('React').createElement(c('MessengerDialogButton.react'),{label:i._("Answer Call"),onClick:function ca(){return t(aa);},type:'primary'}))));},q=function v(w){var x=w.hasVideo;return (c('React').createElement(c('MessengerDialogHeader.react'),null,x?i._("Incoming Group Video Chat"):i._("Incoming Group Call")));},r=function v(w){var x=w.hasVideo,y=w.caller,z=w.callees;return (c('React').createElement(k,null,c('React').createElement(c('ImageBlock.react'),null,c('React').createElement(j,{isMessengerUser:y.is_messenger_user,size:o,src:y.big_image_src||y.image_src}),c('React').createElement('div',{className:"_2n1r"},c('React').createElement('div',{className:"_2n1s"},x?i._("{caller name} started a group video chat in a group you're a member of.",[i.param('caller name',y.name)]):i._("{caller name} started a group call in a group you're a member of.",[i.param('caller name',y.name)])),c('React').createElement(c('Facepile.react'),{moreCount:Math.max(0,z.length-n),profiles:z.map(function(aa){var ba=aa.name,ca=aa.fbid,da=aa.big_image_src;return {name:ba,uniqueID:ca,profilePicURI:da};}).slice(0,n),size:'medium'}),c('React').createElement('div',{className:"_2n1t"},x?i._("Video will start as soon as you answer."):i._("The call will start as soon as you answer."))))));},s=function v(w){c('MessengerActions').hideDialog(p);w();},t=function v(w){c('MessengerActions').hideDialog(p);w();},u=function v(w,x){if(!w){c('MessengerActions').hideDialog(p);x();}};p.propTypes={caller:l.instanceOf(c('ImmutableObject')).isRequired,callees:l.arrayOf(l.instanceOf(c('ImmutableObject'))).isRequired,hasVideo:l.bool.isRequired,onAnswer:l.func.isRequired,onIgnore:l.func.isRequired};f.exports=p;}),null);
__d('RTCEndCallReason',['fbt','FBRTCConstants','MultiwayTypes'],(function a(b,c,d,e,f,g,h){'use strict';var i=c('FBRTCConstants').CallEndReason,j=c('FBRTCConstants').CollabCallEndSubreason,k=c('MultiwayTypes').DismissReason,l=c('MultiwayTypes').HangupReason,m=c('MultiwayTypes').RtcResponseStatusCode;function n(o){this.$RTCEndCallReason1=-1;this.$RTCEndCallReason3='local';this.$RTCEndCallReason4=false;if(typeof o==='string'||o instanceof String){this.$RTCEndCallReason1=i.strNames.indexOf(o);}else this.$RTCEndCallReason1=o;}n.prototype.setSubreason=function(o){this.$RTCEndCallReason2=o;return this;};n.prototype.getSubreason=function(){return this.$RTCEndCallReason2;};n.prototype.setRemoteEnded=function(o){this.$RTCEndCallReason3=o?'remote':'local';return this;};n.prototype.toStrName=function(){var o=arguments.length<=0||arguments[0]===undefined?true:arguments[0];return o?this.$RTCEndCallReason5()+'_'+this.$RTCEndCallReason3:this.$RTCEndCallReason5();};n.prototype.$RTCEndCallReason5=function(){if(this.$RTCEndCallReason1<0||this.$RTCEndCallReason1>i.strNames.length)return 'Unknown';return i.strNames[this.$RTCEndCallReason1];};n.prototype.getReasonID=function(){return this.$RTCEndCallReason1;};n.prototype.toString=function(){var o=arguments.length<=0||arguments[0]===undefined?false:arguments[0],p=(this.$RTCEndCallReason6()||'').toString();return o?p+' '+this.$RTCEndCallReason7():p;};n.prototype.$RTCEndCallReason6=function(){switch(this.$RTCEndCallReason1){case i.NO_ANSWER_TIMEOUT:case i.IGNORE_CALL:return h._("No Answer");case i.OTHER_NOT_CAPABLE:if(this.$RTCEndCallReason2===j.MCU_INVALID_STREAM_CONFIGURATION)return h._("Too many clients connected to the room");case i.INCOMING_TIMEOUT:case i.NO_PERMISSION:case i.OTHER_CARRIER_BLOCKED:return h._("Not Reachable");case i.SIGNALING_MESSAGE_FAILED:case i.WEBRTC_ERROR:case i.NO_UI_ERROR:case i.CALLER_NOT_VISIBLE:case i.CLIENT_ERROR:return h._("Call Failed");case i.UNSUPPORTED_VERSION:return h._("Can't Connect Call");case i.IN_ANOTHER_CALL:return h._("In Another Call");case i.CARRIER_BLOCKED:return h._("Switch to Wi-Fi to complete your call");case i.CLIENT_INTERRUPTED:return h._("Call Interrupted");case i.HANGUP_CALL:case i.ACCEPT_AFTER_HANGUP:return h._("Call Ended");case i.CONNECTION_DROPPED:return h._("Connection Lost");case i.OTHER_INSTANCE_HANDLED:return null;default:return null;}};n.prototype.$RTCEndCallReason7=function(){if(this.$RTCEndCallReason1!==i.OTHER_NOT_CAPABLE&&this.$RTCEndCallReason1!==i.SIGNALING_MESSAGE_FAILED)return '';switch(this.$RTCEndCallReason2){case j.REMOTE_PEER_HANGUP:case j.REMOTE_PEER_REJECT:return '';case j.CLOSED_BY_MCU:return '- Call expired';case j.CLOSED_AS_STALE:return '- Server failed, call is stale';case j.CALL_INITIALIZATION_FAILED:return '- Call initialization to room failed';case j.SIP_CONNECTION_INITIALIZATION_FAILED:return 'or No Answer';case j.LOST_MCU_CONNECTION:return '- MCU Media connection failed';case j.LOST_MCU_THRIFT_CONNECTION:return '- MCU infrastructure dropped connection';case j.LOST_SIP_ADAPTER_CONNECTION:return '- SIP infrastructure dropped connection';case j.MCU_NO_AUDIO_STREAM:return '- Invalid audio stream';case j.MCU_INVALID_STREAM_CONFIGURATION:return '- Invalid stream configuration';case j.UNKNOWN:default:return '- Unexpected call failure: '+(this.$RTCEndCallReason2||'null');}};n.fromHangupReason=function(o){switch(o){case l.IGNORE_CALL:return new n(i.IGNORE_CALL);case l.NO_ANSWER_TIMEOUT:return new n(i.NO_ANSWER_TIMEOUT);case l.HANGUP_CALL:return new n(i.HANGUP_CALL);case l.CLIENT_ERROR:return new n(i.CLIENT_ERROR);case l.IN_ANOTHER_CALL:return new n(i.IN_ANOTHER_CALL);case l.CLIENT_INTERRUPTED:return new n(i.CLIENT_INTERRUPTED);default:return new n(i.HANGUP_CALL);}};n.fromDismissRequest=function(o){if(!o)return new n(i.HANGUP_CALL);switch(o.reason){case k.ANSWERED_ON_ANOTHER_DEVICE:case k.REJECTED_ON_ANOTHER_DEVICE:return new n(i.OTHER_INSTANCE_HANDLED);case k.CALL_ENDED:return new n(i.HANGUP_CALL);case k.IN_ANOTHER_CALL:return new n(i.IN_ANOTHER_CALL);case k.CONNECTION_DROPPED:return new n(i.CONNECTION_DROPPED);case k.REMOVED_BY_PARTICIPANT:return new n(i.HANGUP_CALL);case k.REJECTED_BY_CALLEE:return new n(i.IGNORE_CALL);case k.INTERNAL_ERROR:return new n(i.SIGNALING_MESSAGE_FAILED);default:return new n(i.HANGUP_CALL);}};n.fromResponseStatusCode=function(o){switch(o){case m.PRECONDITION_FAILURE:case m.METHOD_NOT_ALLOWED:case m.UNAUTHORIZED:return new n(i.NO_PERMISSION);case m.SERVICE_UNAVAILABLE:return new n(i.SIGNALING_MESSAGE_FAILED);case m.SERVER_INTERNAL_ERROR:case m.BAD_REQUEST:case m.BUSY_HERE:case m.CONDITIONAL_REQUEST_FAILED:case m.NOT_FOUND:return new n(i.CLIENT_ERROR);default:return new n(i.HANGUP_CALL);}};f.exports=n;}),null);
__d("MediaStream",[],(function a(b,c,d,e,f,g){f.exports=window.MediaStream||window.webkitMediaStream;}),null);
__d('RTCAudioTrackNoiseDetector',['invariant','Promise','MediaStream'],(function a(b,c,d,e,f,g,h){'use strict';var i='audio track with absolute silence',j='audio track data timeout',k='wrong track type, expected "audio"',l=100,m={ABSOLUTE_SILENCE_ERROR:i,DATA_TIMEOUT_ERROR:j,WRONG_TRACK_TYPE_ERROR:k,detect:function n(o,p){if('kind' in o&&o.kind!=='audio')return c('Promise').reject(new Error(k));var q=new (c('MediaStream'))();q.addTrack(o);var r=new AudioContext(),s=r.createMediaStreamSource(q),t=r.createScriptProcessor(0,1,1),u=l,v=function w(){t!=null||h(0);t.onaudioprocess=null;t.disconnect();t=null;s!=null||h(0);s.disconnect();s=null;q!=null||h(0);q.removeTrack(o);q=null;r!=null||h(0);return c('Promise').resolve(r.close())['catch'](function(){return c('Promise').resolve();}).then(function(){r=null;});};return c('Promise').race([new (c('Promise'))(function(w,x){t!=null||h(0);t.onaudioprocess=function(y){var z=y.inputBuffer;for(var aa=z.getChannelData(0),ba=Array.isArray(aa),ca=0,aa=ba?aa:aa[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var da;if(ba){if(ca>=aa.length)break;da=aa[ca++];}else{ca=aa.next();if(ca.done)break;da=ca.value;}var ea=da;if(ea!==0){w();return;}}if(u>0){u--;}else x(new Error(i));};s!=null||h(0);s.connect(t);r!=null||h(0);t.connect(r.destination);}),new (c('Promise'))(function(w){return setTimeout(w,p);}).then(function(){throw new Error(j);})]).then(function(){return v();})['catch'](function(w){return v().then(function(){throw w;});});}};f.exports=m;}),null);
__d('RTCVideoTrackActivityDetector',['invariant','Promise','MediaStream'],(function a(b,c,d,e,f,g,h){'use strict';var i=window.URL||window.webkitURL,j=HTMLMediaElement&&'srcObject' in HTMLMediaElement.prototype,k='video track playback timeout',l='unexpected video track ready state',m='wrong track type, expected "video"',n={PLAYBACK_TIMEOUT_ERROR:k,WRONG_READY_STATE_ERROR:l,WRONG_TRACK_TYPE_ERROR:m,detect:function o(p,q){if('kind' in p&&p.kind!=='video')return c('Promise').reject(new Error(m));var r=document.createElement('video');r.muted=true;var s=new (c('MediaStream'))();s.addTrack(p);var t=void 0,u=0,v=function w(){clearInterval(u);if(r){r.pause();if(j){r.srcObject=null;}else if(r.src){i.revokeObjectURL(r.src);r.src='';}r.removeEventListener('timeupdate',t);r=null;}if(s){s.removeTrack(p);s=null;}};return c('Promise').race([new (c('Promise'))(function(w,x){r!=null||h(0);if(j){r.srcObject=s;}else r.src=i.createObjectURL(s);t=function y(z){r!=null||h(0);if(r.currentTime>0)if(p.readyState==='live'){w();v();}else x(new Error(l));};c('Promise').resolve(r.pause()).then(function(){r!=null||h(0);return r.play();}).then(function(){t();r!=null||h(0);r.addEventListener('timeupdate',t);u=setInterval(t,50);})['catch'](function(y){return x(y);});}),new (c('Promise'))(function(w){return setTimeout(w,q);}).then(function(){throw new Error(k);})])['catch'](function(w){v();throw w;});}};f.exports=n;}),null);
__d('RTCMediaStreamValidator',['Promise','MediaStream','RTCAudioTrackNoiseDetector','RTCVideoTrackActivityDetector'],(function a(b,c,d,e,f,g){'use strict';var h='no audio tracks',i='no video tracks',j='too many audio tracks',k='too many video tracks',l='unexpected audio track(s)',m='unexpected video track(s)',n={NO_AUDIO_TRACKS_ERROR:h,NO_VIDEO_TRACKS_ERROR:i,TOO_MANY_AUDIO_TRACKS_ERROR:j,TOO_MANY_VIDEO_TRACKS_ERROR:k,UNEXPECTED_AUDIO_TRACKS_ERROR:l,UNEXPECTED_VIDEO_TRACKS_ERROR:m,validate:function q(r,s){var t=arguments.length<=2||arguments[2]===undefined?{}:arguments[2],u=t.audio,v=u===undefined?1000:u,w=t.video,x=w===undefined?1000:w;return c('Promise').all([o(r,s,v),p(r,s,x)]).then(function(){return r;});}};function o(q,r,s){var t=q.getAudioTracks();if(!r.audio)return t.length>0?c('Promise').reject(new Error(l)):c('Promise').resolve(q);if(t.length<1){return c('Promise').reject(new Error(h));}else if(t.length>1)return c('Promise').reject(new Error(j));return c('RTCAudioTrackNoiseDetector').detect(t[0],s).then(function(){return q;});}function p(q,r,s){var t=q.getVideoTracks();if(!r.video)return t.length>0?c('Promise').reject(new Error(m)):c('Promise').resolve(q);if(t.length<1){return c('Promise').reject(new Error(i));}else if(t.length>1)return c('Promise').reject(new Error(k));return c('RTCVideoTrackActivityDetector').detect(t[0],s).then(function(){return q;});}f.exports=n;}),null);
__d('RTCUserMediaConstraints',['FBRTCConstants','RTCConfig'],(function a(b,c,d,e,f,g){'use strict';var h=c('FBRTCConstants').VideoQuality,i={width:1920,height:1080,frameRate:30},j={width:1280,height:720,frameRate:30},k={width:854,height:480,frameRate:30},l={width:320,height:180,frameRate:15},m={audio:function r(s){return s?{deviceId:s}:true;},video:function r(s,t){var u=arguments.length<=2||arguments[2]===undefined?c('RTCConfig').CollaborationCallQuality.videoToRoom:arguments[2];if(s===h.NO_VIDEO)return false;var v=t?{deviceId:t}:null;if(s===h.CUSTOM_VIDEO)return babelHelpers['extends']({},u,v);var w=n(s);return babelHelpers['extends']({width:o(w,'width'),height:o(w,'height'),frameRate:o(w,'frameRate')},v);},chromeMediaSource:function r(s,t){var u=s.video,v=m.chromify(u);if(typeof v!=='object')return {audio:false,video:Boolean(v)};var w=v.mandatory,x=v.optional,y=x===undefined?[]:x;return {audio:false,video:{mandatory:babelHelpers['extends']({},w,{chromeMediaSource:'desktop',chromeMediaSourceId:t}),optional:[{googTemporalLayeredScreencast:true}].concat(y)}};},chromify:function r(s){if(!s||typeof s!=='object')return Boolean(s);if(!q(s))return s;var t=s.mandatory,u=t===undefined?{}:t,v=s.optional,w=v===undefined?[]:v;for(var x=Object.entries(s),y=Array.isArray(x),z=0,x=y?x:x[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var aa;if(y){if(z>=x.length)break;aa=x[z++];}else{z=x.next();if(z.done)break;aa=z.value;}var ba=aa,ca=ba[0],da=ba[1];if(ca==='require'||ca==='advanced'||ca==='mediaSource')continue;var ea=da&&typeof da==='object'?da:{ideal:da};if(Number.isFinite(ea.exact)){ea.min=ea.exact;ea.max=ea.exact;}var fa=ea.ideal,ga=ea.exact;if(fa!==undefined)if(Number.isFinite(fa)){var ha,ia;w.push((ha={},ha[p(ca,'min')]=fa,ha),(ia={},ia[p(ca,'max')]=fa,ia));}else{var ja;w.push((ja={},ja[p(ca)]=fa,ja));}if(ga!==undefined&&!Number.isFinite(ga)){u[p(ca)]=ga;}else{var ka=['min','max'];for(var la=0;la<ka.length;la++){var ma=ka[la];if(Number.isFinite(ea[ma]))u[p(ca,ma)]=ea[ma];}}}if(s.advanced)w.push.apply(w,s.advanced);var na={};if(Object.keys(u).length>0)na.mandatory=u;if(w.length>0)na.optional=w;return na;}};function n(r){switch(r){case h.FHD_VIDEO:return i;case h.HD_VIDEO:return j;case h.LQ_VIDEO:return l;case h.SD_VIDEO:return k;default:return j;}}function o(r,s){var t=r[s];return {min:Math.min(l[s],t),max:Math.max(i[s],t),ideal:t};}function p(r,s){if(s)return ''+s+r.charAt(0).toUpperCase()+r.slice(1);return r==='deviceId'?'sourceId':r;}function q(r){return Object.keys(r).some(function(s){return s!=='mandatory'&&s!=='optional';});}f.exports=m;}),null);
__d('RTCUtils',['Promise','FBRTCConstants','RTCEndCallReason','RTCConfig','RTCMediaStreamValidator','RTCScreenSharing','RTCUserMediaConstraints','UserAgent','randomInt'],(function a(b,c,d,e,f,g){'use strict';var h=c('FBRTCConstants').VideoQuality,i={generateRandomInt:function j(){return c('randomInt')(0,4294967294)+1;},isGroupCall:function j(k){return k.split(':')[0]==='GROUP';},createRequestHeader:function j(k,l,m){var n={type:k,transactionId:i.generateRandomInt().toString(),retryCount:0,conferenceName:l};if(m)n.serverInfoData=m;return n;},createResponseHeader:function j(k,l){var m={type:k.type,transactionId:k.transactionId,retryCount:0,conferenceName:k.conferenceName,responseStatusCode:l};if(k.serverInfoData)m.serverInfoData=k.serverInfoData;return m;},getUserMedia:function j(k){var l=navigator,m=l.mediaDevices;if(typeof k.video==='object'&&k.video.mediaSource)return c('RTCScreenSharing').getUserMedia(k);var n=this._parseConstraints(k);if(m&&typeof m.getUserMedia==='function')return c('Promise').resolve(m.getUserMedia(n));return new (c('Promise'))(function(o,p){if(navigator.getUserMedia){navigator.getUserMedia(n,o,p);}else if(navigator.webkitGetUserMedia){navigator.webkitGetUserMedia(n,o,p);}else if(navigator.mozGetUserMedia){navigator.mozGetUserMedia(n,o,p);}else if(navigator.msGetUserMedia){navigator.msGetUserMedia(n,o,p);}else p('getUserMedia not supported');});},_parseConstraints:function j(k){if(c('UserAgent').isBrowser('Chrome')||c('UserAgent').isBrowser('Opera')){var l=k.audio,m=k.video,n={};if(l!=undefined)n.audio=c('RTCUserMediaConstraints').chromify(l);if(m!=undefined)n.video=c('RTCUserMediaConstraints').chromify(m);return n;}return k;},getUserMediaWithValidation:function j(k){var l=arguments.length<=1||arguments[1]===undefined?5:arguments[1],m={audio:1000,video:1000};return new (c('Promise'))(function(n,o){var p=function(q){this.getUserMedia(k).then(function(r){return c('RTCMediaStreamValidator').validate(r,k,m).then(n)['catch'](function(s){this.stopMediaStream(r);throw s;}.bind(this));}.bind(this),o)['catch'](function(r){if(q>0){p(q-1);}else o(r);});}.bind(this);p(l);}.bind(this));},initLocalStream:function j(k){return i.getUserMedia({audio:c('RTCUserMediaConstraints').audio(),video:c('RTCUserMediaConstraints').video(k?h.HD_VIDEO:h.NO_VIDEO)});},initLocalScreenStream:function j(){var k=arguments.length<=0||arguments[0]===undefined?'screen':arguments[0];return i.getUserMedia({audio:false,video:babelHelpers['extends']({},c('RTCConfig').CollaborationCallQuality.screen_v2||c('RTCConfig').CollaborationCallQuality.screen,{mediaSource:k})});},isFullScreen:function j(){return !!(document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement);},requestFullScreen:function j(){var k=arguments.length<=0||arguments[0]===undefined?document.documentElement:arguments[0];if(typeof k.requestFullscreen==='function'){k.requestFullscreen();}else if(typeof k.msRequestFullscreen==='function'){k.msRequestFullscreen();}else if(typeof k.mozRequestFullScreen==='function'){k.mozRequestFullScreen();}else if(typeof k.webkitRequestFullscreen==='function')k.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);},exitFullScreen:function j(){if(typeof document.exitFullscreen==='function'){document.exitFullscreen();}else if(typeof document.msExitFullscreen==='function'){document.msExitFullscreen();}else if(typeof document.mozCancelFullScreen==='function'){document.mozCancelFullScreen();}else if(typeof document.webkitExitFullscreen==='function')document.webkitExitFullscreen();},toggleFullScreen:function j(){if(this.isFullScreen()){this.exitFullScreen();}else this.requestFullScreen();},endCallReasonFromHangupReason:function j(k){return c('RTCEndCallReason').fromHangupReason(k).getReasonID();},endCallReasonFromDismissRequest:function j(k){return c('RTCEndCallReason').fromDismissRequest(k).getReasonID();},endCallReasonFromResponseStatusCode:function j(k){return c('RTCEndCallReason').fromResponseStatusCode(k).getReasonID();},stopMediaStream:function j(k){if(!k.active&&'active' in k)return;for(var l=k.getTracks(),m=Array.isArray(l),n=0,l=m?l:l[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var o;if(m){if(n>=l.length)break;o=l[n++];}else{n=l.next();if(n.done)break;o=n.value;}var p=o;if(p.readyState!=='ended')p.stop();}}};f.exports=i;}),null);
__d('MessengerRTCGroupCallIncomingDialogController',['EventEmitter','FBRTCSoundController','MercuryIDs','MercuryParticipants','MessengerActions','MessengerRTCGroupCallIncomingDialog.react','MessengerRTCIncomingDialog.react','RTCUtils','XGroupCallController','randomInt','setTimeoutAcrossTransitions'],(function a(b,c,d,e,f,g){'use strict';var h,i,j=70000;h=babelHelpers.inherits(k,c('EventEmitter'));i=h&&h.prototype;function k(l,m,n,o,p,q){i.constructor.call(this);this.$MessengerRTCGroupCallIncomingDialogController1=l;this.$MessengerRTCGroupCallIncomingDialogController2=m;this.$MessengerRTCGroupCallIncomingDialogController3=n;this.$MessengerRTCGroupCallIncomingDialogController4=o;this.$MessengerRTCGroupCallIncomingDialogController5=p;this.$MessengerRTCGroupCallIncomingDialogController6=q;this.$MessengerRTCGroupCallIncomingDialogController7=null;}k.prototype.serverInfoData=function(){return this.$MessengerRTCGroupCallIncomingDialogController6;};k.prototype.showIncomingDialog=function(){this.$MessengerRTCGroupCallIncomingDialogController7=c('setTimeoutAcrossTransitions')(this.$MessengerRTCGroupCallIncomingDialogController8.bind(this),j);var l=this.$MessengerRTCGroupCallIncomingDialogController1+c('randomInt')(0,4294967295).toString();c('FBRTCSoundController').playIncomingRingtone(l,this.$MessengerRTCGroupCallIncomingDialogController1,true);if(!c('RTCUtils').isGroupCall(this.$MessengerRTCGroupCallIncomingDialogController1)){c('MessengerActions').showDialog(c('MessengerRTCIncomingDialog.react'),{callerID:this.$MessengerRTCGroupCallIncomingDialogController3,isVideoCall:this.$MessengerRTCGroupCallIncomingDialogController5,onAccept:function(){return this.$MessengerRTCGroupCallIncomingDialogController9();}.bind(this),onDecline:function(){return this.$MessengerRTCGroupCallIncomingDialogController10();}.bind(this)});return;}var m=[this.$MessengerRTCGroupCallIncomingDialogController3].concat(this.$MessengerRTCGroupCallIncomingDialogController4);c('MercuryParticipants').getMulti(m.map(c('MercuryIDs').getParticipantIDFromUserID),function(n){return c('MessengerActions').showDialog(c('MessengerRTCGroupCallIncomingDialog.react'),{caller:n[c('MercuryIDs').getParticipantIDFromUserID(this.$MessengerRTCGroupCallIncomingDialogController3)],callees:Object.values(n).filter(function(o){var p=o.fbid;return (p!==this.$MessengerRTCGroupCallIncomingDialogController3);}.bind(this)),hasVideo:this.$MessengerRTCGroupCallIncomingDialogController5,onAnswer:function(){return this.$MessengerRTCGroupCallIncomingDialogController9();}.bind(this),onIgnore:function(){return this.$MessengerRTCGroupCallIncomingDialogController10();}.bind(this)});}.bind(this));};k.prototype.cancel=function(){if(this.$MessengerRTCGroupCallIncomingDialogController7)clearTimeout(this.$MessengerRTCGroupCallIncomingDialogController7);c('MessengerActions').hideDialog(c('RTCUtils').isGroupCall(this.$MessengerRTCGroupCallIncomingDialogController1)?c('MessengerRTCGroupCallIncomingDialog.react'):c('MessengerRTCIncomingDialog.react'));c('FBRTCSoundController').stopIncomingRingtone();};k.prototype.$MessengerRTCGroupCallIncomingDialogController9=function(){this.cancel();var l=c('XGroupCallController').getURIBuilder().setString('conference_name',this.$MessengerRTCGroupCallIncomingDialogController1).setInt('call_id',this.$MessengerRTCGroupCallIncomingDialogController2).setBool('has_video',this.$MessengerRTCGroupCallIncomingDialogController5).setString('server_info_data',this.$MessengerRTCGroupCallIncomingDialogController6).getURI();this.emit('answerCall',this.$MessengerRTCGroupCallIncomingDialogController1,l);};k.prototype.$MessengerRTCGroupCallIncomingDialogController10=function(){this.cancel();this.emit('ignoreCall');};k.prototype.$MessengerRTCGroupCallIncomingDialogController8=function(){this.cancel();this.emit('timeout');};f.exports=k;}),null);
__d('MessengerRTCGroupCallRingParticipantsRow.react',['cx','fbt','React','intlList'],(function a(b,c,d,e,f,g,h,i){'use strict';var j=function k(l){var m=l.names;return (c('React').createElement('div',{className:"_1wsd"},c('React').createElement('div',{className:"_1wse"},i._("Ring:")),c('React').createElement('div',{className:"_1wsg"},c('intlList')(m,c('intlList').CONJUNCTIONS.NONE))));};f.exports=j;}),null);
__d('MessengerRTCGroupCallThreadRow.react',['cx','fbt','MercuryThreadTitle.react','MessengerThreadImage.react','React'],(function a(b,c,d,e,f,g,h,i){'use strict';var j=function k(l){var m=l.displayAddMemberWarning,n=l.participants,o=l.thread,p=l.viewerID;return (c('React').createElement('div',{className:"_5y31"},c('React').createElement(c('MessengerThreadImage.react'),{className:"_5y32",participants:n,thread:o,viewer:p}),c('React').createElement('div',{className:"_5y34"},c('React').createElement(c('MercuryThreadTitle.react'),{className:"_5y37",thread:o,viewer:p}),m?c('React').createElement('div',{className:"_1apf"},i._("People you add to this group video will see previous messages in this conversation.")):null)));};f.exports=j;}),null);
__d('MessengerRTCGroupCallUnsupportedBrowserDialog.react',['fbt','Link.react','MessengerDialog.react','messengerDialogBodyReact','MessengerDialogButton.react','MessengerDialogFooter.react','MessengerDialogHeader.react','React','UserAgent'],(function a(b,c,d,e,f,g,h){'use strict';var i=c('messengerDialogBodyReact').comp,j=function n(o){var p=o.hasVideo,q=o.onUnmount;return (c('React').createElement(c('MessengerDialog.react'),{onToggle:q},c('React').createElement(c('MessengerDialogHeader.react'),null,k(p)),c('React').createElement(i,null,l(p)),c('React').createElement(c('MessengerDialogFooter.react'),null,c('React').createElement(c('MessengerDialogButton.react'),{label:h._("OK"),onClick:q,type:'primary'}))));};function k(n){return n?h._("Switch Browsers to Make Group Video Chats"):h._("Switch Browsers to Make Group Calls");}function l(n){return n?h._("Unfortunately, our group calling feature doesn't support {browser name, i.e. Internet Explorer or Safari} yet. To make a group video chat, open in {link to install chrome}.",[h.param('browser name, i.e. Internet Explorer or Safari',m()),h.param('link to install chrome',c('React').createElement(c('Link.react'),{href:'https://www.google.com/chrome/index.html',target:'_blank'},'Google Chrome'))]):h._("Unfortunately, our group calling feature doesn't support {browser name, i.e. Internet Explorer or Safari} yet. To make a group call, open in {link to install chrome}.",[h.param('browser name, i.e. Internet Explorer or Safari',m()),h.param('link to install chrome',c('React').createElement(c('Link.react'),{href:'https://www.google.com/chrome/index.html',target:'_blank'},'Google Chrome'))]);}function m(){if(c('UserAgent').isBrowser('Firefox')){return h._("Firefox");}else if(c('UserAgent').isBrowser('IE')){return h._("Internet Explorer");}else if(c('UserAgent').isBrowser('Safari')){return h._("Safari");}else return h._("your browser");}f.exports=j;}),null);
__d('MessengerRTCGroupCallUnsupportedBrowserDialogController',['DOM','MessengerRTCGroupCallUnsupportedBrowserDialog.react','React','ReactDOM'],(function a(b,c,d,e,f,g){'use strict';var h={_container:c('DOM').create('div'),render:function i(j){var k=j.hasVideo;c('ReactDOM').render(c('React').createElement(c('MessengerRTCGroupCallUnsupportedBrowserDialog.react'),{hasVideo:k,onUnmount:function(){return this.unmount();}.bind(this)}),this._container);},unmount:function i(){c('ReactDOM').unmountComponentAtNode(this._container);}};f.exports=h;}),null);
__d("XGroupCallIncomingDialogController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/groupcall\/incoming\/",{conference_name:{type:"String",required:true},call_id:{type:"Int"},caller_id:{type:"FBID",required:true},users_to_ring:{type:"FBIDSet",defaultValue:[]},has_video:{type:"Bool",defaultValue:false},server_info_data:{type:"String",required:true},__asyncDialog:{type:"Int"}});}),null);
__d("XIncomingCallDialogController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/videocall\/incoming\/",{user_id:{type:"Int",required:true},call_id:{type:"Int"},dialog_type:{type:"String",defaultValue:"VIDEO"},__asyncDialog:{type:"Int"}});}),null);
__d('FBRTCGroupCallIncomingDialog',['AsyncDialog','AsyncRequest','Dialog','EventEmitter','FBRTCSoundController','FBRTCConstants','RTCUtils','XGroupCallIncomingDialogController','XIncomingCallDialogController','randomInt','setTimeoutAcrossTransitions'],(function a(b,c,d,e,f,g){'use strict';var h,i,j=c('FBRTCConstants').IncomingCallDialogTypes,k=70000;h=babelHelpers.inherits(l,c('EventEmitter'));i=h&&h.prototype;function l(m,n,o,p,q,r){i.constructor.call(this);this.$FBRTCGroupCallIncomingDialog1=m;this.$FBRTCGroupCallIncomingDialog2=n;this.$FBRTCGroupCallIncomingDialog3=o;this.$FBRTCGroupCallIncomingDialog4=p;this.$FBRTCGroupCallIncomingDialog5=q;this.$FBRTCGroupCallIncomingDialog6=r;this.$FBRTCGroupCallIncomingDialog7=null;this.$FBRTCGroupCallIncomingDialog8=null;this.$FBRTCGroupCallIncomingDialog9=null;}l.prototype.serverInfoData=function(){return this.$FBRTCGroupCallIncomingDialog6;};l.prototype.showIncomingDialog=function(){var m=c('Dialog').getCurrent();if(m)m.hide();var n=this.$FBRTCGroupCallIncomingDialog5?j.VIDEO:j.AUDIO,o=c('RTCUtils').isGroupCall(this.$FBRTCGroupCallIncomingDialog1)?c('XGroupCallIncomingDialogController').getURIBuilder().setString('conference_name',this.$FBRTCGroupCallIncomingDialog1).setInt('call_id',this.$FBRTCGroupCallIncomingDialog2).setFBID('caller_id',this.$FBRTCGroupCallIncomingDialog3).setFBIDSet('users_to_ring',this.$FBRTCGroupCallIncomingDialog4).setBool('has_video',this.$FBRTCGroupCallIncomingDialog5).setString('server_info_data',this.$FBRTCGroupCallIncomingDialog6).getURI():c('XIncomingCallDialogController').getURIBuilder().setInt('user_id',this.$FBRTCGroupCallIncomingDialog3).setInt('call_id',this.$FBRTCGroupCallIncomingDialog2).setString('dialog_type',n).getURI();this.$FBRTCGroupCallIncomingDialog7=new (c('AsyncRequest'))(o);c('AsyncDialog').send(this.$FBRTCGroupCallIncomingDialog7,this.$FBRTCGroupCallIncomingDialog10.bind(this));};l.prototype.$FBRTCGroupCallIncomingDialog10=function(m){if(!this.$FBRTCGroupCallIncomingDialog7){setTimeout(function(){m.hide();},1);return;}this.$FBRTCGroupCallIncomingDialog7=null;this.$FBRTCGroupCallIncomingDialog8=m;m.subscribe('confirm',this.$FBRTCGroupCallIncomingDialog11.bind(this));m.subscribe('cancel',this.$FBRTCGroupCallIncomingDialog12.bind(this));var n=this.$FBRTCGroupCallIncomingDialog1+c('randomInt')(0,4294967295).toString();c('FBRTCSoundController').playIncomingRingtone(n,this.$FBRTCGroupCallIncomingDialog1,true);this.$FBRTCGroupCallIncomingDialog9=c('setTimeoutAcrossTransitions')(this.$FBRTCGroupCallIncomingDialog13.bind(this),k);};l.prototype.cancel=function(){if(this.$FBRTCGroupCallIncomingDialog7){this.$FBRTCGroupCallIncomingDialog7.abort();this.$FBRTCGroupCallIncomingDialog7=null;}if(this.$FBRTCGroupCallIncomingDialog9)clearTimeout(this.$FBRTCGroupCallIncomingDialog9);if(this.$FBRTCGroupCallIncomingDialog8){this.$FBRTCGroupCallIncomingDialog8.hide();this.$FBRTCGroupCallIncomingDialog8=null;}c('FBRTCSoundController').stopIncomingRingtone();};l.prototype.$FBRTCGroupCallIncomingDialog11=function(m,n){this.cancel();this.emit('answerCall',this.$FBRTCGroupCallIncomingDialog1,n.value);};l.prototype.$FBRTCGroupCallIncomingDialog12=function(){this.cancel();this.emit('ignoreCall');};l.prototype.$FBRTCGroupCallIncomingDialog13=function(){this.cancel();this.emit('timeout');};f.exports=l;}),null);
__d('FBRTCMultiwayMessage',['CurrentUser','ChannelManager','RTCUtils','MultiwayTypes'],(function a(b,c,d,e,f,g){var h=c('MultiwayTypes').MessageType;c('ChannelManager').startChannelManager();function i(j){'use strict';this.$FBRTCMultiwayMessage1=j;}i.prototype.isRequest=function(){'use strict';return this.$FBRTCMultiwayMessage1.jsonPayload.header.responseStatusCode==null;};i.prototype.isType=function(j){'use strict';return this.header().type==j;};i.prototype.transactionId=function(){'use strict';return this.$FBRTCMultiwayMessage1.jsonPayload.header.transactionId;};i.prototype.conferenceName=function(){'use strict';return this.$FBRTCMultiwayMessage1.jsonPayload.header.conferenceName;};i.prototype.serverInfoData=function(){'use strict';return this.$FBRTCMultiwayMessage1.jsonPayload.header.serverInfoData;};i.prototype.message=function(){'use strict';return this.$FBRTCMultiwayMessage1;};i.prototype.endpoint=function(){'use strict';return this.$FBRTCMultiwayMessage1.endpoint;};i.prototype.header=function(){'use strict';return this.$FBRTCMultiwayMessage1.jsonPayload.header;};i.prototype.body=function(){'use strict';return this.$FBRTCMultiwayMessage1.jsonPayload.body;};i.prototype.incrementRetryCount=function(){'use strict';this.$FBRTCMultiwayMessage1.jsonPayload.header.retryCount++;};i.prototype.ringRequest=function(){'use strict';return this.isRequest()&&this.isType(h.RING)?this.body().ringRequest:null;};i.prototype.dismissRequest=function(){'use strict';return this.isRequest()&&this.isType(h.DISMISS)?this.body().dismissRequest:null;};i.prototype.serverMediaUpdateRequest=function(){'use strict';return this.isRequest()&&this.isType(h.SERVER_MEDIA_UPDATE)?this.body().serverMediaUpdateRequest:null;};i.prototype.conferenceStateRequest=function(){'use strict';return this.isRequest()&&this.isType(h.CONFERENCE_STATE)?this.body().conferenceStateRequest:null;};i.prototype.createResponse=function(j,k){'use strict';var l={endpoint:{appId:'229895473858072',deviceId:c('ChannelManager').getCompleteConfig().sessionID,userId:c('CurrentUser').getID()},jsonPayload:{header:c('RTCUtils').createResponseHeader(this.header(),j),body:k||{}}};return new i(l);};f.exports=i;}),null);
__d("XGroupCallSendMessageController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/groupcall\/sendmessage\/",{webrtc_fbtrace:{type:"Int"}});}),null);
__d('RTCMessageSender',['Promise','CurrentUser','XGroupCallSendMessageController','SiteData','Fbtrace','AsyncRequest'],(function a(b,c,d,e,f,g){var h=6000;function i(){'use strict';}i.prototype.send=function(j){'use strict';return new (c('Promise'))(function(k,l){var m=j.jsonPayload.header.conferenceName,n={conference_name:m,user_id:c('CurrentUser').getID(),message:j,app_id:256281040558,app_version:String(c('SiteData').revision||'dev'),op:'RTCMessageSender.send',policy:'WebRTC'},o=c('Fbtrace').requestReceive('browser',String(c('SiteData').revision||'dev'),n),p=c('XGroupCallSendMessageController').getURIBuilder().setInt('webrtc_fbtrace',o.isOn()?1:0).getURI();c('Fbtrace').withDefaultNode(o,function(){var q=new (c('AsyncRequest'))(p).setMethod('POST').setData({message:JSON.stringify(j)}).setAllowCrossPageTransition(true).setHandler(function(r){k(r);}).setErrorHandler(function(r){var s=Error(r.getErrorDescription?r.getErrorDescription():'AsyncRequest error');l(s);}).setTimeoutHandler(h,function(){l('Timeout');});q.send();});});};f.exports=i;}),null);
__d('FBRTCTransactions',['Promise','Map','RTCMessageSender'],(function a(b,c,d,e,f,g){'use strict';var h=60000,i={INIT:0,PROCESSING:1,COMPLETED:2,TERMINATED:3};function j(){this.$FBRTCTransactionOwner1=new (c('Map'))();}j.prototype.findTransaction=function(l){return this.$FBRTCTransactionOwner1.get(l);};j.prototype.addTransaction=function(l){this.$FBRTCTransactionOwner1.set(l.id,l);};j.prototype.removeTransaction=function(l){this.$FBRTCTransactionOwner1['delete'](l.id);};j.prototype.getTransaction=function(l){return this.findTransaction(l.transactionId())||new k(this,l);};function k(l,m){this.id=m.transactionId();this.$FBRTCServerTransaction1=i.INIT;this.$FBRTCServerTransaction2=m;this.$FBRTCServerTransaction3=null;this.$FBRTCServerTransaction4=l;this.$FBRTCServerTransaction5=new Error('Unknown');this.$FBRTCServerTransaction6=null;this.$FBRTCServerTransaction7=new (c('RTCMessageSender'))();this.$FBRTCServerTransaction8();this.$FBRTCServerTransaction4.addTransaction(this);}k.prototype.start=function(){if(this.$FBRTCServerTransaction1==i.INIT){this.$FBRTCServerTransaction9(i.PROCESSING);return c('Promise').resolve(this.$FBRTCServerTransaction2);}else if(this.$FBRTCServerTransaction1==i.PROCESSING){return c('Promise').resolve(null);}else if(this.$FBRTCServerTransaction1==i.COMPLETED){this.$FBRTCServerTransaction10();return c('Promise').resolve(null);}return c('Promise').reject(this.$FBRTCServerTransaction5);};k.prototype.sendResponse=function(l){this.$FBRTCServerTransaction3=l;this.$FBRTCServerTransaction9(i.COMPLETED);this.$FBRTCServerTransaction7.send(l.message()).then(function(m){},function(m){this.$FBRTCServerTransaction5=m;this.$FBRTCServerTransaction9(i.TERMINATED);}.bind(this)).done();};k.prototype.$FBRTCServerTransaction10=function(){if(this.$FBRTCServerTransaction3!=null){var l=this.$FBRTCServerTransaction3;l.incrementRetryCount();this.sendResponse(l);}};k.prototype.$FBRTCServerTransaction9=function(l){if(l!=this.$FBRTCServerTransaction1){this.$FBRTCServerTransaction1=l;if(this.$FBRTCServerTransaction1!=i.TERMINATED)this.$FBRTCServerTransaction8();if(this.$FBRTCServerTransaction1==i.TERMINATED){this.$FBRTCServerTransaction5=new Error('Terminated');this.$FBRTCServerTransaction4.removeTransaction(this);}}};k.prototype.$FBRTCServerTransaction8=function(){if(this.$FBRTCServerTransaction6){clearTimeout(this.$FBRTCServerTransaction6);this.$FBRTCServerTransaction6=null;}this.$FBRTCServerTransaction6=setTimeout(function(){this.$FBRTCServerTransaction9(i.TERMINATED);}.bind(this),h);};f.exports={FBRTCTransactionOwner:j,FBRTCServerTransaction:k};}),null);
__d('RTCCallControlReducer',['RTCGroupCallActionTypes'],(function a(b,c,d,e,f,g){'use strict';function h(i,j){switch(j.type){case c('RTCGroupCallActionTypes').AUDIO_MUTED:case c('RTCGroupCallActionTypes').AUDIO_UNMUTED:return i.set('localUser',i.localUser.toggleMuteAudio());case c('RTCGroupCallActionTypes').VIDEO_MUTED:case c('RTCGroupCallActionTypes').VIDEO_UNMUTED:return i.set('localUser',i.localUser.toggleMuteVideo());}return i;}f.exports={toggleLocalStream:h};}),null);
__d('RTCConferenceState',[],(function a(b,c,d,e,f,g){'use strict';var h={NEW:'NEW',AWAITING_USER_START:'AWAITING_USER_START',CONNECTING:'CONNECTING',CONNECTED:'CONNECTED',TERMINATING:'TERMINATING',TERMINATED:'TERMINATED'};f.exports=h;}),null);
__d('RTCUser',['immutable','MultiwayTypes','URI'],(function a(b,c,d,e,f,g){'use strict';var h=c('MultiwayTypes').ParticipantCallState;function i(j){var k=j.FBID,l=j.streams,m=l===undefined?c('immutable').Set():l,n=j.screenStreams,o=n===undefined?c('immutable').Set():n,p=j.profileUrl,q=j.profilePictureUrl,r=j.isMessengerUser,s=r===undefined?false:r,t=j.userName,u=t===undefined?'':t,v=j.userShortName,w=v===undefined?'':v,x=j.participantState,y=j.lastConnectedAt,z=y===undefined?0:y;Object.assign(this,{FBID:k,streams:m,screenStreams:o,profileUrl:p,profilePictureUrl:q,isMessengerUser:s,userName:u,userShortName:w,participantState:x,lastConnectedAt:z});Object.freeze(this);}i.prototype.clone=function(){return new i(babelHelpers['extends']({},this));};i.prototype.getUserID=function(){return this.FBID;};i.prototype.getProfileUrl=function(){return this.profileUrl;};i.prototype.setProfilePictureUrl=function(j){return j!==this.profilePictureUrl?new i(babelHelpers['extends']({},this,{profilePictureUrl:j})):this;};i.prototype.getProfilePictureUrl=function(){return this.profilePictureUrl;};i.prototype.setIsMessengerUser=function(j){return j!==this.isMessengerUser?new i(babelHelpers['extends']({},this,{isMessengerUser:j})):this;};i.prototype.getIsMessengerUser=function(){return this.isMessengerUser;};i.prototype.getUserName=function(){return this.userName;};i.prototype.getUserShortName=function(){return this.userShortName;};i.prototype.setParticipantState=function(j){if((!this.participantState||this.participantState.state!==h.CONNECTED)&&j.state===h.CONNECTED)return new i(babelHelpers['extends']({},this,{participantState:j,lastConnectedAt:Date.now()}));return new i(babelHelpers['extends']({},this,{participantState:j}));};i.prototype.getParticipantState=function(){return this.participantState;};i.prototype.getLastConnectedAt=function(){return this.lastConnectedAt;};i.prototype.hasAudio=function(){return this.streams.some(function(j){return j.getAudioTracks().length>0;});};i.prototype.hasVideo=function(){return this.streams.some(function(j){return j.getVideoTracks().length>0;});};i.prototype.isAudioMuted=function(){if(!this.hasAudio())return true;return this.streams.every(function(j){return this.areAllTracksMuted(j.getAudioTracks());}.bind(this));};i.prototype.isVideoMuted=function(){if(!this.hasVideo())return true;return this.streams.every(function(j){return this.areAllTracksMuted(j.getVideoTracks());}.bind(this));};i.prototype.areAllTracksMuted=function(j){return !j.some(function(k){return k.enabled;});};i.prototype.isTrackMuted=function(j){return this.streams.some(function(k){var l=k.getTrackById(j);if(!l)return true;return !l.enabled;});};i.prototype.toggleMuteAudio=function(j){this.streams.forEach(function(k){return this.$RTCUser1(k.getAudioTracks(),j);}.bind(this));return this.clone();};i.prototype.toggleMuteVideo=function(j){this.streams.forEach(function(k){return this.$RTCUser1(k.getVideoTracks(),j);}.bind(this));return this.clone();};i.prototype.hasStream=function(){return !this.streams.isEmpty();};i.prototype.getStreams=function(){return this.streams;};i.prototype.addStream=function(j){var k=this.streams.add(j);return k!==this.streams?new i(babelHelpers['extends']({},this,{streams:k})):this;};i.prototype.removeStream=function(j){var k=this.streams['delete'](j);return k!==this.streams?new i(babelHelpers['extends']({},this,{streams:k})):this;};i.prototype.removeAllStreams=function(){return this.hasStream()?new i(babelHelpers['extends']({},this,{streams:c('immutable').Set()})):this;};i.prototype.hasScreenStream=function(){return !this.screenStreams.isEmpty();};i.prototype.getScreenStreams=function(){return this.screenStreams;};i.prototype.addScreenStream=function(j){var k=this.screenStreams.add(j);return k!==this.screenStreams?new i(babelHelpers['extends']({},this,{screenStreams:k})):this;};i.prototype.removeScreenStream=function(j){var k=this.screenStreams['delete'](j);return k!==this.screenStreams?new i(babelHelpers['extends']({},this,{screenStreams:k})):this;};i.prototype.removeAllScreenStreams=function(){return this.hasScreenStream()?new i(babelHelpers['extends']({},this,{screenStreams:c('immutable').Set()})):this;};i.prototype.$RTCUser1=function(j,k){var l=k!=null?!k:this.areAllTracksMuted(j);j.forEach(function(m){return m.enabled=l;});};f.exports=i;}),null);
__d('RTCCallStoreState',['CurrentUser','FBRTCCallSummary','immutable','RTCConferenceState','RTCUser'],(function a(b,c,d,e,f,g){'use strict';var h,i,j,k,l={debugID:0,conferenceState:c('RTCConferenceState').NEW,conferenceName:'',protocol:'',serverInfoData:''};h=babelHelpers.inherits(m,c('immutable').Record(l));i=h&&h.prototype;function m(){h.apply(this,arguments);}var n={connections:c('immutable').Set(),localUser:new (c('RTCUser'))({FBID:c('CurrentUser').getID()}),remoteUsers:c('immutable').Set(),callInfo:new m(),callSummary:null};j=babelHelpers.inherits(o,c('immutable').Record(n));k=j&&j.prototype;function o(){j.apply(this,arguments);}f.exports=o;}),null);
__d('RTCGroupCallDispatcher',['ExplicitRegistrationDispatcher'],(function a(b,c,d,e,f,g){var h,i;h=babelHelpers.inherits(j,c('ExplicitRegistrationDispatcher'));i=h&&h.prototype;function j(k){'use strict';i.constructor.call(this,k);this.dispatch=this.dispatch.bind(this);}f.exports=new j({strict:true});}),null);
__d('RTCCallStore',['FBRTCCallSummaryReducer','FluxReduceStore','RTCCallControlReducer','RTCCallReducer','RTCCallStoreState','RTCGroupCallDispatcher'],(function a(b,c,d,e,f,g){'use strict';var h,i,j=[c('FBRTCCallSummaryReducer').onCallEnded,c('FBRTCCallSummaryReducer').onCallStarted,c('FBRTCCallSummaryReducer').onMessageSignaling,c('FBRTCCallSummaryReducer').onSurveyResult,c('FBRTCCallSummaryReducer').setCallSummary,c('RTCCallControlReducer').toggleLocalStream,c('RTCCallReducer').addParticipants,c('RTCCallReducer').callEnd,c('RTCCallReducer').callInit,c('RTCCallReducer').callStart,c('RTCCallReducer').initUsers,c('RTCCallReducer').incomingCallStart,c('RTCCallReducer').processConferenceState,c('RTCCallReducer').processJoinResponse,c('RTCCallReducer').processLocalScreenStream,c('RTCCallReducer').processLocalStream,c('RTCCallReducer').processRemoteScreenStream,c('RTCCallReducer').processRemoteStream,c('RTCCallReducer').processRemoteTrack,c('RTCCallReducer').toggleRemoteStream,c('RTCCallReducer').waitForUserInput,function(l,m){return l;}];h=babelHelpers.inherits(k,c('FluxReduceStore'));i=h&&h.prototype;k.prototype.getInitialState=function(){return new (c('RTCCallStoreState'))();};k.prototype.reduce=function(l,m){return j.reduce(function(n,o){return o(n,m);},l);};function k(){h.apply(this,arguments);}f.exports=new k(c('RTCGroupCallDispatcher'));}),null);
__d('RTCGroupCallActions',['FBRTCTransactions','RTCGroupCallActionTypes','RTCGroupCallDispatcher','RTCUtils'],(function a(b,c,d,e,f,g){'use strict';var h=c('FBRTCTransactions').FBRTCServerTransaction,i={toggleRemoteStream:function j(k){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').TOGGLE_REMOTE_STREAM,mediaStatus:k});},addParticipants:function j(k){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').ADD_PARTICIPANTS,usersToInvite:k});},handleDismissRequest:function j(k,l){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').DISMISS,transaction:k,request:l,endCallReason:c('RTCUtils').endCallReasonFromDismissRequest(l.dismissRequest())});},handleConferenceStateRequest:function j(k,l,m,n){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').ON_CONFERENCE_STATE,transaction:k,request:l,conferenceStateVersion:m,resolve:n});},onJoinResponse:function j(k){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').ON_JOIN_RESPONSE,serverInfoData:k});},onClientMediaUpdateResponse:function j(k,l){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').ON_CLIENT_MEDIA_UPDATE_RESPONSE,responseStatusCode:k,currentVersion:l});}};f.exports=i;}),null);
__d('RTCGroupCallAddGroupMembersDialog.react',['cx','fbt','invariant','immutable','ImmutableObject','MessengerDialog.react','MessengerDialogButton.react','MessengerDialogCancelButton.react','MessengerDialogHeader.react','MessengerDialogTitle.react','MessengerRTCGroupCallContactList.react','MessengerRTCGroupCallRingParticipantsRow.react','MessengerRTCGroupCallThreadRow.react','React','RTCGroupCallActions','RTCUser'],(function a(b,c,d,e,f,g,h,i,j){'use strict';var k,l,m=c('React').PropTypes,n=460;k=babelHelpers.inherits(o,c('React').Component);l=k&&k.prototype;function o(){var p,q;for(var r=arguments.length,s=Array(r),t=0;t<r;t++)s[t]=arguments[t];return q=(p=l.constructor).call.apply(p,[this].concat(s)),this.state={isParticipantSelected:this.props.participants.mapEntries(function(u){var v=u[0],w=u[1];return [v,false];})},this.$RTCGroupCallAddGroupMembersDialog1=function(){c('RTCGroupCallActions').addParticipants(this.$RTCGroupCallAddGroupMembersDialog2().map(function(u){u.fbid||j(0);return new (c('RTCUser'))({FBID:u.fbid,profilePictureUrl:u.image_src,isMessengerUser:!!u.is_messenger_user,userName:u.name,userShortName:u.short_name});}));this.props.onUnmount();}.bind(this),q;}o.prototype.render=function(){var p=this.props,q=p.participants,r=p.participantStates,s=p.thread,t=p.viewerID;return c('React').createElement(c('MessengerDialog.react'),{onToggle:this.props.onUnmount,type:'default',width:n},c('React').createElement('div',{className:"_1axt"},c('React').createElement(c('MessengerDialogHeader.react'),null,c('React').createElement(c('MessengerDialogCancelButton.react'),null),c('React').createElement(c('MessengerDialogTitle.react'),null,i._("Add Group Members")),c('React').createElement(c('MessengerDialogButton.react'),{label:i._("Ring"),onClick:this.$RTCGroupCallAddGroupMembersDialog1,disabled:this.$RTCGroupCallAddGroupMembersDialog2().length===0,type:'primary'})),c('React').createElement(c('MessengerRTCGroupCallThreadRow.react'),{participants:q,thread:s,viewerID:t}),c('React').createElement(c('MessengerRTCGroupCallRingParticipantsRow.react'),{names:this.$RTCGroupCallAddGroupMembersDialog2().map(function(u){var v=u.name;return v;}).sort(function(u,v){return u.localeCompare(v);})}),c('React').createElement(c('MessengerRTCGroupCallContactList.react'),{participants:q.toArray().sort(function(u,v){return u.name.localeCompare(v.name);}),participantStates:r,isParticipantSelected:this.state.isParticipantSelected,onClick:function(u){return this.setState({isParticipantSelected:this.state.isParticipantSelected.set(u,!this.state.isParticipantSelected.get(u))});}.bind(this)})));};o.prototype.$RTCGroupCallAddGroupMembersDialog2=function(){return this.props.participants.filter(function(p,q){return this.state.isParticipantSelected.get(q);}.bind(this)).toArray();};o.propTypes={participants:m.instanceOf(c('immutable').Map).isRequired,participantStates:m.instanceOf(c('immutable').Map).isRequired,thread:m.instanceOf(c('ImmutableObject')).isRequired,viewerID:m.string.isRequired,onUnmount:m.func.isRequired};f.exports=o;}),null);
__d('RTCGroupCallAddMembersDialog.react',['cx','fbt','invariant','immutable','ImmutableObject','MercuryIDs','MercuryLogMessageType','MercuryMessageActions','MercuryMessageObject','MercuryParticipants','MercuryTriodeSourceUtil','MessengerAdminGroupUtils','MessengerDialog.react','MessengerDialogButton.react','MessengerDialogCancelButton.react','MessengerDialogHeader.react','MessengerDialogTitle.react','MessengerGraphQLTokenizer.react','MessengerRTCGroupCallContactList.react','MessengerRTCGroupCallThreadRow.react','React','RTCGroupCallActions','RTCUser'],(function a(b,c,d,e,f,g,h,i,j){'use strict';var k,l,m=c('React').PropTypes,n=460;k=babelHelpers.inherits(o,c('React').Component);l=k&&k.prototype;function o(){var p,q;for(var r=arguments.length,s=Array(r),t=0;t<r;t++)s[t]=arguments[t];return q=(p=l.constructor).call.apply(p,[this].concat(s)),this.state={isParticipantSelected:this.props.participants.mapEntries(function(u){var v=u[0],w=u[1];return [v,false];}),newParticipants:c('immutable').List()},this.$RTCGroupCallAddMembersDialog1=function(u){this.setState({isParticipantSelected:this.state.isParticipantSelected.set(u,!this.state.isParticipantSelected.get(u))});}.bind(this),this.$RTCGroupCallAddMembersDialog2=function(){this.$RTCGroupCallAddMembersDialog7();var u=this.state.newParticipants.toArray().map(function(v){return (c('MercuryIDs').getParticipantIDFromUserID(v.getUniqueID()));});c('MercuryParticipants').getMulti(u,function(v){var w=[];for(var x=Object.keys(v),y=Array.isArray(x),z=0,x=y?x:x[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var aa;if(y){if(z>=x.length)break;aa=x[z++];}else{z=x.next();if(z.done)break;aa=z.value;}var ba=aa;w.push(v[ba]);}var ca=w.concat(this.$RTCGroupCallAddMembersDialog3());c('RTCGroupCallActions').addParticipants(ca.map(function(da){da.fbid||j(0);return new (c('RTCUser'))({FBID:da.fbid,profilePictureUrl:da.image_src,isMessengerUser:!!da.is_messenger_user,userName:da.name,userShortName:da.short_name});}));this.props.onUnmount();}.bind(this));}.bind(this),this.$RTCGroupCallAddMembersDialog4=function(u){this.setState({newParticipants:this.state.newParticipants.push(u)});}.bind(this),this.$RTCGroupCallAddMembersDialog6=function(u){var v=u.getUniqueID(),w=this.state.newParticipants,x=w.findIndex(function(y){return y.getUniqueID()===v;});if(x!==-1)this.setState({newParticipants:w['delete'](x)});}.bind(this),this.$RTCGroupCallAddMembersDialog5=function(){this.setState({newParticipants:c('immutable').List()});}.bind(this),q;}o.prototype.render=function(){var p=this.props,q=p.participants,r=p.participantStates,s=p.thread,t=p.viewerID,u=c('React').createElement('div',null,c('React').createElement('div',{className:"_225b"},i._("Group Members")),c('React').createElement(c('MessengerRTCGroupCallContactList.react'),{participants:q.toArray().sort(function(v,w){return v.name.localeCompare(w.name);}),participantStates:r,isParticipantSelected:this.state.isParticipantSelected,onClick:this.$RTCGroupCallAddMembersDialog1}));return c('React').createElement(c('MessengerDialog.react'),{onToggle:this.props.onUnmount,type:'default',width:n},c('React').createElement('div',{className:"_5zad"},c('React').createElement(c('MessengerDialogHeader.react'),null,c('React').createElement(c('MessengerDialogCancelButton.react'),null),c('React').createElement(c('MessengerDialogTitle.react'),null,i._("Add Group Members")),c('React').createElement(c('MessengerDialogButton.react'),{label:i._("Ring"),onClick:this.$RTCGroupCallAddMembersDialog2,disabled:this.$RTCGroupCallAddMembersDialog3().length+this.state.newParticipants.size===0,type:'primary'})),c('React').createElement(c('MessengerRTCGroupCallThreadRow.react'),{displayAddMemberWarning:true,participants:q,thread:s,viewerID:t}),c('React').createElement(c('MessengerGraphQLTokenizer.react'),{autoFocus:false,context:null,className:"_2el3",defaultEntries:u,enableMessageSearch:false,entries:this.state.newParticipants,excludeGroups:true,excludePages:true,forceHideClearButton:true,hasHoverState:false,hideViewWithEntries:false,onAddEntryAttempt:this.$RTCGroupCallAddMembersDialog4,onClear:this.$RTCGroupCallAddMembersDialog5,onRemoveEntryAttempt:this.$RTCGroupCallAddMembersDialog6,originalEntryIDs:c('immutable').Set(this.props.participants.keySeq().toArray().map(function(v){return c('MercuryIDs').getUserIDFromParticipantID(v)||v;})),placeholder:i._("Add to group:"),showDefaultEntries:true,shouldQueryInternalBot:false,shouldQueryVCEndpoint:false,scrollableViewClassName:"_2el2",useLayer:false,viewer:this.props.viewerID,width:n})));};o.prototype.$RTCGroupCallAddMembersDialog7=function(){if(this.state.newParticipants.size)if(c('MessengerAdminGroupUtils').isJoinableThread(this.props.thread)){this.state.newParticipants.forEach(function(q){var r=c('MercuryIDs').getThreadIDFromUserID(q.getUniqueID());this.$RTCGroupCallAddMembersDialog8().send(this.$RTCGroupCallAddMembersDialog9().constructUserGeneratedMessageObject(this.props.thread.joinable_mode.link,c('MercuryTriodeSourceUtil').getMercuryTriodeSource(),r));}.bind(this));}else{var p='thread:'+(this.props.thread.thread_fbid||this.props.thread.thread_id.split('.')[1]);this.$RTCGroupCallAddMembersDialog8().send(this.$RTCGroupCallAddMembersDialog9().constructLogMessageObject(c('MercuryTriodeSourceUtil').getMercuryTriodeSource(),p,c('MercuryLogMessageType').SUBSCRIBE,{added_participants:this.state.newParticipants.map(function(q){return c('MercuryIDs').getParticipantIDFromUserID(q.getUniqueID());}).toArray()}));}};o.prototype.$RTCGroupCallAddMembersDialog8=function(){return c('MercuryMessageActions').getForFBID(this.props.viewerID);};o.prototype.$RTCGroupCallAddMembersDialog9=function(){return c('MercuryMessageObject').getForFBID(this.props.viewerID);};o.prototype.$RTCGroupCallAddMembersDialog3=function(){return this.props.participants.filter(function(p,q){return this.state.isParticipantSelected.get(q);}.bind(this)).toArray();};o.propTypes={participants:m.instanceOf(c('immutable').Map).isRequired,participantStates:m.instanceOf(c('immutable').Map).isRequired,thread:m.instanceOf(c('ImmutableObject')).isRequired,viewerID:m.string.isRequired,onUnmount:m.func.isRequired};f.exports=o;}),null);
__d('RTCGroupCallDialogController',['DOM','FBRTCGroupCallVideoEscalationDialog.react','immutable','RTCGroupCallAddGroupMembersDialog.react','RTCGroupCallAddMembersDialog.react','React','ReactDOM','RTCConfig'],(function a(b,c,d,e,f,g){'use strict';var h={_container:c('DOM').create('div'),showAddGroupMembersDialog:function i(j,k,l,m){c('ReactDOM').render(c('RTCConfig').RtcAddNewParticipantsGK?c('React').createElement(c('RTCGroupCallAddMembersDialog.react'),{participants:j,participantStates:k,thread:l,viewerID:m,onUnmount:function(){return this._onUnmount();}.bind(this)}):c('React').createElement(c('RTCGroupCallAddGroupMembersDialog.react'),{participants:j,participantStates:k,thread:l,viewerID:m,onUnmount:function(){return this._onUnmount();}.bind(this)}),this._container);},showVideoEscalationDialog:function i(j,k){c('ReactDOM').render(c('React').createElement(c('FBRTCGroupCallVideoEscalationDialog.react'),{userName:j,onToggle:function(){this._onUnmount();k();}.bind(this)}),this._container);},_onUnmount:function i(){c('ReactDOM').unmountComponentAtNode(this._container);}};f.exports=h;}),null);
__d('RTCMWSessionDescription',['Promise','MultiwayTypes','RTCCallStore','RTCConfig','RTCGroupCallActions','RTCGroupCallDialogController'],(function a(b,c,d,e,f,g){'use strict';var h=c('MultiwayTypes').MediaType,i={_videoEnabled:{},serverMediaUpdate:function j(k,l){var m,n=k.fromVersion,o=k.toVersion,p=k.mediaUpdates,q=c('RTCCallStore').getState().connections.first(),r=q.getLocalDescription(),s=q.getRemoteDescription(),t=s.sessionDescription.getVersion();if(t!==n)l(t);var u=function(){p.forEach(function(w){s.processServerMediaUpdate(w);w.media.forEach(function(x){var y=x.type,z=x.enabled;if(y===h.VIDEO)this._videoEnabled[w.sourceKey]=z;}.bind(this));}.bind(this));s.sessionDescription.setVersion(o);c('Promise').all([q.setLocalDescription(r),q.setRemoteDescription(s)]).then(function(){var w;c('RTCGroupCallActions').toggleRemoteStream((w=[]).concat.apply(w,p.map(function(x){var y=x.media;return y;})).reduce(function(x,y){var z=y.id,aa=y.enabled;x[z]=aa;return x;},{}));l(o);},function(){return l(t);})['catch'](function(w){});}.bind(this),v=p.find(function(w){var x=w.sourceKey,y=w.media;return !this._videoEnabled[x]&&y.some(function(z){var aa=z.type,ba=z.enabled;return aa===h.VIDEO&&ba;});}.bind(this));if(c('RTCConfig').RtcConferencingVideoGK&&!c('RTCCallStore').getState().localUser.hasVideo()&&v){(function(){var w=v.sourceKey.split(':'),x=w[0],y=c('RTCCallStore').getState().remoteUsers.find(function(z){return z.getUserID()===x;});c('RTCGroupCallDialogController').showVideoEscalationDialog(y.getUserName(),u);})();}else u();}};f.exports=i;}),null);
__d('RTCMultiwayMessageHandler',['Arbiter','ChannelConstants','FBRTCMultiwayMessage','FBRTCTransactions','RTCCallActions','RTCCallStore','RTCGroupCallActions','RTCMWSessionDescription','MultiwayTypes'],(function a(b,c,d,e,f,g){'use strict';var h=c('FBRTCTransactions').FBRTCServerTransaction,i=c('FBRTCTransactions').FBRTCTransactionOwner,j=c('MultiwayTypes').RtcResponseStatusCode;function k(){this.$RTCMultiwayMessageHandler3=-1;this.$RTCMultiwayMessageHandler5();}k.prototype.initialize=function(l,m){this.$RTCMultiwayMessageHandler1=l;this.$RTCMultiwayMessageHandler2=m;};k.initHandler=function(l,m){new k().initialize(l,m);};k.close=function(){if(k.$RTCMultiwayMessageHandler4){c('Arbiter').unsubscribe(k.$RTCMultiwayMessageHandler4);k.$RTCMultiwayMessageHandler4=null;}};k.prototype.$RTCMultiwayMessageHandler5=function(){k.$RTCMultiwayMessageHandler4=c('Arbiter').subscribe(c('ChannelConstants').getArbiterType('rtc_multi_json'),function(l,m){this.$RTCMultiwayMessageHandler6(m.obj);}.bind(this));};k.prototype.$RTCMultiwayMessageHandler6=function(l){var m=new (c('FBRTCMultiwayMessage'))(l);if(!m.isRequest())return;if(this.$RTCMultiwayMessageHandler1===m.conferenceName())this.$RTCMultiwayMessageHandler7(m);};k.prototype.$RTCMultiwayMessageHandler7=function(l){var m=new h(new i(),l);m.start().then(function(n){if(n!=null)if(n.dismissRequest()!=null){var o=c('RTCCallStore').getState(),p=o.callInfo,q=o.connections;if(n.serverInfoData()===p.serverInfoData){c('RTCGroupCallActions').handleDismissRequest(m,n);k.close();q.forEach(function(r){return r.close();});c('RTCCallActions').removeAllLocalStreams(true);}}else if(n.serverMediaUpdateRequest()!=null){c('RTCMWSessionDescription').serverMediaUpdate(n.serverMediaUpdateRequest(),function(r){return m.sendResponse(n.createResponse(j.OK,{serverMediaUpdateResponse:{currentVersion:r}}));});}else if(n.conferenceStateRequest()!=null)c('RTCGroupCallActions').handleConferenceStateRequest(m,n,this.$RTCMultiwayMessageHandler3,function(r){this.$RTCMultiwayMessageHandler3=r;}.bind(this));}.bind(this)).done();};f.exports=k;}),null);
__d('RTCCallType',['keyMirror'],(function a(b,c,d,e,f,g){'use strict';var h=c('keyMirror')({AUDIO_ONLY:null,VIDEO_ONLY:null,AUDIO_VIDEO:null,NO_AUDIO_VIDEO:null});f.exports=h;}),null);
__d('RTCP2PConstants',['keyMirror'],(function a(b,c,d,e,f,g){'use strict';var h=c('keyMirror')({INIT:null,CONTACTING:null,RINGING:null,CONNECTING:null,RECONNECTING:null,CONNECTED:null,DISCONNECTED:null});f.exports={ConnectionStatus:h};}),null);
__d('RTCP2PCallStoreState',['immutable','RTCSignalingExperiments','RTCCallType','RTCP2PConstants','RTCP2PProtocolHandler'],(function a(b,c,d,e,f,g){'use strict';var h,i,j=c('RTCP2PConstants').ConnectionStatus,k={callType:c('RTCCallType').AUDIO_ONLY,connectionStatus:j.INIT,endCallReason:null,isScreenContentPoppedOut:false,protocolHandler:new (c('RTCP2PProtocolHandler'))(),signalingExperiments:new (c('RTCSignalingExperiments'))()};h=babelHelpers.inherits(l,c('immutable').Record(k));i=h&&h.prototype;function l(){h.apply(this,arguments);}f.exports=l;}),null);
__d('RTCP2PCallStore',['FluxReduceStore','RTCP2PCallStoreState','RTCGroupCallDispatcher','RTCP2PCallReducer'],(function a(b,c,d,e,f,g){'use strict';var h,i,j=c('RTCP2PCallReducer').callEnd,k=c('RTCP2PCallReducer').processCallType,l=c('RTCP2PCallReducer').processConnectionStatus,m=c('RTCP2PCallReducer').processEndCallReason,n=c('RTCP2PCallReducer').processPoppedOutScreenContent,o=c('RTCP2PCallReducer').processSignalingExperiments,p=[j,k,l,m,n,o,function(r,s){return r;}];h=babelHelpers.inherits(q,c('FluxReduceStore'));i=h&&h.prototype;q.prototype.getInitialState=function(){return new (c('RTCP2PCallStoreState'))();};q.prototype.reduce=function(r,s){return p.reduce(function(t,u){return u(t,s);},r);};function q(){h.apply(this,arguments);}f.exports=new q(c('RTCGroupCallDispatcher'));}),null);
__d('RTCP2PCallWindowHandler',['RTCCallStore','RTCP2PCallStore','RTCP2PConstants'],(function a(b,c,d,e,f,g){'use strict';var h=c('RTCP2PConstants').ConnectionStatus,i=void 0,j={init:function k(l){if(this._isWindowOpened())this.close();i=l;this.updateCallInProgressIndicator();this._monitorOpenerForChanges();},updateCallInProgressIndicator:function k(l){if(!this._isWindowOpened())return;var m=c('RTCCallStore').getState(),n=m.remoteUsers,o=l?l:c('RTCP2PCallStore').getState().connectionStatus;if(!n.count()||o===h.DISCONNECTED){i.rtcCallInProgessWith=null;}else i.rtcCallInProgessWith=n.first().getUserID().toString();},reload:function k(){if(this._isWindowOpened())i.location.reload();},close:function k(){if(this._isWindowOpened())i.close();},_monitorOpenerForChanges:function k(){if(i.opener)try{i.opener.addEventListener('unload',function(event){this._passWindowToOpener();}.bind(this));}catch(l){}},_passWindowToOpener:function k(){var l=arguments.length<=0||arguments[0]===undefined?10:arguments[0];setTimeout(function(){if(!this._isWindowOpened()||l<=1)return;if(i.opener&&!i.opener.closed){i.opener.rtcCallChildWindow=i;}else this._passWindowToOpener(l-1);}.bind(this),1000);},_isWindowOpened:function k(){return !!(i&&!i.closed);}};f.exports=j;}),null);
__d('RTCCallActions',['RTCCallActionTypes','RTCGroupCallActionTypes','RTCGroupCallDispatcher','RTCP2PCallWindowHandler','RTCUtils','emptyFunction','mixInEventEmitter'],(function a(b,c,d,e,f,g){'use strict';var h={addListener:c('emptyFunction'),emit:c('emptyFunction'),initialize:function i(j,k,l,m,n){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').INIT,conferenceName:k,callID:m,serverInfoData:l,protocol:j,callTrigger:n});},setCallSummary:function i(j){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').SET_CALL_SUMMARY,callSummary:j});},call:function i(j,k){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').CALL,usersToRing:j,peerConnection:k});},callSuccess:function i(){var j=arguments.length<=0||arguments[0]===undefined?false:arguments[0];c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').CALL_SUCCESS,connected:j});},incomingCallSuccess:function i(){c('RTCGroupCallDispatcher').dispatch({type:c('RTCCallActionTypes').INCOMING_CALL_SUCCESS});},callError:function i(j){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').CALL_ERROR,endCallReason:c('RTCUtils').endCallReasonFromResponseStatusCode(j),endCallSubreason:'Call error: '+(j||0)});},hangupSuccess:function i(){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').HANGUP_SUCCESS});},hangupError:function i(j){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').HANGUP_ERROR,error:j});},redial:function i(){c('RTCP2PCallWindowHandler').reload();},join:function i(j){this.call([],j);},hangup:function i(j,k){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').HANGUP,hangupReason:j,detailedReasonString:k,endCallReason:c('RTCUtils').endCallReasonFromHangupReason(j)});},initLocalUser:function i(j){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').INIT_LOCAL_USER,localUser:j});},initRemoteUsers:function i(j){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').INIT_REMOTE_USERS,remoteUsers:j});},addLocalStream:function i(j){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').ADD_LOCAL_STREAM,stream:j});},removeLocalStream:function i(j){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').REMOVE_LOCAL_STREAM,stream:j});},removeAllLocalStreams:function i(){var j=arguments.length<=0||arguments[0]===undefined?false:arguments[0];c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').REMOVE_ALL_LOCAL_STREAMS,stopStreams:j});},removeAllLocalScreenStreams:function i(){var j=arguments.length<=0||arguments[0]===undefined?false:arguments[0];c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').REMOVE_ALL_LOCAL_SCREEN_STREAMS,stopStreams:j});},addRemoteStream:function i(j,k){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').ADD_REMOTE_STREAM,stream:j,userID:k});},removeRemoteStream:function i(j,k){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').REMOVE_REMOTE_STREAM,stream:j,userID:k});},removeAllRemoteStreams:function i(j){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').REMOVE_ALL_REMOTE_STREAMS,userID:j});},addRemoteTrack:function i(j,k){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').ADD_REMOTE_TRACK,stream:j,track:k});},removeRemoteTrack:function i(j,k){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').REMOVE_REMOTE_TRACK,stream:j,track:k});},addLocalScreenStream:function i(j){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').ADD_LOCAL_SCREEN_STREAM,stream:j});},removeLocalScreenStream:function i(j){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').REMOVE_LOCAL_SCREEN_STREAM,stream:j});},addRemoteScreenStream:function i(j,k){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').ADD_REMOTE_SCREEN_STREAM,stream:j,userID:k});},removeRemoteScreenStream:function i(j,k){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').REMOVE_REMOTE_SCREEN_STREAM,stream:j,userID:k});},endCall:function i(j,k){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').END_CALL,endCallReason:j,endCallSubreason:k});},waitForUserInput:function i(){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').WAIT_FOR_USER_INPUT});},toggleMuteAudio:function i(j){c('RTCGroupCallDispatcher').dispatch({type:j?c('RTCGroupCallActionTypes').AUDIO_UNMUTED:c('RTCGroupCallActionTypes').AUDIO_MUTED});},toggleMuteVideo:function i(j){c('RTCGroupCallDispatcher').dispatch({type:j?c('RTCGroupCallActionTypes').VIDEO_UNMUTED:c('RTCGroupCallActionTypes').VIDEO_MUTED});},toggleMuteRemoteVideo:function i(j,k){c('RTCGroupCallDispatcher').dispatch({type:j?c('RTCCallActionTypes').REMOTE_VIDEO_MUTED:c('RTCCallActionTypes').REMOTE_VIDEO_UNMUTED,userID:k});},toggleSelfView:function i(j){c('RTCGroupCallDispatcher').dispatch({type:j?c('RTCGroupCallActionTypes').SELF_VIEW_COLLAPSED:c('RTCGroupCallActionTypes').SELF_VIEW_UNCOLLAPSED});},submitRating:function i(j){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').SUBMIT_RATING,rating:j});},submitFeedback:function i(j){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').SUBMIT_FEEDBACK,feedback:j});},ratingShown:function i(){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').RATING_SHOWN});},feedbackShown:function i(){c('RTCGroupCallDispatcher').dispatch({type:c('RTCGroupCallActionTypes').FEEDBACK_SHOWN});}};c('mixInEventEmitter')(h,{onIceConnectionStateChange:true});f.exports=h;}),null);
__d('FBRTCCallSummaryReducer',['FBRTCCallSummaryStore','FBRTCLogger','RTCCallStore','RTCConferenceState','RTCGroupCallActionTypes'],(function a(b,c,d,e,f,g){'use strict';var h=c('FBRTCLogger').Key,i={setCallSummary:function j(k,l){switch(l.type){case c('RTCGroupCallActionTypes').SET_CALL_SUMMARY:return k.set('callSummary',l.callSummary);}return k;},onCallStarted:function j(k,l){switch(l.type){case c('RTCGroupCallActionTypes').CALL_SUCCESS:k.callSummary.onCallConnected();k.callSummary.save(c('FBRTCCallSummaryStore').getInstance());var m=function n(){var o=c('RTCCallStore').getState().callInfo.conferenceState;if(o!==c('RTCConferenceState').TERMINATED){k.callSummary.save(c('FBRTCCallSummaryStore').getInstance());setTimeout(n,10000);}};m();return k;}return k;},onMessageSignaling:function j(k,l){switch(l.type){case c('RTCGroupCallActionTypes').ON_JOIN_RESPONSE:k.callSummary.setServerInfoData(l.serverInfoData);k.callSummary.save(c('FBRTCCallSummaryStore').getInstance());return k;}return k;},onCallEnded:function j(k,l){switch(l.type){case c('RTCGroupCallActionTypes').CALL_ERROR:case c('RTCGroupCallActionTypes').HANGUP:case c('RTCGroupCallActionTypes').END_CALL:k.callSummary.onCallEnded(l.endCallReason,false,false,l.endCallSubreason);k.callSummary.save(c('FBRTCCallSummaryStore').getInstance());return k;case c('RTCGroupCallActionTypes').DISMISS:k.callSummary.onCallEnded(l.endCallReason,true,false,l.endCallSubreason);k.callSummary.save(c('FBRTCCallSummaryStore').getInstance());return k;}return k;},onSurveyResult:function j(k,l){switch(l.type){case c('RTCGroupCallActionTypes').RATING_SHOWN:k.callSummary.addExtraInfo(h.RATING_SHOWN,'1');k.callSummary.save(c('FBRTCCallSummaryStore').getInstance());return k;case c('RTCGroupCallActionTypes').FEEDBACK_SHOWN:k.callSummary.addExtraInfo(h.SURVEY_SHOWN,'1');k.callSummary.save(c('FBRTCCallSummaryStore').getInstance());return k;case c('RTCGroupCallActionTypes').SUBMIT_RATING:k.callSummary.addExtraInfo(h.RATING,l.rating);k.callSummary.save(c('FBRTCCallSummaryStore').getInstance());return k;case c('RTCGroupCallActionTypes').SUBMIT_FEEDBACK:k.callSummary.addExtraInfo(h.SURVEY_DETAILS,l.feedback);k.callSummary.save(c('FBRTCCallSummaryStore').getInstance());return k;}return k;}};f.exports=i;}),null);
__d('RTCCallReducer',['immutable','MultiwayTypes','RTCCallActionTypes','RTCConferenceState','RTCGroupCallActionTypes','RTCMWProtocolHandler','RTCUtils'],(function a(b,c,d,e,f,g){'use strict';var h=c('MultiwayTypes').ParticipantCallState,i=c('MultiwayTypes').RtcResponseStatusCode;function j(z,aa){switch(aa.type){case c('RTCGroupCallActionTypes').INIT:return z.mergeDeep(c('immutable').fromJS({callInfo:{conferenceName:aa.conferenceName,serverInfoData:aa.serverInfoData,protocol:aa.protocol}}));}return z;}function k(z,aa){switch(aa.type){case c('RTCGroupCallActionTypes').CALL:return z.mergeDeep(c('immutable').fromJS({connections:z.connections.add(aa.peerConnection),callInfo:{conferenceState:c('RTCConferenceState').CONNECTING}}));case c('RTCGroupCallActionTypes').CALL_ERROR:return z.setIn(['callInfo','conferenceState'],c('RTCConferenceState').TERMINATED);case c('RTCGroupCallActionTypes').CALL_SUCCESS:if(aa.connected)return z.setIn(['callInfo','conferenceState'],c('RTCConferenceState').CONNECTED);return z;}return z;}function l(z,aa){switch(aa.type){case c('RTCCallActionTypes').INCOMING_CALL_SUCCESS:return z.setIn(['callInfo','conferenceState'],c('RTCConferenceState').CONNECTED);}return z;}function m(z,aa){switch(aa.type){case c('RTCGroupCallActionTypes').HANGUP:return z.mergeDeep(c('immutable').fromJS({connections:new (c('immutable').Set)(),remoteUsers:new (c('immutable').Set)(),callInfo:{conferenceState:c('RTCConferenceState').TERMINATING}}));case c('RTCGroupCallActionTypes').DISMISS:aa.transaction.sendResponse(aa.request.createResponse(i.OK,{}));case c('RTCGroupCallActionTypes').HANGUP_ERROR:case c('RTCGroupCallActionTypes').HANGUP_SUCCESS:return z.setIn(['callInfo','conferenceState'],c('RTCConferenceState').TERMINATED);case c('RTCGroupCallActionTypes').END_CALL:return z.setIn(['callInfo','conferenceState'],c('RTCConferenceState').TERMINATED);}return z;}function n(z,aa){switch(aa.type){case c('RTCGroupCallActionTypes').ADD_PARTICIPANTS:c('RTCMWProtocolHandler').addParticipants(z.callInfo.conferenceName,z.callInfo.serverInfoData,aa.usersToInvite.map(function(ba){return ba.getUserID();}));return z.mergeDeep(c('immutable').fromJS({remoteUsers:aa.usersToInvite.filter(function(ba){return z.remoteUsers.every(function(ca){return ca.getUserID()!==ba.getUserID();});})}));}return z;}function o(z,aa){switch(aa.type){case c('RTCGroupCallActionTypes').ON_CONFERENCE_STATE:var ba=aa.transaction,ca=aa.request,da=aa.request.conferenceStateRequest();if(aa.conferenceStateVersion>=da.version){ba.sendResponse(ca.createResponse(i.OK,{ConferenceStateResponse:{currentVerison:aa.conferenceStateVersion}}));return z;}aa.resolve(da.version);var ea=z.remoteUsers.map(function(ha){var ia=da.participantStates[ha.getUserID()];return ia?ha.setParticipantState(ia):ha;}),fa=ea.some(function(ha){var ia=ha.getParticipantState();return ia&&ia.state===h.CONNECTED;}),ga=fa?c('RTCConferenceState').CONNECTED:z.callInfo.conferenceState;ba.sendResponse(ca.createResponse(i.OK,{ConferenceStateResponse:{currentVerison:aa.conferenceStateVersion}}));return z.setIn(['remoteUsers'],ea).setIn(['callInfo','conferenceState'],ga);}return z;}function p(z,aa){switch(aa.type){case c('RTCGroupCallActionTypes').ON_JOIN_RESPONSE:return z.setIn(['callInfo','serverInfoData'],aa.serverInfoData);}return z;}function q(z,aa){switch(aa.type){case c('RTCGroupCallActionTypes').INIT_LOCAL_USER:return z.set('localUser',aa.localUser);case c('RTCGroupCallActionTypes').INIT_REMOTE_USERS:return z.set('remoteUsers',aa.remoteUsers);}return z;}function r(z,aa){switch(aa.type){case c('RTCGroupCallActionTypes').ADD_LOCAL_STREAM:return z.set('localUser',z.localUser.addStream(aa.stream));case c('RTCGroupCallActionTypes').REMOVE_LOCAL_STREAM:return z.set('localUser',z.localUser.removeStream(aa.stream));case c('RTCGroupCallActionTypes').REMOVE_ALL_LOCAL_STREAMS:if(aa.stopStreams)for(var ba=z.localUser.getStreams(),ca=Array.isArray(ba),da=0,ba=ca?ba:ba[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var ea;if(ca){if(da>=ba.length)break;ea=ba[da++];}else{da=ba.next();if(da.done)break;ea=da.value;}var fa=ea;c('RTCUtils').stopMediaStream(fa);}return z.set('localUser',z.localUser.removeAllStreams());}return z;}function s(z,aa){switch(aa.type){case c('RTCGroupCallActionTypes').ADD_LOCAL_SCREEN_STREAM:return z.set('localUser',z.localUser.addScreenStream(aa.stream));case c('RTCGroupCallActionTypes').REMOVE_LOCAL_SCREEN_STREAM:return z.set('localUser',z.localUser.removeScreenStream(aa.stream));case c('RTCGroupCallActionTypes').REMOVE_ALL_LOCAL_SCREEN_STREAMS:if(aa.stopStreams)for(var ba=z.localUser.getScreenStreams(),ca=Array.isArray(ba),da=0,ba=ca?ba:ba[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var ea;if(ca){if(da>=ba.length)break;ea=ba[da++];}else{da=ba.next();if(da.done)break;ea=da.value;}var fa=ea;c('RTCUtils').stopMediaStream(fa);}return z.set('localUser',z.localUser.removeAllScreenStreams());}return z;}function t(z,aa){var ba=void 0;switch(aa.type){case c('RTCGroupCallActionTypes').ADD_REMOTE_STREAM:ba=x(z,aa);if(!ba)return z;return z.setIn(['remoteUsers'],z.remoteUsers['delete'](ba).add(ba.addStream(aa.stream)));case c('RTCGroupCallActionTypes').REMOVE_REMOTE_STREAM:ba=x(z,aa);if(!ba)return z;return z.setIn(['remoteUsers'],z.remoteUsers['delete'](ba).add(ba.removeStream(aa.stream)));case c('RTCGroupCallActionTypes').REMOVE_ALL_REMOTE_STREAMS:ba=x(z,aa);if(!ba)return z;return z.setIn(['remoteUsers'],z.remoteUsers['delete'](ba).add(ba.removeAllStreams().removeAllScreenStreams()));}return z;}function u(z,aa){var ba=void 0;switch(aa.type){case c('RTCGroupCallActionTypes').ADD_REMOTE_TRACK:ba=x(z,aa);if(!ba)return z;return z.setIn(['remoteUsers'],z.remoteUsers['delete'](ba).add(ba.clone()));case c('RTCGroupCallActionTypes').REMOVE_REMOTE_TRACK:ba=x(z,aa);if(!ba)return z;return z.setIn(['remoteUsers'],z.remoteUsers['delete'](ba).add(ba.clone()));}return z;}function v(z,aa){var ba=void 0;switch(aa.type){case c('RTCGroupCallActionTypes').ADD_REMOTE_SCREEN_STREAM:ba=x(z,aa);if(!ba)return z;return z.setIn(['remoteUsers'],z.remoteUsers['delete'](ba).add(ba.addScreenStream(aa.stream)));case c('RTCGroupCallActionTypes').REMOVE_REMOTE_SCREEN_STREAM:ba=x(z,aa);if(!ba)return z;return z.setIn(['remoteUsers'],z.remoteUsers['delete'](ba).add(ba.removeScreenStream(aa.stream)));}return z;}function w(z,aa){var ba=void 0;switch(aa.type){case c('RTCGroupCallActionTypes').TOGGLE_REMOTE_STREAM:return z.set('remoteUsers',Object.entries(aa.mediaStatus).reduce(function(ca,da){var ea=da[0],fa=da[1],ga=ca.reduce(function(ja,ka){var la=ka.getStreams().map(function(ma){return ma.getTracks().find(function(na){return na.id===ea;});}).find(Boolean);return la?{user:ka,track:la}:ja;},{}),ha=ga.user,ia=ga.track;if(ha&&ia){if(ia.kind==='audio'&&ha.isAudioMuted()===fa)return ca['delete'](ha).add(ha.toggleMuteAudio());if(ia.kind==='video'&&ha.isVideoMuted()===fa)return ca['delete'](ha).add(ha.toggleMuteVideo());}return ca;},z.remoteUsers));case c('RTCCallActionTypes').REMOTE_VIDEO_MUTED:ba=x(z,aa);if(!ba)return z;return z.setIn(['remoteUsers'],z.remoteUsers['delete'](ba).add(ba.toggleMuteVideo(true)));case c('RTCCallActionTypes').REMOTE_VIDEO_UNMUTED:ba=x(z,aa);if(!ba)return z;return z.setIn(['remoteUsers'],z.remoteUsers['delete'](ba).add(ba.toggleMuteVideo(false)));}return z;}function x(z,aa){return z.remoteUsers.find(function(ba){if(aa.userID)return ba.getUserID()==aa.userID;return ba.getUserID()===aa.stream.id.split(':')[0];});}function y(z,aa){switch(aa.type){case c('RTCGroupCallActionTypes').WAIT_FOR_USER_INPUT:if(z.callInfo.conferenceState===c('RTCConferenceState').NEW)return z.setIn(['callInfo','conferenceState'],c('RTCConferenceState').AWAITING_USER_START);return z;}return z;}f.exports={callInit:j,callStart:k,callEnd:m,addParticipants:n,incomingCallStart:l,initUsers:q,processLocalStream:r,processLocalScreenStream:s,processRemoteStream:t,processRemoteScreenStream:v,processRemoteTrack:u,toggleRemoteStream:w,processConferenceState:o,processJoinResponse:p,waitForUserInput:y};}),null);
__d('RTCP2PCallActions',['RTCGroupCallDispatcher','RTCP2PCallActionTypes'],(function a(b,c,d,e,f,g){'use strict';var h={setCallType:function i(j){c('RTCGroupCallDispatcher').dispatch({type:c('RTCP2PCallActionTypes').SET_CALL_TYPE,callType:j});},setConnectionStatus:function i(j){c('RTCGroupCallDispatcher').dispatch({type:c('RTCP2PCallActionTypes').SET_CONNECTION_STATUS,connectionStatus:j});},setEndCallReason:function i(j){c('RTCGroupCallDispatcher').dispatch({type:c('RTCP2PCallActionTypes').SET_END_CALL_REASON,endCallReason:j});},setRemoteSignalingExperiments:function i(j){c('RTCGroupCallDispatcher').dispatch({type:c('RTCP2PCallActionTypes').SET_REMOTE_SIGNALING_EXPERIMENTS,remoteSignalingExperiments:j});},togglePopOutScreenContent:function i(j){c('RTCGroupCallDispatcher').dispatch({type:j?c('RTCP2PCallActionTypes').POP_OUT_SCREEN_CONTENT:c('RTCP2PCallActionTypes').POP_IN_SCREEN_CONTENT,stream:j});}};f.exports=h;}),null);
__d("XScreenSharingController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/videocall\/screen_sharing\/",{peer_id:{type:"Int",required:true}});}),null);
__d('RTCScreenSharingWindowHandler',['RTCP2PCallActions','XScreenSharingController','randomInt'],(function a(b,c,d,e,f,g){var h=void 0,i={open:function j(k){window.getRemoteMediaStream=function(){return k;};window.closeScreenSharingWindow=this._onUnload;h=window.open(this._getUnsignedUri(),'Screen Sharing',this._getWindowFeatures());if(window.focus&&this.isWindowOpened())h.focus();},close:function j(){if(h){var k=null;if(h.opener&&!h.opener.closed)k=h.opener;h.close();h=null;if(k)k.postMessage({recipient:'SC_CONTENT_SCRIPT',type:'SC_RESET_PORT',text:'reset comm port'},'*');}},isWindowOpened:function j(){return !!(h&&!h.closed);},_onUnload:function j(){c('RTCP2PCallActions').togglePopOutScreenContent();},_getWindowFeatures:function j(){var k=screen.availLeft,l=screen.availTop,m=Math.min(960,screen.width-k),n=Math.min(540,screen.height-l),o={height:'height='+n.toString(),width:'width='+m.toString(),top:'top='+l.toString(),left:'left='+k.toString()};return ['menubar=no','location=no','scrollbars=no','status=no','personalbar=no',o.height,o.width,o.top,o.left].join(',');},_getUnsignedUri:function j(){var k=c('randomInt')(0,4294967295);return c('XScreenSharingController').getURIBuilder().setInt('peer_id',k).getURI();}};f.exports=i;}),null);
__d('RTCP2PCallReducer',['RTCGroupCallActionTypes','RTCP2PCallActionTypes','RTCP2PCallWindowHandler','RTCScreenSharingWindowHandler'],(function a(b,c,d,e,f,g){'use strict';function h(n,o){switch(o.type){case c('RTCGroupCallActionTypes').HANGUP:case c('RTCGroupCallActionTypes').DISMISS:case c('RTCGroupCallActionTypes').HANGUP_ERROR:case c('RTCGroupCallActionTypes').HANGUP_SUCCESS:case c('RTCGroupCallActionTypes').END_CALL:case c('RTCGroupCallActionTypes').REMOVE_REMOTE_SCREEN_STREAM:c('RTCScreenSharingWindowHandler').close();return n.set('isScreenContentPoppedOut',c('RTCScreenSharingWindowHandler').isWindowOpened());}return n;}function i(n,o){switch(o.type){case c('RTCP2PCallActionTypes').SET_CALL_TYPE:return n.set('callType',o.callType);}return n;}function j(n,o){switch(o.type){case c('RTCP2PCallActionTypes').SET_CONNECTION_STATUS:c('RTCP2PCallWindowHandler').updateCallInProgressIndicator(o.connectionStatus);return n.set('connectionStatus',o.connectionStatus);}return n;}function k(n,o){switch(o.type){case c('RTCP2PCallActionTypes').SET_END_CALL_REASON:return n.set('endCallReason',o.endCallReason);}return n;}function l(n,o){switch(o.type){case c('RTCP2PCallActionTypes').POP_IN_SCREEN_CONTENT:c('RTCScreenSharingWindowHandler').close();return n.set('isScreenContentPoppedOut',c('RTCScreenSharingWindowHandler').isWindowOpened());case c('RTCP2PCallActionTypes').POP_OUT_SCREEN_CONTENT:c('RTCScreenSharingWindowHandler').open(o.stream);return n.set('isScreenContentPoppedOut',c('RTCScreenSharingWindowHandler').isWindowOpened());default:return n;}}function m(n,o){switch(o.type){case c('RTCP2PCallActionTypes').SET_REMOTE_SIGNALING_EXPERIMENTS:return n.set('signalingExperiments',n.signalingExperiments.setRemote(o.remoteSignalingExperiments));}return n;}f.exports={callEnd:h,processCallType:i,processConnectionStatus:j,processEndCallReason:k,processPoppedOutScreenContent:l,processSignalingExperiments:m};}),null);
__d('FBRTCGroupCallVideoEscalationDialog.react',['fbt','MessengerDialog.react','MessengerDialogBody.react','MessengerDialogButton.react','MessengerDialogCancelButton.react','MessengerDialogFooter.react','React','RTCMWProtocolHandler'],(function a(b,c,d,e,f,g,h){'use strict';var i=function j(k){var l=k.userName,m=k.onToggle;return (c('React').createElement(c('MessengerDialog.react'),{onToggle:m},c('React').createElement(c('MessengerDialogBody.react'),null,h._("{name} added video chat. Would you like to share your video?",[h.param('name',l)])),c('React').createElement(c('MessengerDialogFooter.react'),null,c('React').createElement(c('MessengerDialogCancelButton.react'),null),c('React').createElement(c('MessengerDialogButton.react'),{label:h._("Share Video"),onClick:function n(){new (c('RTCMWProtocolHandler'))().videoEscalation();m();},type:'primary'}))));};f.exports=i;}),null);
__d('RTCSessionDescription',['FBRTCSdpUtils','FBRTCExperiment','MultiwayTypes','FBRTCConstants'],(function a(b,c,d,e,f,g){var h=c('MultiwayTypes').MediaType,i=c('FBRTCConstants').SignalingProtocol,j=window.RTCSessionDescription||window.mozRTCSessionDescription,k=2,l='o',m='m',n='a',o='rtpmap',p='ssrc-group',q='ssrc',r='cname',s='msid',t='mslabel',u='label',v='sendonly',w='recvonly',x='sendrecv',y='inactive',z='offer',aa='answer',ba='=',ca=' ',da=':',ea='\r\n',fa='audio',ga='video',ha=function oa(pa,qa){return pa.startsWith(qa+ba);},ia=function oa(pa){return pa.substr(k);},ja=function oa(pa,qa){return pa.startsWith(qa+ea)||pa.startsWith(qa+da);},ka=function oa(pa,qa){return pa.substr(qa.length+1);};function la(oa){'use strict';this.$SessionDescription1=[];this.$SessionDescription2='-';this.$SessionDescription3='multiway';this.$SessionDescription4=1;this.$SessionDescription5='IN';this.$SessionDescription6='IP4';this.$SessionDescription7='127.0.0.1';oa.forEach(function(pa){if(ha(pa,l)){var qa=ia(pa).split(ca);if(qa.length==6){this.$SessionDescription2=qa[0];this.$SessionDescription3=qa[1];this.$SessionDescription4=parseInt(qa[2],10);this.$SessionDescription5=qa[3];this.$SessionDescription6=qa[4];this.$SessionDescription7=qa[5];}}this.$SessionDescription1.push(pa);}.bind(this));}la.prototype.setVersion=function(oa){'use strict';this.$SessionDescription4=oa;};la.prototype.getVersion=function(){'use strict';return this.$SessionDescription4;};la.prototype.toSdp=function(){'use strict';return this.$SessionDescription1.map(function(oa){if(ha(oa,l)){return l+ba+this.$SessionDescription2+ca+this.$SessionDescription3+ca+this.$SessionDescription4+ca+this.$SessionDescription5+ca+this.$SessionDescription6+ca+this.$SessionDescription7;}else return oa;}.bind(this)).join(ea);};function ma(oa,pa){var qa=arguments.length<=2||arguments[2]===undefined?{}:arguments[2];'use strict';this.$MediaDescription1=[];var ra={},sa=[],ta=[];oa.forEach(function(ua){var va=ia(ua);if(ha(ua,m))this.$MediaDescription4=va.split(ca)[0];if(ha(ua,n)&&ja(va,o)){var wa=ka(va,o),xa=wa.split(ca),ya=xa[0],za=xa[1];ra[za]=ya;}if(ha(ua,n)&&ja(va,q)){this.$MediaDescription6(va,sa);}else if(ha(ua,n)&&ja(va,p)){this.$MediaDescription7(va,ta);}else if(ha(ua,n)&&(va===v||va===w||va===x||va===y)){this.$MediaDescription5=va;}else this.$MediaDescription1.push(ua);}.bind(this));Object.keys(qa).forEach(function(ua){if(ra[ua]){var va=Object.keys(qa[ua]).map(function(wa){return wa+'='+qa[ua][wa];}).join(';');this.$MediaDescription1.push('a=fmtp:'+ra[ua]+' '+va);}}.bind(this));this.$MediaDescription3={};this.$MediaDescription2={};sa.forEach(function(ua){if(ua.hasOwnProperty(r)){var va=ua.cname;if(!this.$MediaDescription3[va]){this.$MediaDescription3[va]=[ua];}else this.$MediaDescription3[va].push(ua);var wa=this.findSsrcGroupForSsrc(ta,ua.ssrc);if(wa){if(!this.$MediaDescription2[va]){this.$MediaDescription2[va]=[wa];}else this.$MediaDescription2[va].push(wa);this.removeSsrcGroup(wa,ta);}}}.bind(this));if(pa===z){if(sa.length===0){this.$MediaDescription5=w;}else this.$MediaDescription5=x;}else if(pa===aa)this.$MediaDescription5=x;}ma.prototype.getMediaType=function(){'use strict';return this.$MediaDescription4;};ma.prototype.findSsrcGroupForSsrc=function(oa,pa){'use strict';return oa.find(function(qa){var ra=qa.ssrcs;return ra.some(function(sa){return sa===pa;});});};ma.prototype.addStreamsForEndpoint=function(oa,pa){'use strict';this.$MediaDescription3[oa]=pa;};ma.prototype.addSsrcGroupsForEndpoint=function(oa,pa){'use strict';this.$MediaDescription3[oa].forEach(function(qa){var ra=qa.ssrc,sa=this.findSsrcGroupForSsrc(pa,ra);if(sa){if(!this.$MediaDescription2[oa]){this.$MediaDescription2[oa]=[sa];}else this.$MediaDescription2[oa].push(sa);this.removeSsrcGroup(sa,pa);}}.bind(this));};ma.prototype.removeSsrcGroup=function(oa,pa){'use strict';var qa=pa.indexOf(oa);if(qa!==-1)pa.splice(qa,1);};ma.prototype.$MediaDescription7=function(oa,pa){'use strict';var qa=ka(oa,p);if(qa){var ra=qa.split(ca),sa=ra[0],ta=ra.slice(1);pa.push({semantics:sa,ssrcs:ta.map(function(ua){return parseInt(ua,10);})});}};ma.prototype.$MediaDescription6=function(oa,pa){'use strict';var qa=oa.indexOf(ca),ra=oa.substr(0,qa),sa=parseInt(ka(ra,q),10),ta=oa.substr(qa+1),ua=pa.find(function(wa){return wa.ssrc===sa;});if(!ua){ua={};ua.ssrc=sa;pa.push(ua);}if(ja(ta,r)){ua.cname=ka(ta,r);}else if(ja(ta,s)){var va=ka(ta,s).split(ca);ua.msid={id:va[0],appdata:va[1]};}else if(ja(ta,t)){ua.mslabel=ka(ta,t);}else if(ja(ta,u))ua.label=ka(ta,u);};ma.prototype.toSdp=function(){'use strict';var oa=[];this.$MediaDescription1.forEach(function(ra){oa.push(ra);});for(var pa in this.$MediaDescription2)this.$MediaDescription2[pa].forEach(function(ra){oa.push(n+ba+p+da+ra.semantics+ca+ra.ssrcs.join(ca));});oa.push(n+ba+this.$MediaDescription5);for(var qa in this.$MediaDescription3)this.$MediaDescription3[qa].forEach(function(ra){if(ra.cname)oa.push(n+ba+q+da+ra.ssrc+ca+r+da+ra.cname);if(ra.msid)oa.push(n+ba+q+da+ra.ssrc+ca+s+da+ra.msid.id+(ra.msid.appdata?ca+ra.msid.appdata:''));if(ra.mslabel)oa.push(n+ba+q+da+ra.ssrc+ca+t+da+ra.mslabel);if(ra.label)oa.push(n+ba+q+da+ra.ssrc+ca+u+da+ra.label);});return oa.join(ea);};function na(oa,pa){var qa=arguments.length<=2||arguments[2]===undefined?{}:arguments[2];'use strict';var ra=pa||{},sa=ra.type,ta=sa===undefined?'offer':sa,ua=ra.sdp,va=ua===undefined?'':ua;this.$RTCSessionDescription1=oa;this.type=ta;if(oa===i.P2P){if(this.type==='offer'){var wa=[];if(qa.DISABLE_VIDEO)wa.push(function(bb){return c('FBRTCSdpUtils').disableVideo(bb);});wa.push(function(bb){return c('FBRTCSdpUtils').addIceOptionToSdp(bb,'fb-force-5245');},function(bb){return c('FBRTCSdpUtils').replaceRTPSAVPFProfile(bb);},function(bb){return c('FBRTCSdpUtils').preferIsac(bb);},function(bb){return c('FBRTCSdpUtils').removeSdparta(bb);});if(qa.ADD_AUDIO_NACK)wa.push(function(bb){return c('FBRTCSdpUtils').addAudioNack(bb);});this.$RTCSessionDescription2=wa.reduce(function(bb,cb){return cb(bb);},va);}else this.$RTCSessionDescription2=c('FBRTCSdpUtils').addIceOptionToSdp(va,'fb-force-5245');}else{var xa=va.trim().split(ea),ya=0,za=[];while(ya<xa.length&&!ha(xa[ya],m)){za.push(xa[ya]);ya++;}this.sessionDescription=new la(za);this.mediaDescriptions=[];while(ya<xa.length){var ab=[];ab.push(xa[ya]);ya++;while(ya<xa.length&&!ha(xa[ya],m)){ab.push(xa[ya]);ya++;}this.mediaDescriptions.push(new ma(ab,this.type,qa.FORMAT_PARAMETERS));}}}na.prototype.processServerMediaUpdate=function(oa){'use strict';var pa=oa.sourceKey,qa=oa.media,ra=oa.ssrcGroups,sa=[],ta=[];qa.forEach(function(ua){ua.ssrcs.forEach(function(va){var wa={ssrc:va,cname:pa,msid:{id:pa,appdata:ua.id},label:ua.id,mslabel:pa};if(h.AUDIO===ua.type){sa.push(wa);}else if(h.VIDEO===ua.type)ta.push(wa);});});this.mediaDescriptions.forEach(function(ua){if(ua.getMediaType()===fa){ua.addStreamsForEndpoint(pa,sa);ua.addSsrcGroupsForEndpoint(pa,ra);}else if(ua.getMediaType()===ga){ua.addStreamsForEndpoint(pa,ta);ua.addSsrcGroupsForEndpoint(pa,ra);}});};na.prototype.toDesc=function(){'use strict';return new j({type:this.type,sdp:this.toSdp()});};na.prototype.toSdp=function(){'use strict';var oa=this.$RTCSessionDescription1;switch(oa){case i.P2P:return this.$RTCSessionDescription2;case i.MULTIWAY:return this.sessionDescription.toSdp()+ea+this.mediaDescriptions.map(function(pa){return pa.toSdp();}).join(ea)+ea;default:throw new Error('Unknown signaling protocol '+oa);}};na.prototype.strongDiff=function(oa){'use strict';var pa=this.toSdp(),qa=oa.toSdp();return pa!==qa&&this.$RTCSessionDescription3(pa)!==this.$RTCSessionDescription3(qa);};na.prototype.$RTCSessionDescription3=function(oa){'use strict';return this.$RTCSessionDescription4(oa).split('\r\n').filter(function(pa){return !/^a=(candidate|setup):/.test(pa);}).join('\r\n');};na.prototype.$RTCSessionDescription4=function(oa){'use strict';return oa.replace(/(o=\S+\s\S+)\s\S+\s/,'$1 - ');};f.exports=na;}),null);
__d("XGroupCallSendRequestController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/groupcall\/sendrequest\/",{webrtc_fbtrace:{type:"Int"}});}),null);
__d('MultiwayRequests',['Promise','RTCSessionDescription','RTCUtils','XGroupCallSendRequestController','AsyncRequest','MultiwayTypes'],(function a(b,c,d,e,f,g){'use strict';var h=15000,i=c('MultiwayTypes').MessageType,j=c('MultiwayTypes').Capability;function k(){}k.prototype.sendJoinRequest=function(l,m,n,o,p,q){var r=c('RTCUtils').createRequestHeader(i.JOIN,m,n),s={offer:{sdpString:o.toSdp()},deviceCapabilities:[j.SUPPORT_AUDIO,j.SUPPORT_VIDEO]};if(p&&p.length>0)s.usersToCall=p;if(q)s.mediaStatus=q;var t={endpoint:l,jsonPayload:{header:r,body:{joinRequest:s}}};return this.$MultiwayRequests1(t);};k.prototype.sendHangupRequest=function(l,m,n,o,p){var q=c('RTCUtils').createRequestHeader(i.HANGUP,m,n),r={reason:o,detailedReasonString:p},s={endpoint:l,jsonPayload:{header:q,body:{hangupRequest:r}}};return this.$MultiwayRequests1(s);};k.prototype.sendAddParticipantsRequest=function(l,m,n,o){var p=c('RTCUtils').createRequestHeader(i.ADD_PARTICIPANTS,m,n),q={usersToInvite:o},r={endpoint:l,jsonPayload:{header:p,body:{addParticipantsRequest:q}}};return this.$MultiwayRequests1(r);};k.prototype.sendSubscriptionRequest=function(l,m,n,o){return this.$MultiwayRequests1({endpoint:l,jsonPayload:{header:c('RTCUtils').createRequestHeader(i.SUBSCRIPTION,m,n),body:{subscriptionRequest:{subscriptions:o}}}});};k.prototype.sendClientMediaUpdateRequest=function(l,m,n,o,p,q){return this.$MultiwayRequests1({endpoint:l,jsonPayload:{header:c('RTCUtils').createRequestHeader(i.CLIENT_MEDIA_UPDATE,m,n),body:{clientMediaUpdateRequest:{fromVersion:o,toVersion:p,mediaUpdates:q}}}});};k.prototype.$MultiwayRequests1=function(l){return new (c('Promise'))(function(m,n){var o=c('XGroupCallSendRequestController').getURIBuilder().getURI(),p=new (c('AsyncRequest'))(o).setMethod('POST').setData({request:JSON.stringify(l)}).setAllowCrossPageTransition(true).setHandler(function(q){m(q.payload);}).setErrorHandler(function(q){var r=Error(q.getErrorDescription?q.getErrorDescription():'AsyncRequest error');n(r);}).setTimeoutHandler(h,function(){n('Timeout');});p.send();});};f.exports=new k();}),null);
__d('RTCPeerConnection',['Promise','regeneratorRuntime','FBRTCSdpUtils','Map','RTCSessionDescription','UserAgent','FBRTCConstants'],(function a(b,c,d,e,f,g){'use strict';var h=c('FBRTCConstants').SignalingProtocol,i=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,j=window.RTCIceCandidate||window.mozRTCPeerConnection;function k(n){var o=arguments.length<=1||arguments[1]===undefined?{}:arguments[1],p=arguments.length<=2||arguments[2]===undefined?{}:arguments[2];this.$RTCPeerConnection3=[];this.$RTCPeerConnection6=new (c('Map'))();this.addEventListener=function(q,r){m('PC add event listener %o',q);var s=this.$RTCPeerConnection6.get(q);if(!Array.isArray(s)){s=[];this.$RTCPeerConnection6.set(q,s);}s.push(r);this.$RTCPeerConnection4.addEventListener(q,r);};this.removeEventListener=function(q,r){m('PC remove event listener %o',q);var s=this.$RTCPeerConnection6.get(q);if(!Array.isArray(s))return;s=s.filter(function(t){return t!==r;});if(s.length<1){this.$RTCPeerConnection6['delete'](q);}else this.$RTCPeerConnection6.set(q,s);this.$RTCPeerConnection4.removeEventListener(q,r);};this.$RTCPeerConnection8=function(q){var r=q.candidate;if(r){this.$RTCPeerConnection3.push(r);m('PC add local ICE candidate %o',r);}}.bind(this);this.$RTCPeerConnection5=n;this.$RTCPeerConnection1=o;this.$RTCPeerConnection2=p;this.$RTCPeerConnection4=this.$RTCPeerConnection7();}k.prototype.$RTCPeerConnection7=function(){var n=new i(this.$RTCPeerConnection1,this.$RTCPeerConnection2);n.addEventListener('icecandidate',this.$RTCPeerConnection8);for(var o=this.$RTCPeerConnection6.entries(),p=Array.isArray(o),q=0,o=p?o:o[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var r;if(p){if(q>=o.length)break;r=o[q++];}else{q=o.next();if(q.done)break;r=q.value;}var s=r,t=s[0],u=s[1];for(var v=u,w=Array.isArray(v),x=0,v=w?v:v[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var y;if(w){if(x>=v.length)break;y=v[x++];}else{x=v.next();if(x.done)break;y=x.value;}var z=y;n.addEventListener(t,z);}}return n;};k.prototype.reset=function(){m('PC reset');var n=this.$RTCPeerConnection4;for(var o=this.$RTCPeerConnection6.entries(),p=Array.isArray(o),q=0,o=p?o:o[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var r;if(p){if(q>=o.length)break;r=o[q++];}else{q=o.next();if(q.done)break;r=q.value;}var s=r,t=s[0],u=s[1];for(var v=u,w=Array.isArray(v),x=0,v=w?v:v[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var y;if(w){if(x>=v.length)break;y=v[x++];}else{x=v.next();if(x.done)break;y=x.value;}var z=y;n.removeEventListener(t,z);}}n.removeEventListener('icecandidate',this.$RTCPeerConnection8);this.$RTCPeerConnection3=[];this.$RTCPeerConnection4=this.$RTCPeerConnection7();for(var aa=n.getLocalStreams(),ba=Array.isArray(aa),ca=0,aa=ba?aa:aa[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var da;if(ba){if(ca>=aa.length)break;da=aa[ca++];}else{ca=aa.next();if(ca.done)break;da=ca.value;}var ea=da;this.$RTCPeerConnection4.addStream(ea);}return c('Promise').race([function(fa){var ga=this.$RTCPeerConnection4,ha=function ia(ja){var ka=ja.target;if(ka.iceConnectionState!=='checking'&&ka.iceConnectionState!=='new'){fa();ga.removeEventListener('iceconnectionstatechange',ia);l(n);}};ga.addEventListener('iceconnectionstatechange',ha);}.bind(this),function(fa){return setTimeout(fa,5000);}].map(function(fa){return new (c('Promise'))(fa);}))['catch'](function(fa){return c('Promise').resolve();}).then(function(){l(n);});};k.prototype.close=function(){m('PC close');l(this.$RTCPeerConnection4);};k.prototype.getCreatedIceCandidates=function(){return this.$RTCPeerConnection3;};k.prototype.onReceivedRemoteIceCandidate=function(n){var o=n.sdp,p=n.label,q=n.sdp_mid,r=new j({sdpMLineIndex:p,candidate:c('FBRTCSdpUtils').fixMobileIceSdp(o),sdpMid:q});this.$RTCPeerConnection4.addIceCandidate(r);m('PC add remote ICE candidate %o',r);};k.prototype.getLocalStreams=function(){return this.$RTCPeerConnection4.getLocalStreams();};k.prototype.getRemoteStreams=function(){return this.$RTCPeerConnection4.getRemoteStreams();};k.prototype.addStream=function(n){this.$RTCPeerConnection4.addStream(n);};k.prototype.removeStream=function(n){this.$RTCPeerConnection4.removeStream(n);};k.prototype.createOffer=function n(){var o=arguments.length<=0||arguments[0]===undefined?{}:arguments[0],p=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];return c('regeneratorRuntime').async(function q(r){while(1)switch(r.prev=r.next){case 0:m('PC create %o','offer');o=babelHelpers['extends']({},o,{mandatory:{OfferToReceiveAudio:true,OfferToReceiveVideo:true}});return r.abrupt('return',this.$RTCPeerConnection4.createOffer(o).then(function(s){return new (c('RTCSessionDescription'))(this.$RTCPeerConnection5,s,{FORMAT_PARAMETERS:p});}.bind(this)));case 3:case 'end':return r.stop();}},null,this);};k.prototype.createAnswer=function n(){return c('regeneratorRuntime').async(function o(p){while(1)switch(p.prev=p.next){case 0:m('PC create %o','answer');return p.abrupt('return',this.$RTCPeerConnection4.createAnswer().then(function(q){return new (c('RTCSessionDescription'))(this.$RTCPeerConnection5,q);}.bind(this)));case 2:case 'end':return p.stop();}},null,this);};k.prototype.setLocalDescription=function n(o){return c('regeneratorRuntime').async(function p(q){while(1)switch(q.prev=q.next){case 0:m('PC set %o description %o','local',o);return q.abrupt('return',this.$RTCPeerConnection4.setLocalDescription(o.toDesc()).then(function(){return o;}));case 2:case 'end':return q.stop();}},null,this);};k.prototype.setRemoteDescription=function n(o){return c('regeneratorRuntime').async(function p(q){while(1)switch(q.prev=q.next){case 0:m('PC set %o description %o','remote',o);return q.abrupt('return',this.$RTCPeerConnection4.setRemoteDescription(o.toDesc()).then(function(){return o;}));case 2:case 'end':return q.stop();}},null,this);};k.prototype.getLocalDescription=function(){return new (c('RTCSessionDescription'))(this.$RTCPeerConnection5,this.$RTCPeerConnection4.localDescription);};k.prototype.getRemoteDescription=function(){return new (c('RTCSessionDescription'))(this.$RTCPeerConnection5,this.$RTCPeerConnection4.remoteDescription);};k.prototype.getSignalingState=function(){return this.$RTCPeerConnection4.signalingState;};k.prototype.getIceGatheringState=function(){return this.$RTCPeerConnection4.iceGatheringState;};k.prototype.getIceConnectionState=function(){return this.$RTCPeerConnection4.iceConnectionState;};k.prototype.getStats=function(){if(c('UserAgent').isBrowser('Firefox'))return c('Promise').resolve(this.$RTCPeerConnection4.getStats());return new (c('Promise'))(function(n,o){this.$RTCPeerConnection4.getStats(n,o);}.bind(this)).then(function(n){var o={};for(var p=n.result(),q=Array.isArray(p),r=0,p=q?p:p[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var s;if(q){if(r>=p.length)break;s=p[r++];}else{r=p.next();if(r.done)break;s=r.value;}var t=s,u={id:t.id,timestamp:t.timestamp,type:t.type};for(var v=t.names(),w=Array.isArray(v),x=0,v=w?v:v[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var y;if(w){if(x>=v.length)break;y=v[x++];}else{x=v.next();if(x.done)break;y=x.value;}var z=y;u[z]=t.stat(z);}o[u.id]=u;}return o;});};k.prototype.createDataChannel=function(n,o){return this.$RTCPeerConnection4.createDataChannel(n,o);};function l(n){if(n&&n.signalingState!=='closed')n.close();}function m(){}f.exports=k;}),null);
__d('RTCMWProtocolHandler',['regeneratorRuntime','Promise','ChannelManager','CurrentUser','FBRTCCallSummary','FBRTCCallSummaryStore','MultiwayRequests','RTCCallActions','RTCCallStore','RTCConfig','RTCGroupCallActions','RTCMultiwayMessageHandler','RTCPeerConnection','RTCSessionDescription','RTCUtils','FBRTCConstants','MultiwayTypes'],(function a(b,c,d,e,f,g){'use strict';var h=c('FBRTCConstants').CallEndReason,i=c('FBRTCConstants').IceConnectionState,j=c('FBRTCConstants').SignalingProtocol,k=c('MultiwayTypes').RtcResponseStatusCode,l='229895473858072',m=25000,n={appId:l,deviceId:c('ChannelManager').getCompleteConfig().sessionID,userId:c('CurrentUser').getID()};c('ChannelManager').startChannelManager();function o(){var p=arguments.length<=0||arguments[0]===undefined?null:arguments[0];this.$RTCMWProtocolHandler4=function(q){var r=q.target;c('RTCCallActions').emit('onIceConnectionStateChange',r.iceConnectionState);switch(r.iceConnectionState){case i.DISCONNECTED:case i.FAILED:if(!this.$RTCMWProtocolHandler2)this.$RTCMWProtocolHandler2=setTimeout(function(){c('RTCCallActions').endCall(h.CONNECTION_DROPPED,'ConnectionDropped');var s=c('RTCCallStore').getState(),t=s.connections;c('RTCMultiwayMessageHandler').close();t.forEach(function(u){return u.close();});c('RTCCallActions').removeAllLocalStreams(true);},m);break;default:clearTimeout(this.$RTCMWProtocolHandler2);this.$RTCMWProtocolHandler2=null;}}.bind(this);this.$RTCMWProtocolHandler1=p;}o.prototype.startCall=function(p,q,r,s,t){var u=arguments.length<=5||arguments[5]===undefined?{}:arguments[5];c('RTCCallActions').initialize(j.MULTIWAY,r,s,this.$RTCMWProtocolHandler1,t);var v=c('FBRTCCallSummary').restoreOrInitialize(c('FBRTCCallSummaryStore').getInstance(),-1,this.$RTCMWProtocolHandler1,!s);t&&v.onCallStarted(t);v.onPopupOpened();v.setConferenceName(r);v.setServerInfoData(s);v.save(c('FBRTCCallSummaryStore').getInstance());c('RTCCallActions').setCallSummary(v);var w={mandatory:{},optional:[{googNumUnsignalledRecvStreams:10},{googHighBitrate:true},{googVeryHighBitrate:true}]};if(!c('RTCConfig').RtcUseDtlsGK)w.optional.push({DtlsSrtpKeyAgreement:false});var x=new (c('RTCPeerConnection'))(j.MULTIWAY,{iceServers:[]},w);x.addEventListener('addstream',function(event){event.stream.onaddtrack=function(y){var z=y.target,aa=y.track;c('RTCCallActions').addRemoteTrack(z,aa);};event.stream.onremovetrack=function(y){var z=y.target,aa=y.track;c('RTCCallActions').removeRemoteTrack(z,aa);};c('RTCCallActions').addRemoteStream(event.stream);this.$RTCMWProtocolHandler3(c('RTCCallStore').getState().callInfo.conferenceName,c('RTCCallStore').getState().callInfo.serverInfoData,c('RTCCallStore').getState().connections.first().getRemoteStreams().map(function(y){var z=y.id;return {cname:z};}));}.bind(this));x.addEventListener('removestream',function(event){c('RTCCallActions').removeRemoteStream(event.stream);});x.addEventListener('iceconnectionstatechange',this.$RTCMWProtocolHandler4);this.$RTCMWProtocolHandler5(x,q,r,s,p,u);if(!s){c('RTCCallActions').call(p,x);}else c('RTCCallActions').join(x);return x;};o.prototype.videoEscalation=function(){return c('RTCUtils').initLocalStream(true).then(function(p){var q=c('RTCCallStore').getState(),r=q.callInfo,s=r.conferenceName,t=r.serverInfoData,u=q.connections,v=q.localUser;p.getTracks().forEach(function(x){if(x.kind==='audio')x.enabled=!v.isAudioMuted();});var w=v.getStreams().first();u.first().removeStream(w);return this.$RTCMWProtocolHandler6(u.first(),[p],s,t,[]).then(function(){c('RTCCallActions').removeLocalStream(w);c('RTCCallActions').addLocalStream(p);});}.bind(this));};o.endCall=function(p,q,r){var s=arguments.length<=3||arguments[3]===undefined?'':arguments[3];c('RTCCallActions').hangup(r,s);c('MultiwayRequests').sendHangupRequest(n,p,q,r,s||'Hangup by user').done(c('RTCCallActions').hangupSuccess,c('RTCCallActions').hangupError);var t=c('RTCCallStore').getState(),u=t.connections;c('RTCMultiwayMessageHandler').close();u.forEach(function(v){return v.close();});c('RTCCallActions').removeAllLocalStreams(true);};o.prototype.iceRestart=function(p,q){this.$RTCMWProtocolHandler6(c('RTCCallStore').getState().connections.first(),[],p,q,[],{iceRestart:true});};o.addParticipants=function(p,q,r){c('MultiwayRequests').sendAddParticipantsRequest(n,p,q,r);};o.prototype.$RTCMWProtocolHandler3=function(p,q,r){c('MultiwayRequests').sendSubscriptionRequest(n,p,q,r);};o.clientMediaUpdate=function(p,q,r,s,t){c('MultiwayRequests').sendClientMediaUpdateRequest(n,p,q,r,s,t).then(function(u){var v=u.header.responseStatusCode,w=u.body.clientMediaUpdateResponse.currentVersion;return c('RTCGroupCallActions').onClientMediaUpdateResponse(v,w);})['catch'](function(u){});};o.prototype.$RTCMWProtocolHandler5=function(p,q,r,s,t,u){this.$RTCMWProtocolHandler7(r,s);this.$RTCMWProtocolHandler6(p,q,r,s,t,{},u).done(function(v){return c('RTCCallActions').callSuccess();},function(v){c('RTCCallActions').callError(v);var w=c('RTCCallStore').getState(),x=w.connections;c('RTCMultiwayMessageHandler').close();x.forEach(function(y){return y.close();});c('RTCCallActions').removeAllLocalStreams(true);});};o.prototype.$RTCMWProtocolHandler6=function p(q,r,s,t,u){var v=arguments.length<=5||arguments[5]===undefined?{}:arguments[5],w=arguments.length<=6||arguments[6]===undefined?{}:arguments[6],x,y,z,aa,ba,ca;return c('regeneratorRuntime').async(function da(ea){while(1)switch(ea.prev=ea.next){case 0:x={};y=[];r.forEach(function(fa){y.concat(fa.getTracks());q.addStream(fa);});y.forEach(function(fa){x[fa.id]=true;});ea.next=6;return c('regeneratorRuntime').awrap(q.createOffer(v,w));case 6:z=ea.sent;ea.next=9;return c('regeneratorRuntime').awrap(c('MultiwayRequests').sendJoinRequest(n,s,t,z,u.length>0?u:null,y.length>0?x:null));case 9:aa=ea.sent;ba=aa.header.responseStatusCode;if(!(ba!==k.OK)){ea.next=13;break;}return ea.abrupt('return',new (c('Promise'))(function(fa,ga){ga(ba);}));case 13:c('RTCGroupCallActions').onJoinResponse(aa.header.serverInfoData);ca=new (c('RTCSessionDescription'))(j.MULTIWAY,{type:'answer',sdp:aa.body.joinResponse.answer.sdpString},{FORMAT_PARAMETERS:w});ea.next=17;return c('regeneratorRuntime').awrap(q.setLocalDescription(z));case 17:ea.next=19;return c('regeneratorRuntime').awrap(q.setRemoteDescription(ca));case 19:c('RTCGroupCallActions').toggleRemoteStream(aa.body.joinResponse.mediaStatus);return ea.abrupt('return',q);case 21:case 'end':return ea.stop();}},null,this);};o.prototype.$RTCMWProtocolHandler7=function(p,q){c('RTCMultiwayMessageHandler').initHandler(p,q);};f.exports=o;}),null);
__d('FBRTCGroupCallIncomingController',['FBRTCCallSummary','FBRTCCallSummaryStore','FBRTCConstants','FBRTCGroupCallIncomingDialog','FBRTCSupport','MessengerRTCGroupCallIncomingDialogController','MessengerRTCGroupCallUnsupportedBrowserDialogController','MultiwayTypes','RTCMWProtocolHandler','RTCUtils','FBRTCCallUIWrapper','FBRTCTransactions','RTCConfig','FBRTCMultiwayMessage'],(function a(b,c,d,e,f,g){var h,i,j=c('FBRTCTransactions').FBRTCTransactionOwner,k=c('FBRTCTransactions').FBRTCServerTransaction,l=c('MultiwayTypes').HangupReason,m=c('MultiwayTypes').Capability,n=c('MultiwayTypes').RtcResponseStatusCode,o=c('MultiwayTypes').DeviceStatus,p=c('MultiwayTypes').RingType;h=babelHelpers.inherits(q,j);i=h&&h.prototype;function q(r){'use strict';i.constructor.call(this);this.$FBRTCGroupCallIncomingController1=r;this.$FBRTCGroupCallIncomingController2=null;}q.prototype.onMessageReceived=function(r){'use strict';var s=new (c('FBRTCMultiwayMessage'))(r),t=this.getTransaction(s);t.start().then(function(u){if(u!=null)if(u.ringRequest()!=null){if(!c('RTCUtils').isGroupCall(u.conferenceName())&&!c('RTCConfig').RTCConferencingP2PCanReceiveGK)return;var v=c('RTCUtils').generateRandomInt(),w=new (c('FBRTCCallSummary'))({peerID:-1,callID:v,isCaller:false});if(!c('FBRTCSupport').isGroupCallWebtrcSupported()){w.onCallEnded(c('FBRTCConstants').CallEndReason.UNSUPPORTED_VERSION,false);w.save(c('FBRTCCallSummaryStore').getInstance());var x=u.ringRequest(),y=x.ringType;c('MessengerRTCGroupCallUnsupportedBrowserDialogController').render({hasVideo:c('RTCConfig').RtcConferencingVideoGK&&(y===p.GROUP_VIDEO_CALL||y===p.PEER_VIDEO_CALL)});return;}t.sendResponse(this.handleRingRequest(u,v,w));}else if(u.dismissRequest()!=null)t.sendResponse(this.handleDismissRequest(u));}.bind(this),function(u){}).done();};q.prototype.cancelIncomingCallDialog=function(){'use strict';if(this.$FBRTCGroupCallIncomingController2){this.$FBRTCGroupCallIncomingController2.cancel();this.$FBRTCGroupCallIncomingController2=null;}};q.prototype.handleDismissRequest=function(r){'use strict';c('MessengerRTCGroupCallUnsupportedBrowserDialogController').unmount();if(this.$FBRTCGroupCallIncomingController2){var s=this.$FBRTCGroupCallIncomingController2.serverInfoData();if(s==r.serverInfoData())this.cancelIncomingCallDialog();}return r.createResponse(n.OK,{});};q.prototype.handleRingRequest=function(r,s,t){'use strict';var u=r.ringRequest(),v=r.serverInfoData();if(u==null||v==null)return r.createResponse(n.BAD_REQUEST);var w=u.caller,x=u.otherParticipants,y=c('RTCConfig').RtcConferencingVideoGK&&(u.ringType==p.GROUP_VIDEO_CALL||u.ringType==p.PEER_VIDEO_CALL),z=new this.$FBRTCGroupCallIncomingController1(r.conferenceName(),s,w,x,y,v);z.addListener('answerCall',function(ba,ca){c('FBRTCCallUIWrapper').openGroupCallURI(ba,s,y,v,'answer button',t);});z.addListener('ignoreCall',function(){c('RTCMWProtocolHandler').endCall(r.conferenceName(),v,l.IGNORE_CALL);t.onCallEnded(c('FBRTCConstants').CallEndReason.IGNORE_CALL,false);t.save(c('FBRTCCallSummaryStore').getInstance());this.cancelIncomingCallDialog();}.bind(this));z.addListener('timeout',function(){c('RTCMWProtocolHandler').endCall(r.conferenceName(),v,l.NO_ANSWER_TIMEOUT);t.onCallEnded(c('FBRTCConstants').CallEndReason.NO_ANSWER_TIMEOUT,false);t.save(c('FBRTCCallSummaryStore').getInstance());this.cancelIncomingCallDialog();}.bind(this));this.$FBRTCGroupCallIncomingController2=z;z.showIncomingDialog();var aa={deviceCapabilities:[m.SUPPORT_AUDIO,m.SUPPORT_VIDEO],deviceStatus:o.OK};return r.createResponse(n.OK,{ringResponse:aa});};f.exports=q;}),null);