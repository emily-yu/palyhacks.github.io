if (self.CavalryLogger) { CavalryLogger.start_js(["tikRa"]); }

__d('FBRTCIceStatsParser',[],(function a(b,c,d,e,f,g){var h=null;i.getInstance=function(){'use strict';if(!h)h=new i();return h;};function i(){'use strict';}i.prototype.extractIceInfo=function(j){'use strict';var k=[],l=j.split("\r\n");for(var m=0;m<l.length;m++){var n=l[m];if(this.$FBRTCIceStatsParser1(n))k.push({gen:this.$FBRTCIceStatsParser2(n),type:this.$FBRTCIceStatsParser3(n)});}return k;};i.prototype.$FBRTCIceStatsParser1=function(j){'use strict';return j.indexOf('candidate:')>-1;};i.prototype.$FBRTCIceStatsParser2=function(j){'use strict';var k=0,l=j.match(/generation (\d+)/);if(l)k=parseInt(l[1],10);return k;};i.prototype.$FBRTCIceStatsParser3=function(j){'use strict';var k=j.match(/typ (host|relay|srflx|prflx)/);if(k){return k[1];}else return 'unknown';};f.exports=i;}),null);
__d('FBRTCCallSummary',['FBRTCConstants','FBRTCIceStatsParser','FBRTCLogger','FBRTCUtils','SiteData','UserAgentData','performanceNow'],(function a(b,c,d,e,f,g){var h=5*60*1000,i={CALL_STARTED:'started',POPUP_OPENED:'opened',SENT_OFFER:'s_o',RECV_OFFER:'r_o',SENT_OFFER_ACK:'s_oack',RECV_OFFER_ACK:'r_oack',SENT_RETRIED_OFFER:'s_o2',RECV_RETRIED_OFFER:'r_o2',SENT_RETRIED_OFFER_ACK:'s_oack2',RECV_RETRIED_OFFER_ACK:'r_oack2',SENT_PRANSWER:'s_pr',RECV_PRANSWER:'r_pr',NETWORK_READY:'network_ready',SENT_ANSWER:'s_a',RECV_ANSWER:'r_a',SENT_ANSWER_ACK:'s_aack',RECV_ANSWER_ACK:'r_aack',SENT_RETRIED_ANSWER:'s_a2',RECV_RETRIED_ANSWER:'r_a2',SENT_RETRIED_ANSWER_ACK:'s_aack2',RECV_RETRIED_ANSWER_ACK:'r_aack2',SENT_OK:'s_ok',RECV_OK:'r_ok',CALL_CONNECTED:'connected',CALL_ENDED:'ended'};j.CURRENT_SUMMARY_VERSION=19;function j(k){'use strict';this.peerID=k.peerID;this.callID=k.callID;this.$FBRTCCallSummary1=k.isCaller;this.$FBRTCCallSummary2=c('FBRTCUtils').getLocalUploadLogLevel();this.$FBRTCCallSummary3=new Date().valueOf();this.$FBRTCCallSummary4=null;this.$FBRTCCallSummary5={};this.$FBRTCCallSummary6=null;this.$FBRTCCallSummary7=null;this.$FBRTCCallSummary8=null;this.$FBRTCCallSummary9=null;this.$FBRTCCallSummary10=null;this.$FBRTCCallSummary11=null;this.$FBRTCCallSummary12={};this.$FBRTCCallSummary13={};this.$FBRTCCallSummary14={};this.$FBRTCCallSummary15={};this.$FBRTCCallSummary16={};this.$FBRTCCallSummary17={};this.$FBRTCCallSummary18=c('performanceNow')();this.$FBRTCCallSummary19=0;this.$FBRTCCallSummary20={};this.$FBRTCCallSummary21=this.$FBRTCCallSummary18;this.$FBRTCCallSummary22=0;this.$FBRTCCallSummary23={};this.addExtraInfo(c('FBRTCLogger').Key.DEVICE_INFO,this.$FBRTCCallSummary24());this.$FBRTCCallSummary25();this.$FBRTCCallSummary26=c('FBRTCIceStatsParser').getInstance();this.$FBRTCCallSummary27=c('FBRTCLogger').getInstance();}j.prototype.toJsonString=function(){'use strict';this.$FBRTCCallSummary10=new Date().valueOf();return JSON.stringify({version:j.CURRENT_SUMMARY_VERSION,peerID:this.peerID,callID:this.callID,isCaller:this.$FBRTCCallSummary1,uploadLogLevel:this.$FBRTCCallSummary2,callType:this.$FBRTCCallSummary28,conferenceName:this.$FBRTCCallSummary29,serverInfoData:this.$FBRTCCallSummary30,localVideoDuration:this.$FBRTCCallSummary31,remoteVideoDuration:this.$FBRTCCallSummary32,startTime:this.$FBRTCCallSummary3,trigger:this.$FBRTCCallSummary4,signalingTime:this.$FBRTCCallSummary5,endCallReason:this.$FBRTCCallSummary6,endCallSubreason:this.$FBRTCCallSummary7,isRemoteEnded:this.$FBRTCCallSummary8,lastUpdatedTime:this.$FBRTCCallSummary9,lastSerializedTime:this.$FBRTCCallSummary10,unsetOnRetrieve:this.$FBRTCCallSummary11,openCount:this.$FBRTCCallSummary22,extraInfo:this.$FBRTCCallSummary23,pcStats:this.$FBRTCCallSummary12,captureStats:this.$FBRTCCallSummary13,gen0IceSentCount:this.$FBRTCCallSummary14,gen0IceReceivedCount:this.$FBRTCCallSummary15,iceSentCount:this.$FBRTCCallSummary16,iceReceivedCount:this.$FBRTCCallSummary17,newSignalingTime:this.$FBRTCCallSummary20,accumulatedCallTime:this.$FBRTCCallSummary33()});};j.fromJsonString=function(k){'use strict';var l;try{l=JSON.parse(k);}catch(m){return null;}if(l.version!==j.CURRENT_SUMMARY_VERSION)return null;if(!l.hasOwnProperty('peerID')||!l.hasOwnProperty('callID')||!l.hasOwnProperty('isCaller')||!l.hasOwnProperty('startTime')||!l.hasOwnProperty('trigger')||!l.hasOwnProperty('signalingTime')||!l.hasOwnProperty('endCallReason')||!l.hasOwnProperty('isRemoteEnded')||!l.hasOwnProperty('lastUpdatedTime')||!l.hasOwnProperty('lastSerializedTime'))return null;var n=new j({peerID:l.peerID,callID:l.callID,isCaller:l.isCaller});n.$FBRTCCallSummary2=l.uploadLogLevel;n.$FBRTCCallSummary3=l.startTime;n.$FBRTCCallSummary4=l.trigger;n.$FBRTCCallSummary5=l.signalingTime;n.$FBRTCCallSummary6=l.endCallReason;n.$FBRTCCallSummary7=l.endCallSubreason;n.$FBRTCCallSummary8=l.isRemoteEnded;n.$FBRTCCallSummary9=l.lastUpdatedTime;n.$FBRTCCallSummary10=l.lastSerializedTime;if(l.callType)n.$FBRTCCallSummary28=l.callType;if(l.conferenceName)n.$FBRTCCallSummary29=l.conferenceName;if(l.serverInfoData)n.$FBRTCCallSummary30=l.serverInfoData;if(l.localVideoDuration)n.$FBRTCCallSummary31=l.localVideoDuration;if(l.remoteVideoDuration)n.$FBRTCCallSummary32=l.remoteVideoDuration;if(l.unsetOnRetrieve)n.$FBRTCCallSummary11=l.unsetOnRetrieve;if(l.openCount)n.$FBRTCCallSummary22=l.openCount;if(l.extraInfo)n.$FBRTCCallSummary23=l.extraInfo;if(l.pcStats)n.$FBRTCCallSummary12=l.pcStats;if(l.captureStats)n.$FBRTCCallSummary13=l.captureStats;if(l.gen0IceSentCount)n.$FBRTCCallSummary14=l.gen0IceSentCount;if(l.gen0IceReceivedCount)n.$FBRTCCallSummary15=l.gen0IceReceivedCount;if(l.iceSentCount)n.$FBRTCCallSummary16=l.iceSentCount;if(l.iceReceivedCount)n.$FBRTCCallSummary17=l.iceReceivedCount;if(l.newSignalingTime)n.$FBRTCCallSummary20=l.newSignalingTime;if(l.accumulatedCallTime)n.$FBRTCCallSummary19=l.accumulatedCallTime;return n;};j.restoreOrInitialize=function(k,l,m,n,o){'use strict';var p=k.retrieveCallSummary(l,m);if(!p){p=new j({peerID:l,callID:m,isCaller:n});if(o){p.onFullMessageReceived({msg:o});p.onOfferAckSent(o);}else p.onCallStarted(c('FBRTCLogger').Trigger.UNKNOWN);c('FBRTCLogger').getInstance().logError(l,m,'Missing call summary from storage');}else if(p.$FBRTCCallSummary11){p.$FBRTCCallSummary6=null;p.$FBRTCCallSummary7=null;p.$FBRTCCallSummary8=null;delete p.$FBRTCCallSummary5[i.CALL_ENDED];delete p.$FBRTCCallSummary20[i.CALL_ENDED];p.$FBRTCCallSummary11=null;}return p;};j.logSavedSummaries=function(k){'use strict';var l=k.getLoggableSummaries(),m=l.length;if(m<=0)return;var n=c('FBRTCLogger').getInstance(),o=[];for(var p=0;p<m;p++){var q=l[p];n.logEndCallSummary(q);o.push({peerID:q.peerID,callID:q.callID});}k.removeCallSummaries(o);n.logToConsole('Logged pending summaries: '+m);};j.prototype.save=function(k){'use strict';var l=c('performanceNow')(),m=l-this.$FBRTCCallSummary21;if(m>h){this.$FBRTCCallSummary27.logInfo(this.peerID,this.callID,'Summary too old: '+m);return;}k.storeCallSummary(this.peerID,this.callID,this);this.$FBRTCCallSummary21=l;};j.prototype.getLastUpdatedTime=function(){'use strict';return this.$FBRTCCallSummary9;};j.prototype.setLastUpdatedTime=function(k){'use strict';this.$FBRTCCallSummary9=k;};j.prototype.getExtraInfo=function(){'use strict';return this.$FBRTCCallSummary23;};j.prototype.addExtraInfo=function(k,l){'use strict';this.$FBRTCCallSummary23[k]=l;this.$FBRTCCallSummary25();};j.prototype.onCallStarted=function(k){'use strict';this.$FBRTCCallSummary4=k;this.$FBRTCCallSummary34(i.CALL_STARTED);this.$FBRTCCallSummary25();};j.prototype.onPopupOpened=function(){'use strict';this.$FBRTCCallSummary34(i.POPUP_OPENED);this.$FBRTCCallSummary22++;this.$FBRTCCallSummary25();};j.prototype.setPcStats=function(k){'use strict';this.$FBRTCCallSummary12=k;this.$FBRTCCallSummary25();};j.prototype.setVideoCaptureStats=function(k,l){'use strict';this.$FBRTCCallSummary13={w:k,h:l};this.$FBRTCCallSummary25();};j.prototype.setUploadLogLevel=function(k){'use strict';this.$FBRTCCallSummary2=k;this.$FBRTCCallSummary25();};j.prototype.setCallType=function(k){'use strict';this.$FBRTCCallSummary28=k;this.$FBRTCCallSummary25();};j.prototype.setVideoDurations=function(k,l){'use strict';this.$FBRTCCallSummary31=k;this.$FBRTCCallSummary32=l;this.$FBRTCCallSummary25();};j.prototype.setConferenceName=function(k){'use strict';this.$FBRTCCallSummary29=k;this.$FBRTCCallSummary25();};j.prototype.setServerInfoData=function(k){'use strict';this.$FBRTCCallSummary30=k;this.$FBRTCCallSummary25();};j.prototype.onOfferAckSent=function(k){'use strict';this.onMessageSent({type:c('FBRTCConstants').PayloadType.OFFER_ACK,flag:k.flag});};j.prototype.onMessageSent=function(k){'use strict';var l=k.flag===1;switch(k.type){case c('FBRTCConstants').PayloadType.OFFER:this.$FBRTCCallSummary35(l,i.SENT_OFFER,i.SENT_RETRIED_OFFER);this.$FBRTCCallSummary36(k,this.$FBRTCCallSummary14,this.$FBRTCCallSummary16);break;case c('FBRTCConstants').PayloadType.ANSWER:this.$FBRTCCallSummary35(l,i.SENT_ANSWER,i.SENT_RETRIED_ANSWER);this.$FBRTCCallSummary36(k,this.$FBRTCCallSummary14,this.$FBRTCCallSummary16);break;case c('FBRTCConstants').PayloadType.OK:this.$FBRTCCallSummary34(i.SENT_OK);break;case c('FBRTCConstants').PayloadType.PRANSWER:this.$FBRTCCallSummary34(i.SENT_PRANSWER);break;case c('FBRTCConstants').PayloadType.OFFER_ACK:this.$FBRTCCallSummary35(l,i.SENT_OFFER_ACK,i.SENT_RETRIED_OFFER_ACK);break;case c('FBRTCConstants').PayloadType.ANSWER_ACK:this.$FBRTCCallSummary35(l,i.SENT_ANSWER_ACK,i.SENT_RETRIED_ANSWER_ACK);break;case c('FBRTCConstants').PayloadType.ICE_CANDIDATE:this.$FBRTCCallSummary36(k,this.$FBRTCCallSummary14,this.$FBRTCCallSummary16);break;default:}this.$FBRTCCallSummary25();};j.prototype.$FBRTCCallSummary36=function(k,l,m){'use strict';var n=null,o=null,p=this.$FBRTCCallSummary26.extractIceInfo(k.sdp);for(var q=0;q<p.length;q++){n=p[q].gen;o=p[q].type;if(n===0)this.$FBRTCCallSummary37(l,o);this.$FBRTCCallSummary37(m,o);}};j.prototype.$FBRTCCallSummary37=function(k,l){'use strict';if(!k[l]){k[l]=1;}else k[l]=k[l]+1;};j.prototype.$FBRTCCallSummary38=function(k){'use strict';if(k.isFromMobile())this.addExtraInfo(c('FBRTCLogger').Key.PEER_IS_MOBILE,'1');};j.prototype.onFullMessageReceived=function(k){'use strict';var l=k.msg,m=l.flag===1;switch(l.type){case c('FBRTCConstants').PayloadType.OFFER:this.$FBRTCCallSummary38(k);this.$FBRTCCallSummary35(m,i.RECV_OFFER,i.RECV_RETRIED_OFFER);this.$FBRTCCallSummary36(l,this.$FBRTCCallSummary15,this.$FBRTCCallSummary17);break;case c('FBRTCConstants').PayloadType.ANSWER:this.$FBRTCCallSummary38(k);this.$FBRTCCallSummary35(m,i.RECV_ANSWER,i.RECV_RETRIED_ANSWER);this.$FBRTCCallSummary36(l,this.$FBRTCCallSummary15,this.$FBRTCCallSummary17);break;case c('FBRTCConstants').PayloadType.OK:this.$FBRTCCallSummary34(i.RECV_OK);break;case c('FBRTCConstants').PayloadType.PRANSWER:this.$FBRTCCallSummary34(i.RECV_PRANSWER);break;case c('FBRTCConstants').PayloadType.OFFER_ACK:this.$FBRTCCallSummary35(m,i.RECV_OFFER_ACK,i.RECV_RETRIED_OFFER_ACK);break;case c('FBRTCConstants').PayloadType.ANSWER_ACK:this.$FBRTCCallSummary35(m,i.RECV_ANSWER_ACK,i.RECV_RETRIED_ANSWER_ACK);break;case c('FBRTCConstants').PayloadType.ICE_CANDIDATE:this.$FBRTCCallSummary36(l,this.$FBRTCCallSummary15,this.$FBRTCCallSummary17);break;default:}this.$FBRTCCallSummary25();};j.prototype.onMsgAckReceived=function(k,l){'use strict';var m=k.msg.flag===1;if(l){this.$FBRTCCallSummary35(m,i.RECV_OFFER_ACK,i.RECV_RETRIED_OFFER_ACK);}else this.$FBRTCCallSummary35(m,i.RECV_ANSWER_ACK,i.RECV_RETRIED_ANSWER_ACK);};j.prototype.onCallConnected=function(){'use strict';this.$FBRTCCallSummary34(i.NETWORK_READY);this.$FBRTCCallSummary34(i.CALL_CONNECTED);this.$FBRTCCallSummary25();};j.prototype.onCallEnded=function(k,l,m,n){'use strict';this.$FBRTCCallSummary11=m;this.$FBRTCCallSummary6=k;this.$FBRTCCallSummary7=n;this.$FBRTCCallSummary8=l;this.$FBRTCCallSummary34(i.CALL_ENDED);this.$FBRTCCallSummary25();};j.prototype.toString=function(){'use strict';var k={};k.core_metrics=this.$FBRTCCallSummary39();k.time_series=null;return JSON.stringify(k);};j.prototype.$FBRTCCallSummary39=function(){'use strict';var k={};k.ver=j.CURRENT_SUMMARY_VERSION;k.log_level=c('FBRTCConstants').uploadLogLevelString(this.$FBRTCCallSummary2);k.caller=this.$FBRTCCallSummary1;k.call_type=this.$FBRTCCallSummary28;k.conf_name=this.$FBRTCCallSummary29;k.serv_info=this.$FBRTCCallSummary30;k.conn=this.$FBRTCCallSummary40();k.peer_id=this.peerID;k.has_video=true;k.open_count=this.$FBRTCCallSummary22;k.signaling=this.$FBRTCCallSummary41();k.sender=this.$FBRTCCallSummary42();k.receiver=this.$FBRTCCallSummary43();k.end=this.$FBRTCCallSummary44();k.video=this.$FBRTCCallSummary45();k.push_phase=c('SiteData').push_phase;return k;};j.prototype.$FBRTCCallSummary40=function(){'use strict';var k={dtls:1};if(this.$FBRTCCallSummary12.sender&&this.$FBRTCCallSummary12.sender.rtt)k.rtt=this.$FBRTCCallSummary12.sender.rtt;return k;};j.prototype.$FBRTCCallSummary41=function(){'use strict';var k={};if(this.$FBRTCCallSummary4)k.trigger=this.$FBRTCCallSummary4;k.start_time=this.$FBRTCCallSummary3;k.time_from_start=this.$FBRTCCallSummary5;var l=this.$FBRTCCallSummary5[i.CALL_CONNECTED],m=this.$FBRTCCallSummary5[i.CALL_ENDED];if(l){if(!m)if(this.$FBRTCCallSummary10){m=this.$FBRTCCallSummary10-this.$FBRTCCallSummary3;}else m=this.$FBRTCCallSummary46();var n=m-l;if(n>0)k.duration=n;}k.new_time_from_start=this.$FBRTCCallSummary20;l=this.$FBRTCCallSummary20[i.CALL_CONNECTED];m=this.$FBRTCCallSummary20[i.CALL_ENDED];if(l){if(!m)if(this.$FBRTCCallSummary19>0){m=this.$FBRTCCallSummary19;}else m=this.$FBRTCCallSummary33();n=m-l;if(n>0)k.new_duration=n;}return k;};j.prototype.$FBRTCCallSummary42=function(){'use strict';var k={};if(this.$FBRTCCallSummary14)k.ice_g0=this.$FBRTCCallSummary14;if(this.$FBRTCCallSummary16)k.ice=this.$FBRTCCallSummary16;if(this.$FBRTCCallSummary12.sender)Object.assign(k,this.$FBRTCCallSummary12.sender);return k;};j.prototype.$FBRTCCallSummary43=function(){'use strict';var k={};if(this.$FBRTCCallSummary15)k.ice_g0=this.$FBRTCCallSummary15;if(this.$FBRTCCallSummary17)k.ice=this.$FBRTCCallSummary17;return k;};j.prototype.$FBRTCCallSummary44=function(){'use strict';var k={};if(this.$FBRTCCallSummary6!==null){k.end_call_reason_string=c('FBRTCConstants').callEndReasonString(this.$FBRTCCallSummary6);if(this.$FBRTCCallSummary7!==null)k.end_call_subreason_string=this.$FBRTCCallSummary7;k.remote_ended=this.$FBRTCCallSummary8;}if(this.$FBRTCCallSummary12.end)Object.assign(k,this.$FBRTCCallSummary12.end);return k;};j.prototype.$FBRTCCallSummary45=function(){'use strict';var k={capture:{}};if(this.$FBRTCCallSummary12.video&&this.$FBRTCCallSummary12.video.sender)Object.assign(k,this.$FBRTCCallSummary12.video.sender);if(this.$FBRTCCallSummary13)Object.assign(k.capture,this.$FBRTCCallSummary13);return {sender:k,ld:this.$FBRTCCallSummary31,rd:this.$FBRTCCallSummary32};};j.prototype.$FBRTCCallSummary46=function(){'use strict';return new Date().valueOf()-this.$FBRTCCallSummary3;};j.prototype.$FBRTCCallSummary33=function(){'use strict';var k=c('performanceNow')()-this.$FBRTCCallSummary18;return Math.floor(this.$FBRTCCallSummary19+k);};j.prototype.$FBRTCCallSummary34=function(k){'use strict';if(this.$FBRTCCallSummary5[k])return;this.$FBRTCCallSummary5[k]=this.$FBRTCCallSummary46();this.$FBRTCCallSummary20[k]=this.$FBRTCCallSummary33();};j.prototype.$FBRTCCallSummary35=function(k,l,m){'use strict';if(k){this.$FBRTCCallSummary34(m);}else this.$FBRTCCallSummary34(l);};j.prototype.$FBRTCCallSummary25=function(){'use strict';this.$FBRTCCallSummary9=new Date().valueOf();};j.prototype.$FBRTCCallSummary24=function(){'use strict';return {device:c('UserAgentData').deviceName,os:c('UserAgentData').platformName,os_version:c('UserAgentData').platformFullVersion,browser:c('UserAgentData').browserName,browser_version:c('UserAgentData').browserFullVersion,screen_height:window.screen.availHeight,screen_width:window.screen.availWidth};};f.exports=j;}),null);
__d('FBRTCCallSummaryStore',['CacheStorage','FBRTCCallSummary','FBRTCLogger','areEqual'],(function a(b,c,d,e,f,g){var h='localstorage',i='RTC_CALL_SUMMARY_',j='summary',k=2000,l=3,m=3*60*1000,n=null;o.getInstance=function(){'use strict';if(!n)n=new o();return n;};function o(){'use strict';this.$FBRTCCallSummaryStore1=new (c('CacheStorage'))(h,i);this.$FBRTCCallSummaryStore2=c('FBRTCLogger').getInstance();}o.prototype.storeCallSummary=function(p,q,r){'use strict';var s=this;this.$FBRTCCallSummaryStore3(function(t){if(!t[p])t[p]={};var u=t[p][q];if(u){var v=s.$FBRTCCallSummaryStore4(u);if(v&&v.getLastUpdatedTime()>r.getLastUpdatedTime()){s.$FBRTCCallSummaryStore2.logToConsole('Outdated summaries');return null;}}t[p][q]=s.$FBRTCCallSummaryStore5(r);return t;},s.$FBRTCCallSummaryStore2.logError.bind(s.$FBRTCCallSummaryStore2,p,q));};o.prototype.retrieveCallSummary=function(p,q){'use strict';var r=this.$FBRTCCallSummaryStore6(),s=null;if(r[p])s=r[p][q];if(s){return this.$FBRTCCallSummaryStore4(s);}else return null;};o.prototype.removeCallSummary=function(p,q){'use strict';this.removeCallSummaries([{peerID:p,callID:q}]);};o.prototype.removeCallSummaries=function(p){'use strict';var q=this;this.$FBRTCCallSummaryStore3(function(r){var s=p.length;for(var t=0;t<s;t++){var u=p[t].peerID,v=p[t].callID;if(r[u]&&r[u][v]){delete r[u][v];if(q.$FBRTCCallSummaryStore7(r[u]))delete r[u];}}return r;},q.$FBRTCCallSummaryStore2.logError.bind(q.$FBRTCCallSummaryStore2,null,null));};o.prototype.getLoggableSummaries=function(){'use strict';var p=this.$FBRTCCallSummaryStore6(),q=[];for(var r in p)if(p.hasOwnProperty(r))for(var s in p[r])if(p[r].hasOwnProperty(s)){var t=this.$FBRTCCallSummaryStore4(p[r][s],m);if(t)q.push(t);}return q;};o.prototype.$FBRTCCallSummaryStore7=function(p){'use strict';for(var q in p)if(p.hasOwnProperty(q))return false;return true;};o.prototype.$FBRTCCallSummaryStore5=function(p){'use strict';var q={__t:Date.now(),__d:p.toJsonString()};return q;};o.prototype.$FBRTCCallSummaryStore4=function(p,q){'use strict';if(p)if(!q||Date.now()-p.__t>=q)return c('FBRTCCallSummary').fromJsonString(p.__d);return null;};o.prototype.$FBRTCCallSummaryStore6=function(){'use strict';var p=this.$FBRTCCallSummaryStore1.get(j)||{};return p;};o.prototype.$FBRTCCallSummaryStore3=function(p,q,r,s){'use strict';if(r===undefined||r===null)r=l;var t=this.$FBRTCCallSummaryStore6(),u=this.$FBRTCCallSummaryStore6(),v=p(t);if(v===null)return;var w=this.$FBRTCCallSummaryStore6();if(c('areEqual')(u,w)){this.$FBRTCCallSummaryStore1.set(j,v);this.$FBRTCCallSummaryStore2.logToConsole('Updated summaries');}else if(r>0){q('Retry lock');if(s){var x=this;setTimeout(function(){x.$FBRTCCallSummaryStore3(p,q,r-1,true);},k);}else this.$FBRTCCallSummaryStore3(p,q,r-1,true);}else q('Failed to lock');};f.exports=o;}),null);
__d("XGroupCallController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/groupcall\/{?conference_name}\/",{conference_name:{type:"String",required:true},call_id:{type:"Int"},users_to_ring:{type:"FBIDSet",defaultValue:[]},has_video:{type:"Bool",defaultValue:false},server_info_data:{type:"String"},nonce:{type:"String"}});}),null);
__d("XGroupCallSigningController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/groupcall\/init\/",{conference_name:{type:"String",required:true},call_id:{type:"Int"},users_to_ring:{type:"FBIDSet",defaultValue:[]},has_video:{type:"Bool",defaultValue:false},server_info_data:{type:"String"},nonce:{type:"String"}});}),null);
__d("XVideoCallController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/videocall\/incall\/",{peer_id:{type:"Int",required:true},call_id:{type:"Int"},is_caller:{type:"Bool",defaultValue:false},audio_only:{type:"Bool",defaultValue:false},nonce:{type:"String"}});}),null);
__d("XVideoCallInitController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/videocall\/init\/",{peer_id:{type:"Int",required:true},call_id:{type:"Int",required:true},is_caller:{type:"Bool",defaultValue:false},audio_only:{type:"Bool",defaultValue:false}});}),null);
__d('FBRTCUrlManager',['regeneratorRuntime','Promise','FBRTCConfig','FBRTCLogger','FBRTCUtils','XVideoCallInitController','XVideoCallController','XGroupCallSigningController','XGroupCallController','CurrentUser','URI'],(function a(b,c,d,e,f,g){var h=3,i=function p(q,r,s,t){c('FBRTCLogger').getInstance().logCallAction(q,r,c('FBRTCLogger').CallAction.OLD_URI);return c('XVideoCallController').getURIBuilder().setInt('peer_id',q).setInt('call_id',r).setBool('is_caller',s).setBool('audio_only',t).getURI();},j=function p(q,r,s,t,u,v,w){var x=arguments.length<=7||arguments[7]===undefined?'':arguments[7];if(w===undefined||w===null)w=h;var y=c('XVideoCallInitController').getURIBuilder().setInt('peer_id',q).setInt('call_id',r).setBool('is_caller',s).setBool('audio_only',t).getURI();y=c('FBRTCUtils').isCollabCallable(q)||x==='quickdial'?k(y):y;c('FBRTCUtils').sendServerRequest(y,function(z){u(z.payload.uri);},function(z){if(w>0){p(q,r,s,t,u,v,w-1,x);}else u(i(q,r,s,t));});};function k(p){if(c('CurrentUser').isEmployee()){p=p.setSubdomain(c('CurrentUser').hasWorkUser()||c('CurrentUser').isWorkUser()?'fb':'www');var q='/intern/';return c('URI').getRequestURI().getPath().substr(0,q.length)!==q?p:p.setDomain(p.getDomain().toString().replace(/.(intern|cstools)./,'.'));}return p;}function l(p){var q=p.conferenceName,r=p.callID,s=p.usersToRing,t=p.hasVideo,u=p.nonce,v=p.serverInfoData,w;return c('regeneratorRuntime').async(function x(y){while(1)switch(y.prev=y.next){case 0:w=c('XGroupCallSigningController').getURIBuilder().setString('conference_name',q).setInt('call_id',r).setFBIDSet('users_to_ring',s).setBool('has_video',t).setString('server_info_data',v).setString('nonce',u).getURI();return y.abrupt('return',new (c('Promise'))(function(z,aa){c('FBRTCUtils').sendServerRequest(w,function(ba){z(ba.payload.uri);},function(ba){aa(ba);});}));case 2:case 'end':return y.stop();}},null,this);}var m=function p(q,r,s,t,u,v,w){if(w===undefined||w===null)w=h;var x=c('XGroupCallSigningController').getURIBuilder().setFBID('call_id',q).setBool('is_caller',s).setBool('audio_only',t).setFBIDSet('users_to_ring',r).getURI();c('FBRTCUtils').sendServerRequest(x,function(y){u(y.payload.uri);},function(y){if(w>0){p(q,r,s,t,u,v,w-1);}else{var z=c('XGroupCallController').getURIBuilder().setFBID('call_id',q).setBool('is_caller',s).setBool('audio_only',t).setFBIDSet('users_to_ring',r).getURI();u(z);}});},n=function p(q){if(c('FBRTCConfig').disableURLManager())return;window.history.replaceState({},'',q);},o={init:function p(q){this._peerID=q;},onCallStarted:function p(){n(i(this._peerID));},getCallUri:j,getGroupCallUri:function p(q,r,s,t,u,v){var w;return c('regeneratorRuntime').async(function x(y){while(1)switch(y.prev=y.next){case 0:w=0;case 1:if(!(w<3)){y.next=14;break;}y.prev=2;y.next=5;return c('regeneratorRuntime').awrap(l({conferenceName:q,callID:r,usersToRing:s,hasVideo:t,nonce:u,serverInfoData:v}));case 5:return y.abrupt('return',y.sent);case 8:y.prev=8;y.t0=y['catch'](2);case 11:w++;y.next=1;break;case 14:return y.abrupt('return',c('XGroupCallController').getURIBuilder().setString('conference_name',q).setInt('call_id',r).setFBIDSet('users_to_ring',s).setBool('has_video',t).setString('server_info_data',v).setString('nonce',u).getURI());case 15:case 'end':return y.stop();}},null,this,[[2,8]]);},getNonceUri:function p(q,r,s,t,u){var v=arguments.length<=5||arguments[5]===undefined?'':arguments[5],w=c('XVideoCallController').getURIBuilder().setInt('peer_id',q).setInt('call_id',r).setBool('is_caller',s).setBool('audio_only',t).setString('nonce',u).getURI();return c('FBRTCUtils').isCollabCallable(q)||v==='quickdial'?k(w):w;}};f.exports=o;}),null);
__d('FBRTCCallUI',['regeneratorRuntime','BanzaiLogger','FBRTCCallSummary','FBRTCCallSummaryStore','FBRTCConstants','FBRTCLogger','FBRTCMessageListener','FBRTCUrlManager','pageID'],(function a(b,c,d,e,f,g){var h={openGroupCallUI:function i(j,k,l,m,n,o,p){var q,r;return c('regeneratorRuntime').async(function s(t){while(1)switch(t.prev=t.next){case 0:t.next=2;return c('regeneratorRuntime').awrap(c('FBRTCUrlManager').getGroupCallUri(j,k,l,m,c('FBRTCMessageListener').generateNewNonce(),p));case 2:q=t.sent;o.location=q;o.focus&&o.focus();r=new (c('FBRTCCallSummary'))({peerID:-1,callID:k,isCaller:true});r.onCallStarted(n);r.addExtraInfo(c('FBRTCLogger').Key.INITIATED_BY_PAGE_ID,c('pageID'));r.onCallEnded(c('FBRTCConstants').CallEndReason.CLIENT_ERROR,false,true,'PopupPending');r.save(c('FBRTCCallSummaryStore').getInstance());case 10:case 'end':return t.stop();}},null,this);},openGroupCallURI:function i(j){var k=j.conferenceName,l=j.callID,m=j.hasVideo,n=j.serverInfoData,o=j.trigger,p=j.callSummary,q=j.callWindow,r;return c('regeneratorRuntime').async(function s(t){while(1)switch(t.prev=t.next){case 0:t.next=2;return c('regeneratorRuntime').awrap(c('FBRTCUrlManager').getGroupCallUri(k,l,[],m,c('FBRTCMessageListener').generateNewNonce(),n));case 2:r=t.sent;q.location=r;q.focus&&q.focus();p.onCallStarted(o);p.addExtraInfo(c('FBRTCLogger').Key.INITIATED_BY_PAGE_ID,c('pageID'));p.onCallEnded(c('FBRTCConstants').CallEndReason.CLIENT_ERROR,false,true,'PopupPending');p.save(c('FBRTCCallSummaryStore').getInstance());case 9:case 'end':return t.stop();}},null,this);},openAsCaller:function i(j,k,l,m,n){c('BanzaiLogger').log('VideoCallLoggerConfig',{event:'open_as_caller'});c('FBRTCLogger').getInstance().logCallAction(j,k,c('FBRTCLogger').CallAction.START_CALL,null,l);var o=new (c('FBRTCCallSummary'))({peerID:j,callID:k,isCaller:true});o.onCallStarted(l);this._open(j,k,true,o,false,m,n,l);},openAsCallee:function i(j,k,l,m,n,o){c('BanzaiLogger').log('VideoCallLoggerConfig',{event:'open_as_callee'});this._open(j,k,false,l,m,n,o);},_open:function i(j,k,l,m,n,o,p){var q=arguments.length<=7||arguments[7]===undefined?'':arguments[7];m.addExtraInfo(c('FBRTCLogger').Key.INITIATED_BY_PAGE_ID,c('pageID'));m.onCallEnded(c('FBRTCConstants').CallEndReason.CLIENT_ERROR,false,true,'PopupPending');m.save(c('FBRTCCallSummaryStore').getInstance());if(!p)return;n=c('FBRTCUrlManager').getNonceUri(j,k,l,o,c('FBRTCMessageListener').generateNewNonce(),q);c('BanzaiLogger').log('VideoCallLoggerConfig',{event:'open_popup'});if(!n){this._setUri(p,j,k,l,o);}else{c('FBRTCLogger').getInstance().logCallAction(j,k,c('FBRTCLogger').CallAction.OPEN_POPUP);p.location=n;}p.focus&&p.focus();},_setUri:function i(j,k,l,m,n){c('FBRTCUrlManager').getCallUri(k,l,m,n,function(o){c('FBRTCLogger').getInstance().logCallAction(k,l,c('FBRTCLogger').CallAction.OPEN_POPUP);j.location=o;},function(){c('FBRTCLogger').getInstance().logCallAction(k,l,c('FBRTCLogger').CallAction.FAILED_GETTING_URI);});}};f.exports=h;}),null);